<!DOCTYPE html>
<html lang="en">
<head>
          <title>DatasFrame</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
        <link rel="stylesheet" href="./theme/css/main.css" />
        <script src="//code.jquery.com/jquery-2.2.2.min.js"></script>



    <meta name="tags" content="python" />
    <meta name="tags" content="data science" />
    <meta name="tags" content="pandas" />

</head>

<body id="index" class="home">
    <nav>
      <a href=".">Home | </a>
      <a href="/archives.html">Archive | </a>
      <a href="/categories.html">Categories | </a>
      <a href="/pages/about.html">About | </a>
      <a href="/feeds/all.rss.xml">RSS</a>
    </nav>

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./method-chaining.html" rel="bookmark"
         title="Permalink to Modern Pandas (Part 2): Method Chaining">Modern Pandas (Part 2): Method Chaining</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2016-04-04T06:00:00-05:00">
      Mon 04 April 2016
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/tom-augspurger.html">Tom Augspurger</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p><em>Author's Note</em></p>
<p>Good news everyone, Wes has announced a 2nd edition of <em>Python for Data Analysis</em>!</p>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">Dear Twitter friends: I have started the process of writing the 2nd edition of Python for Data Analysis -- coming late 2016 or early 2017!</p>&mdash; Wes McKinney (@wesmckinn) <a href="https://twitter.com/wesmckinn/status/715320179173888001">March 30, 2016</a></blockquote>

<p><script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script></p>
<p>The first edition is great, and is my recommendation for people looking to learn python for data analysis.
Its success has been a reason for (and evidence of) Python becoming one of the top languages for data analysis.
Congrats and thanks to Wes.</p>
<hr />
<p>This is part 2 in my series on writing modern idiomatic pandas.</p>
<ul>
<li><a href="modern-1.html">Modern Pandas</a></li>
<li><a href="method-chaining.html">Method Chaining</a> (this post)</li>
<li><a href="modern-3-indexes.html">Indexes</a></li>
<li>Fast Pandas (forthcoming)</li>
<li>Indexes and Tidy Data (forthcoming)</li>
<li>Visualization (forthcoming)</li>
<li>Larger Data (forthcoming)</li>
</ul>
<hr />
<p>Method chaining, where you call methods on an object one after another, is in vogue at the moment.
It's always been a style of programming that's been possible with pandas,
and over the past several releases, we've added methods that enable even more chaining.</p>
<ul>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.assign.html">assign</a> (0.16.0): For adding new columns to a DataFrame in a chain (inspired by dplyr's <code>mutate</code>)</li>
<li><a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.pipe.html">pipe</a> (0.16.2): For including user-defined methods in method chains.</li>
<li><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#changes-to-rename">rename</a> (0.18.0): For altering axis names (in additional to changing the actual labels as before).</li>
<li><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#window-functions-are-now-methods">Window methods</a> (0.18): Took the top-level <code>pd.rolling_*</code> and <code>pd.expanding_*</code> functions and made them <code>NDFrame</code> methods with a <code>groupby</code>-like API.</li>
<li><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#resample-api">Resample</a> (0.18.0) Added a new <code>groupby</code>-like API</li>
<li><a href="https://github.com/pydata/pandas/pull/12539">.where/mask/Indexers accept Callables</a> (0.18.1): In the next release you'll be able to pass a callable to the indexing methods, to be evaluated within the DataFrame's context (like <code>.query</code>, but with code instead of strings).</li>
</ul>
<p>My scripts will typically start off with large-ish chain at the start getting things into a manageable state.
It's good to have the bulk of your munging done with right away so you can start to do Scienceâ„¢:</p>
<p>Here's a quick example:</p>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>


<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;unnamed: 36&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">extract_city_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">time_to_datetime</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dep_time&#39;</span><span class="p">,</span> <span class="s1">&#39;arr_time&#39;</span><span class="p">,</span> <span class="s1">&#39;crs_arr_time&#39;</span><span class="p">,</span> <span class="s1">&#39;crs_dep_time&#39;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fl_date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;fl_date&#39;</span><span class="p">]),</span>
                    <span class="n">dest</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]),</span>
                    <span class="n">origin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]),</span>
                    <span class="n">tail_num</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;tail_num&#39;</span><span class="p">]),</span>
                    <span class="n">unique_carrier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;unique_carrier&#39;</span><span class="p">]),</span>
                    <span class="n">cancellation_code</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;cancellation_code&#39;</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">extract_city_name</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Chicago, IL -&gt; Chicago for origin_city_name and dest_city_name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;origin_city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;dest_city_name&#39;</span><span class="p">]</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;(.*), \w{2}&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;origin_city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;dest_city_name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">city</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">time_to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Combine all time items into datetimes.</span>

<span class="sd">    2014-01-01,0914 -&gt; 2014-01-01 09:14:00</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">converter</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
        <span class="n">timepart</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;\.0$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># NaNs force float dtype</span>
                       <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">fillchar</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">))</span>
        <span class="k">return</span>  <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fl_date&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                               <span class="n">timepart</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span>
                               <span class="n">timepart</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                               <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datetime_part</span>
    <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">converter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s2">&quot;878167309_T_ONTIME.csv&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 471949 entries, 0 to 471948
Data columns (total 36 columns):
fl_date                  471949 non-null datetime64[ns]
unique_carrier           471949 non-null category
airline_id               471949 non-null int64
tail_num                 467903 non-null category
fl_num                   471949 non-null int64
...
nas_delay                119994 non-null float64
security_delay           119994 non-null float64
late_aircraft_delay      119994 non-null float64
dtypes: category(5), datetime64[ns](5), float64(14), int64(8), object(4)
memory usage: 115.3+ MB
</pre></div>


<p>I find method chains readable, though some people don't.
Both the code and the flow of execution are from top to bottom, and the function parameters are always near the function itself, unlike with heavily nested function calls.</p>
<p>My favorite example demonstrating this comes from <a href="http://trestletech.com/wp-content/uploads/2015/07/dplyr.pdf">Jeff Allen</a> (pdf). Compare these two ways of telling the same story:</p>
<div class="codehilite"><pre><span></span>tumble_after<span class="p">(</span>
    broke<span class="p">(</span>
        fell_down<span class="p">(</span>
            fetch<span class="p">(</span>went_up<span class="p">(</span>jack_jill<span class="p">,</span> <span class="s">&quot;hill&quot;</span><span class="p">),</span> <span class="s">&quot;water&quot;</span><span class="p">),</span>
            jack<span class="p">),</span>
        <span class="s">&quot;crown&quot;</span><span class="p">),</span>
    <span class="s">&quot;jill&quot;</span>
<span class="p">)</span>
</pre></div>


<p>and</p>
<div class="codehilite"><pre><span></span>jack_jill <span class="o">%&gt;%</span>
    went_up<span class="p">(</span><span class="s">&quot;hill&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    fetch<span class="p">(</span><span class="s">&quot;water&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    fell_down<span class="p">(</span><span class="s">&quot;jack&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    broke<span class="p">(</span><span class="s">&quot;crown&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span>
    tumble_after<span class="p">(</span><span class="s">&quot;jill&quot;</span><span class="p">)</span>
</pre></div>


<p>Even if you weren't aware that in R <code>%&gt;%</code> (pronounced <em>pipe</em>) calls the function on the right with the thing on the left as an argument, you can still make out what's going on. Compare that with the first style, where you need to unravel the code to figure out the order of execution and which arguments are being passed where.</p>
<p>Admittedly, you probably wouldn't write the first one.
It'd be something like</p>
<div class="codehilite"><pre><span></span><span class="n">on_hill</span> <span class="o">=</span> <span class="n">went_up</span><span class="p">(</span><span class="n">jack_jill</span><span class="p">,</span> <span class="s1">&#39;hill&#39;</span><span class="p">)</span>
<span class="n">with_water</span> <span class="o">=</span> <span class="n">fetch</span><span class="p">(</span><span class="n">on_hill</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">)</span>
<span class="n">fallen</span> <span class="o">=</span> <span class="n">fell_down</span><span class="p">(</span><span class="n">with_water</span><span class="p">,</span> <span class="s1">&#39;jack&#39;</span><span class="p">)</span>
<span class="n">broken</span> <span class="o">=</span> <span class="n">broke</span><span class="p">(</span><span class="n">fallen</span><span class="p">,</span> <span class="s1">&#39;jack&#39;</span><span class="p">)</span>
<span class="n">after</span> <span class="o">=</span> <span class="n">tmple_after</span><span class="p">(</span><span class="n">broken</span><span class="p">,</span> <span class="s1">&#39;jill&#39;</span><span class="p">)</span>
</pre></div>


<p>I don't like this version because I have to spend time coming up with appropriate names for variables<sup id="fnref:names"><a class="footnote-ref" href="#fn:names" rel="footnote">1</a></sup>.
That's bothersome when we don't <em>really</em> care about the <code>on_hill</code> variable. We're just passing it into the next step.</p>
<p>A fourth way of writing the same story may be available. Suppose you owned a <code>JackAndJill</code> object, and could define the methods on it. Then you'd have something like R's <code>%&gt;%</code> example.</p>
<div class="codehilite"><pre><span></span><span class="n">jack_jill</span> <span class="o">=</span> <span class="n">JackAndJill</span><span class="p">()</span>
<span class="p">(</span><span class="n">jack_jill</span><span class="o">.</span><span class="n">went_up</span><span class="p">(</span><span class="s1">&#39;hill&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">fetch</span><span class="p">(</span><span class="s1">&#39;water&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">fell_down</span><span class="p">(</span><span class="s1">&#39;jack&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">broke</span><span class="p">(</span><span class="s1">&#39;crown&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tumble_after</span><span class="p">(</span><span class="s1">&#39;jill&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<p>But the problem is you don't own the <code>ndarray</code> or <code>DataFrame</code> or <a href="http://xarray.pydata.org/en/stable/data-structures.html#dataarray"><code>DataArray</code></a>, and the exact method you want may not exist.
Monekypatching on your own methods is fragile.
It's not easy to correctly subclass pandas' DataFrame to extend it with your own methods.
Composition, where you create a class that holds onto a DataFrame internally, may be fine for your own code, but it won't interact well with the rest of the ecosystem so your code will be littered with lines extracting and repacking the underlying DataFrame.</p>
<p>Perhaps you could submit a pull request to pandas implementing your method.
But then you'd need to convince the maintainers that it's broadly useful enough to merit its inclusion (and worth their time to maintain it). And <code>DataFrame</code> has something like 250+ methods, so we're reluctant to add more.</p>
<p>Enter <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.pipe.html"><code>DataFrame.pipe</code></a>. All the benefits of having your specific function as a method on the DataFrame, without us having to maintain it, and without it overloading the already large pandas API. A win for everyone.</p>
<div class="codehilite"><pre><span></span><span class="n">jack_jill</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="p">(</span><span class="n">jack_jill</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">went_up</span><span class="p">,</span> <span class="s1">&#39;hill&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">fetch</span><span class="p">,</span> <span class="s1">&#39;water&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">fell_down</span><span class="p">,</span> <span class="s1">&#39;jack&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">broke</span><span class="p">,</span> <span class="s1">&#39;crown&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">tumble_after</span><span class="p">,</span> <span class="s1">&#39;jill&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<p>This really is just right-to-left function execution. The first argument to <code>pipe</code>, a callable, is called with the DataFrame on the left as its first argument, and any additional arguments you specify.</p>
<p>I hope the analogy to data analysis code is clear.
Code is read more often than it is written.
When you or your coworkers or research partners have to go back in two months to update your script, having the story of raw data to results be told as clearly as possible will save you time.</p>
<h2>Costs</h2>
<p>One drawback to excessively long chains is that debugging can be harder.
If something looks wrong at the end, you don't have intermediate values to inspect. There's a close parallel here to python's generators. Generators are great for keeping memory consumption down, but they can be hard to debug since values are consumed.</p>
<p>For my typical exploratory workflow, this isn't really a big problem. I'm working with a single dataset that isn't being updated, and the path from raw data to usuable data isn't so large that I can't drop an <code>import pdb; pdb.set_trace()</code> in the middle of my code to poke around.</p>
<p>For large workflows, you'll probably want to move away from pandas to something more structured, like <a href="http://pythonhosted.org/airflow/">Airflow</a> or <a href="http://luigi.readthedocs.org/en/stable/index.html">Luigi</a>.</p>
<p>When writing medium sized <a href="https://en.wikipedia.org/wiki/Extract,_transform,_load">ETL</a> jobs in python that will be run repeatedly, I'll use decorators to inspect and log properties about the DataFrames at each step of the process.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">wraps</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="k">def</span> <span class="nf">log_shape</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>

<span class="k">def</span> <span class="nf">log_dtypes</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">,</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">dtypes</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@log_shape</span>
<span class="nd">@log_dtypes</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="nd">@log_shape</span>
<span class="nd">@log_dtypes</span>
<span class="k">def</span> <span class="nf">update_events</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">new_events</span><span class="p">):</span>
    <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new_events</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;foo&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_events</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>


<p>This plays nicely with <a href="http://engarde.readthedocs.org"><code>engarde</code></a>, a little library I wrote to validate data as it flows through the pipeline (it essentialy turns those logging statements into excpetions if something looks wrong).</p>
<h2>Inplace?</h2>
<p>Most pandas methods have an <code>inplace</code> keyword that's <code>False</code> by default.
In general, you shouldn't do inplace operations.</p>
<p>First, if you like method chains then you simply can't use inplace since the return value is <code>None</code>, terminating the chain.</p>
<p>Second, I suspect people have a mental model of <code>inplace</code> operations happening, you know, inplace. That is, extra memory doesn't need to be allocated for the result. <a href="http://stackoverflow.com/a/22533110">But that might not actually be true</a>.
Quoting Jeff Reback from that answer</p>
<blockquote>
<p>Their is <strong>no guarantee</strong> that an inplace operation is actually faster. Often they are actually the same operation that works on a copy, but the top-level reference is reassigned.</p>
</blockquote>
<p>That is, the pandas code might look something like this</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">dataframe_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># regardless of inplace</span>
    <span class="n">result</span> <span class="o">=</span> <span class="o">...</span>
    <span class="k">if</span> <span class="n">inplace</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_update_inplace</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">result</span>
</pre></div>


<p>There's a lot of defensive copying in pandas.
Part of this comes down to pandas being built on top of NumPy, and not having full control over how memory is handled and shared.
We saw it above when we defined our own functions <code>extract_city_name</code> and <code>time_to_datetime</code>.
Without the <code>copy</code>, adding the columns would modify the input DataFrame, which just isn't polite.</p>
<p>Finally, inplace operations don't make sense in projects like <a href="http://www.ibis-project.org">ibis</a> or <a href="http://dask.pydata.org/en/latest/">dask</a>, where you're manipulating expressions or building up a DAG of tasks to be executed, rather than manipulating the data directly.</p>
<hr />
<p>I feel like we haven't done much coding, mostly just me shouting from the top of a soapbox (sorry about that).
Let's do some exploratory analysis.</p>
<p>What's the daily flight pattern look like?</p>
<div class="codehilite"><pre><span></span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;dep_time&#39;</span><span class="p">,</span> <span class="s1">&#39;unique_carrier&#39;</span><span class="p">])</span>
   <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;unique_carrier&#39;</span><span class="p">]</span>
       <span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;unique_carrier&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[:</span><span class="mi">5</span><span class="p">])]</span>
   <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;dep_time&#39;</span><span class="p">)</span>
   <span class="c1"># TimeGrouper to resample &amp; groupby at once</span>
   <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;unique_carrier&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">TimeGrouper</span><span class="p">(</span><span class="s2">&quot;H&quot;</span><span class="p">)])</span>
   <span class="o">.</span><span class="n">fl_num</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
   <span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
   <span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
   <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
   <span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s2">&quot;Flights per Day&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
   <span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>


<p><img alt="fpd" src="images/flights_per_day.svg" /></p>
<p>That method chain is bordering on doing too much. I probably wouldn't actually write it like that, but we are talking about method chains after all.
Plus the hourly flights is probably going to be useful elsewhere, so I would assign a variable
to it.</p>
<p>Does a plane with multiple flights on the same day get backed up, causing later flights to be delayed more?</p>
<div class="codehilite"><pre><span></span><span class="n">flights</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;fl_date&#39;</span><span class="p">,</span> <span class="s1">&#39;tail_num&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_time&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_delay&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">]]</span>
           <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
           <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;dep_time&#39;</span><span class="p">)</span>
           <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">turn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span>
                <span class="n">x</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;fl_date&#39;</span><span class="p">,</span> <span class="s1">&#39;tail_num&#39;</span><span class="p">])</span>
                 <span class="o">.</span><span class="n">dep_time</span>
                 <span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="s1">&#39;rank&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;turn&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;dep_delay&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">flights</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>


<p><img alt="Backup?" src="images/mc_turn.svg" /></p>
<p>Doesn't really look like it. Maybe other planes are swapped in when one gets delayed,
but we don't have data on <em>scheduled</em> flights per plane.</p>
<p>Do flights later in the day have longer delays?</p>
<div class="codehilite"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="s1">&#39;fl_date&#39;</span><span class="p">,</span> <span class="s1">&#39;tail_num&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_time&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_delay&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">dep_time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span>
    <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;5 &lt; dep_delay &lt; 600&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">pipe</span><span class="p">((</span><span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> <span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_delay&#39;</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>


<p><img alt="by hour" src="images/delay_by_hour.svg" /></p>
<p>There could be something here. I didn't show it here since I filtered them out,
but the vast majority of flights to leave on time.</p>
<p>Let's try scikit-learn's <a href="http://scikit-learn.org/dev/modules/gaussian_process.html">new Gaussian Process module</a> to create a graph inspired by the <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html">dplyr introduction</a>.</p>
<div class="codehilite"><pre><span></span><span class="n">planes</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">fl_date</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;tail_num&quot;</span><span class="p">)</span>
<span class="n">delay</span> <span class="o">=</span> <span class="p">(</span><span class="n">planes</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
                     <span class="s2">&quot;arr_delay&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">})</span>
               <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;distance&quot;</span><span class="p">:</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;arr_delay&quot;</span><span class="p">:</span> <span class="s2">&quot;delay&quot;</span><span class="p">,</span>
                                <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
               <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;count &gt; 20 &amp; dist &lt; 2000&quot;</span><span class="p">))</span>
<span class="n">delay</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>delay</th>
      <th>dist</th>
    </tr>
    <tr>
      <th>tail_num</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>D942DN</th>
      <td>120</td>
      <td>9.232143</td>
      <td>829.783333</td>
    </tr>
    <tr>
      <th>N001AA</th>
      <td>139</td>
      <td>13.818182</td>
      <td>616.043165</td>
    </tr>
    <tr>
      <th>N002AA</th>
      <td>135</td>
      <td>9.570370</td>
      <td>570.377778</td>
    </tr>
    <tr>
      <th>N003AA</th>
      <td>125</td>
      <td>5.722689</td>
      <td>641.184000</td>
    </tr>
    <tr>
      <th>N004AA</th>
      <td>138</td>
      <td>2.037879</td>
      <td>630.391304</td>
    </tr>
  </tbody>
</table>

<div class="codehilite"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">delay</span><span class="p">[</span><span class="s1">&#39;dist&#39;</span><span class="p">]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">delay</span><span class="p">[</span><span class="s1">&#39;delay&#39;</span><span class="p">]</span>

<span class="kn">from</span> <span class="nn">sklearn.gaussian_process</span> <span class="kn">import</span> <span class="n">GaussianProcessRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.gaussian_process.kernels</span> <span class="kn">import</span> <span class="n">RBF</span><span class="p">,</span> <span class="n">WhiteKernel</span>

<span class="n">kernel</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">RBF</span><span class="p">(</span><span class="n">length_scale</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">length_scale_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">WhiteKernel</span><span class="p">(</span><span class="n">noise_level</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">noise_level_bounds</span><span class="o">=</span><span class="p">(</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mf">1e+5</span><span class="p">)))</span>
<span class="n">gp</span> <span class="o">=</span> <span class="n">GaussianProcessRegressor</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span>
                              <span class="n">alpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">y</span><span class="p">)</span>

<span class="n">X_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">y_mean</span><span class="p">,</span> <span class="n">y_cov</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">],</span> <span class="n">return_cov</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">delay</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;scatter&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;dist&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;delay&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">delay</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span> <span class="n">y_mean</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">X_</span><span class="p">,</span> <span class="n">y_mean</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">y_cov</span><span class="p">)),</span>
                <span class="n">y_mean</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">y_cov</span><span class="p">)),</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>

<span class="n">sizes</span> <span class="o">=</span> <span class="p">(</span><span class="n">delay</span><span class="p">[</span><span class="s1">&#39;count&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">for</span> <span class="n">area</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">sizes</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">sizes</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([],</span> <span class="p">[],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">area</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; flights&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">scatterpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">65</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>


<p><img alt="Smoothed" src="images/mc_flights.svg" /></p>
<hr />
<p>Thanks for reading!
This section was a bit more abstract, since we were talking about styles
of coding rather than how to actually accomplish tasks.
I'm sometimes guilty of putting too much work into making my data wrangling code look nice and feel correct, at the expense of actually analyzing the data.
This isn't a competition to have the best or cleanest pandas code; pandas is always just a means to the end that is your research or business problem.
Thanks for indulging me.
Next time we'll talk about a much more practical topic: performance.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:names">
<p>When implementing <code>assign</code>, pandas' version of dplyr's <code>mutate</code>, we spent <em>a lot</em> of time finding the right name. We ended up having 110 comments in the <a href="https://github.com/pydata/pandas/pull/9239">PR</a>, plus more in the issue, for a roughly 15 line method. Most of those were about the name.&#160;<a class="footnote-backref" href="#fnref:names" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
  </div><!-- /.entry-content -->
</section>

    <footer>
      <p>&copy; Tom Augspurger </p>
    </footer>
  </main>

</body>
</html>
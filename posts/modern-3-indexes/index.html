<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Modern Panadas (Part 3): Indexes | Tom's Blog</title><meta name=keywords content="pandas"><meta name=description content="This is part 3 in my series on writing modern idiomatic pandas.
Modern Pandas Method Chaining Indexes Fast Pandas Tidy Data Visualization Time Series Scaling Indexes can be a difficult concept to grasp at first. I suspect this is partly becuase they&rsquo;re somewhat peculiar to pandas. These aren&rsquo;t like the indexes put on relational database tables for performance optimizations. Rather, they&rsquo;re more like the row_labels of an R DataFrame, but much more capable."><meta name=author content><link rel=canonical href=https://tomaugspurger.net/posts/modern-3-indexes/><link crossorigin=anonymous href=/assets/css/stylesheet.3690c96d8a707265a16abd3b389bb33e4e3916869c3142cba43a3cfaaed4b5f9.css integrity="sha256-NpDJbYpwcmWhar07OJuzPk45FoacMULLpDo8+q7Utfk=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://tomaugspurger.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomaugspurger.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomaugspurger.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tomaugspurger.net/apple-touch-icon.png><link rel=mask-icon href=https://tomaugspurger.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Modern Panadas (Part 3): Indexes"><meta property="og:description" content="This is part 3 in my series on writing modern idiomatic pandas.
Modern Pandas Method Chaining Indexes Fast Pandas Tidy Data Visualization Time Series Scaling Indexes can be a difficult concept to grasp at first. I suspect this is partly becuase they&rsquo;re somewhat peculiar to pandas. These aren&rsquo;t like the indexes put on relational database tables for performance optimizations. Rather, they&rsquo;re more like the row_labels of an R DataFrame, but much more capable."><meta property="og:type" content="article"><meta property="og:url" content="https://tomaugspurger.net/posts/modern-3-indexes/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-04-11T00:00:00+00:00"><meta property="article:modified_time" content="2016-04-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Modern Panadas (Part 3): Indexes"><meta name=twitter:description content="This is part 3 in my series on writing modern idiomatic pandas.
Modern Pandas Method Chaining Indexes Fast Pandas Tidy Data Visualization Time Series Scaling Indexes can be a difficult concept to grasp at first. I suspect this is partly becuase they&rsquo;re somewhat peculiar to pandas. These aren&rsquo;t like the indexes put on relational database tables for performance optimizations. Rather, they&rsquo;re more like the row_labels of an R DataFrame, but much more capable."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://tomaugspurger.net/posts/"},{"@type":"ListItem","position":3,"name":"Modern Panadas (Part 3): Indexes","item":"https://tomaugspurger.net/posts/modern-3-indexes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Modern Panadas (Part 3): Indexes","name":"Modern Panadas (Part 3): Indexes","description":"This is part 3 in my series on writing modern idiomatic pandas.\nModern Pandas Method Chaining Indexes Fast Pandas Tidy Data Visualization Time Series Scaling Indexes can be a difficult concept to grasp at first. I suspect this is partly becuase they\u0026rsquo;re somewhat peculiar to pandas. These aren\u0026rsquo;t like the indexes put on relational database tables for performance optimizations. Rather, they\u0026rsquo;re more like the row_labels of an R DataFrame, but much more capable.","keywords":["pandas"],"articleBody":" This is part 3 in my series on writing modern idiomatic pandas.\nModern Pandas Method Chaining Indexes Fast Pandas Tidy Data Visualization Time Series Scaling Indexes can be a difficult concept to grasp at first. I suspect this is partly becuase they’re somewhat peculiar to pandas. These aren’t like the indexes put on relational database tables for performance optimizations. Rather, they’re more like the row_labels of an R DataFrame, but much more capable.\nIndexes offer\nmetadata container easy label-based row selection easy label-based alignment in operations label-based concatenation To demonstrate these, we’ll first fetch some more data. This will be weather data from sensors at a bunch of airports across the US. See here for the example scraper I based this off of.\n%matplotlib inline import json import glob import datetime from io import StringIO import requests import numpy as np import pandas as pd import seaborn as sns import matplotlib.pyplot as plt sns.set_style('ticks') # States are broken into networks. The networks have a list of ids, each representing a station. # We will take that list of ids and pass them as query parameters to the URL we built up ealier. states = \"\"\"AK AL AR AZ CA CO CT DE FL GA HI IA ID IL IN KS KY LA MA MD ME MI MN MO MS MT NC ND NE NH NJ NM NV NY OH OK OR PA RI SC SD TN TX UT VA VT WA WI WV WY\"\"\".split() # IEM has Iowa AWOS sites in its own labeled network networks = ['AWOS'] + ['{}_ASOS'.format(state) for state in states] def get_weather(stations, start=pd.Timestamp('2014-01-01'), end=pd.Timestamp('2014-01-31')): ''' Fetch weather data from MESONet between ``start`` and ``stop``. ''' url = (\"http://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?\" \"\u0026data=tmpf\u0026data=relh\u0026data=sped\u0026data=mslp\u0026data=p01i\u0026data=vsby\u0026data=gust_mph\u0026data=skyc1\u0026data=skyc2\u0026data=skyc3\" \"\u0026tz=Etc/UTC\u0026format=comma\u0026latlon=no\" \"\u0026{start:year1=%Y\u0026month1=%m\u0026day1=%d}\" \"\u0026{end:year2=%Y\u0026month2=%m\u0026day2=%d}\u0026{stations}\") stations = \"\u0026\".join(\"station=%s\" % s for s in stations) weather = (pd.read_csv(url.format(start=start, end=end, stations=stations), comment=\"#\") .rename(columns={\"valid\": \"date\"}) .rename(columns=str.strip) .assign(date=lambda df: pd.to_datetime(df['date'])) .set_index([\"station\", \"date\"]) .sort_index()) float_cols = ['tmpf', 'relh', 'sped', 'mslp', 'p01i', 'vsby', \"gust_mph\"] weather[float_cols] = weather[float_cols].apply(pd.to_numeric, errors=\"corce\") return weather def get_ids(network): url = \"http://mesonet.agron.iastate.edu/geojson/network.php?network={}\" r = requests.get(url.format(network)) md = pd.io.json.json_normalize(r.json()['features']) md['network'] = network return md Talk briefly about the gem of a method that is json_normalize.\nurl = \"http://mesonet.agron.iastate.edu/geojson/network.php?network={}\" r = requests.get(url.format(\"AWOS\")) js = r.json() js['features'][:2] [{'geometry': {'coordinates': [-94.2723694444, 43.0796472222], 'type': 'Point'}, 'id': 'AXA', 'properties': {'sid': 'AXA', 'sname': 'ALGONA'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.569475, 41.6878083333], 'type': 'Point'}, 'id': 'IKV', 'properties': {'sid': 'IKV', 'sname': 'ANKENY'}, 'type': 'Feature'}] pd.DataFrame(js['features']).head().to_html() geometry id properties type 0 {\\'coordinates\\': [-94.2723694444, 43.0796472222... AXA {\\'sname\\': \\'ALGONA\\', \\'sid\\': \\'AXA\\'} Feature 1 {\\'coordinates\\': [-93.569475, 41.6878083333], \\'... IKV {\\'sname\\': \\'ANKENY\\', \\'sid\\': \\'IKV\\'} Feature 2 {\\'coordinates\\': [-95.0465277778, 41.4058805556... AIO {\\'sname\\': \\'ATLANTIC\\', \\'sid\\': \\'AIO\\'} Feature 3 {\\'coordinates\\': [-94.9204416667, 41.6993527778... ADU {\\'sname\\': \\'AUDUBON\\', \\'sid\\': \\'ADU\\'} Feature 4 {\\'coordinates\\': [-93.848575, 42.0485694444], \\'... BNW {\\'sname\\': \\'BOONE MUNI\\', \\'sid\\': \\'BNW\\'} Feature js['features'][0] { 'geometry': { 'coordinates': [-94.2723694444, 43.0796472222], 'type': 'Point' }, 'id': 'AXA', 'properties': { 'sid': 'AXA', 'sname': 'ALGONA' }, 'type': 'Feature' } js['features'] [{'geometry': {'coordinates': [-94.2723694444, 43.0796472222], 'type': 'Point'}, 'id': 'AXA', 'properties': {'sid': 'AXA', 'sname': 'ALGONA'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.569475, 41.6878083333], 'type': 'Point'}, 'id': 'IKV', 'properties': {'sid': 'IKV', 'sname': 'ANKENY'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.0465277778, 41.4058805556], 'type': 'Point'}, 'id': 'AIO', 'properties': {'sid': 'AIO', 'sname': 'ATLANTIC'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-94.9204416667, 41.6993527778], 'type': 'Point'}, 'id': 'ADU', 'properties': {'sid': 'ADU', 'sname': 'AUDUBON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.848575, 42.0485694444], 'type': 'Point'}, 'id': 'BNW', 'properties': {'sid': 'BNW', 'sname': 'BOONE MUNI'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-94.7888805556, 42.0443611111], 'type': 'Point'}, 'id': 'CIN', 'properties': {'sid': 'CIN', 'sname': 'CARROLL'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-92.8983388889, 40.6831805556], 'type': 'Point'}, 'id': 'TVK', 'properties': {'sid': 'TVK', 'sname': 'Centerville'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.3607694444, 41.0184305556], 'type': 'Point'}, 'id': 'CNC', 'properties': {'sid': 'CNC', 'sname': 'CHARITON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-92.6132222222, 43.0730055556], 'type': 'Point'}, 'id': 'CCY', 'properties': {'sid': 'CCY', 'sname': 'CHARLES CITY'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.553775, 42.7304194444], 'type': 'Point'}, 'id': 'CKP', 'properties': {'sid': 'CKP', 'sname': 'Cherokee'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.0222722222, 40.7241527778], 'type': 'Point'}, 'id': 'ICL', 'properties': {'sid': 'ICL', 'sname': 'CLARINDA'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.7592583333, 42.7430416667], 'type': 'Point'}, 'id': 'CAV', 'properties': {'sid': 'CAV', 'sname': 'CLARION'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-90.332796, 41.829504], 'type': 'Point'}, 'id': 'CWI', 'properties': {'sid': 'CWI', 'sname': 'CLINTON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.7604083333, 41.2611111111], 'type': 'Point'}, 'id': 'CBF', 'properties': {'sid': 'CBF', 'sname': 'COUNCIL BLUFFS'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-94.3607972222, 41.0187888889], 'type': 'Point'}, 'id': 'CSQ', 'properties': {'sid': 'CSQ', 'sname': 'CRESTON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.7433138889, 43.2755194444], 'type': 'Point'}, 'id': 'DEH', 'properties': {'sid': 'DEH', 'sname': 'DECORAH'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.3799888889, 41.9841944444], 'type': 'Point'}, 'id': 'DNS', 'properties': {'sid': 'DNS', 'sname': 'DENISON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.9834111111, 41.0520888889], 'type': 'Point'}, 'id': 'FFL', 'properties': {'sid': 'FFL', 'sname': 'FAIRFIELD'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.6236694444, 43.2323166667], 'type': 'Point'}, 'id': 'FXY', 'properties': {'sid': 'FXY', 'sname': 'Forest City'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-94.203203, 42.549741], 'type': 'Point'}, 'id': 'FOD', 'properties': {'sid': 'FOD', 'sname': 'FORT DODGE'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.3267166667, 40.6614833333], 'type': 'Point'}, 'id': 'FSW', 'properties': {'sid': 'FSW', 'sname': 'FORT MADISON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-92.7331972222, 41.7097305556], 'type': 'Point'}, 'id': 'GGI', 'properties': {'sid': 'GGI', 'sname': 'Grinnell'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.3354555556, 41.5834194444], 'type': 'Point'}, 'id': 'HNR', 'properties': {'sid': 'HNR', 'sname': 'HARLAN'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.9504, 42.4544277778], 'type': 'Point'}, 'id': 'IIB', 'properties': {'sid': 'IIB', 'sname': 'INDEPENDENCE'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.2650805556, 42.4690972222], 'type': 'Point'}, 'id': 'IFA', 'properties': {'sid': 'IFA', 'sname': 'Iowa Falls'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.4273916667, 40.4614611111], 'type': 'Point'}, 'id': 'EOK', 'properties': {'sid': 'EOK', 'sname': 'KEOKUK MUNI'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.1113916667, 41.2984472222], 'type': 'Point'}, 'id': 'OXV', 'properties': {'sid': 'OXV', 'sname': 'Knoxville'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-96.19225, 42.775375], 'type': 'Point'}, 'id': 'LRJ', 'properties': {'sid': 'LRJ', 'sname': 'LE MARS'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.1604555556, 42.2203611111], 'type': 'Point'}, 'id': 'MXO', 'properties': {'sid': 'MXO', 'sname': 'MONTICELLO MUNI'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.5122277778, 40.9452527778], 'type': 'Point'}, 'id': 'MPZ', 'properties': {'sid': 'MPZ', 'sname': 'MOUNT PLEASANT'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.140575, 41.3669944444], 'type': 'Point'}, 'id': 'MUT', 'properties': {'sid': 'MUT', 'sname': 'MUSCATINE'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.0190416667, 41.6701111111], 'type': 'Point'}, 'id': 'TNU', 'properties': {'sid': 'TNU', 'sname': 'NEWTON MUNI'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.9759888889, 42.6831388889], 'type': 'Point'}, 'id': 'OLZ', 'properties': {'sid': 'OLZ', 'sname': 'OELWEIN'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-96.0605861111, 42.9894916667], 'type': 'Point'}, 'id': 'ORC', 'properties': {'sid': 'ORC', 'sname': 'Orange City'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.6876138889, 41.0471722222], 'type': 'Point'}, 'id': 'I75', 'properties': {'sid': 'I75', 'sname': 'Osceola'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-92.4918666667, 41.227275], 'type': 'Point'}, 'id': 'OOA', 'properties': {'sid': 'OOA', 'sname': 'Oskaloosa'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-92.9431083333, 41.3989138889], 'type': 'Point'}, 'id': 'PEA', 'properties': {'sid': 'PEA', 'sname': 'PELLA'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-94.1637083333, 41.8277916667], 'type': 'Point'}, 'id': 'PRO', 'properties': {'sid': 'PRO', 'sname': 'Perry'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.2624111111, 41.01065], 'type': 'Point'}, 'id': 'RDK', 'properties': {'sid': 'RDK', 'sname': 'RED OAK'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.8353138889, 43.2081611111], 'type': 'Point'}, 'id': 'SHL', 'properties': {'sid': 'SHL', 'sname': 'SHELDON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.4112333333, 40.753275], 'type': 'Point'}, 'id': 'SDA', 'properties': {'sid': 'SDA', 'sname': 'SHENANDOAH MUNI'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-95.2399194444, 42.5972277778], 'type': 'Point'}, 'id': 'SLB', 'properties': {'sid': 'SLB', 'sname': 'Storm Lake'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-92.0248416667, 42.2175777778], 'type': 'Point'}, 'id': 'VTI', 'properties': {'sid': 'VTI', 'sname': 'VINTON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-91.6748111111, 41.2751444444], 'type': 'Point'}, 'id': 'AWG', 'properties': {'sid': 'AWG', 'sname': 'WASHINGTON'}, 'type': 'Feature'}, {'geometry': {'coordinates': [-93.8690777778, 42.4392305556], 'type': 'Point'}, 'id': 'EBS', 'properties': {'sid': 'EBS', 'sname': 'Webster City'}, 'type': 'Feature'}] stations = pd.io.json.json_normalize(js['features']).id url = (\"http://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?\" \"\u0026data=tmpf\u0026data=relh\u0026data=sped\u0026data=mslp\u0026data=p01i\u0026data=vsby\u0026data=gust_mph\u0026data=skyc1\u0026data=skyc2\u0026data=skyc3\" \"\u0026tz=Etc/UTC\u0026format=comma\u0026latlon=no\" \"\u0026{start:year1=%Y\u0026month1=%m\u0026day1=%d}\" \"\u0026{end:year2=%Y\u0026month2=%m\u0026day2=%d}\u0026{stations}\") stations = \"\u0026\".join(\"station=%s\" % s for s in stations) start = pd.Timestamp('2014-01-01') end=pd.Timestamp('2014-01-31') weather = (pd.read_csv(url.format(start=start, end=end, stations=stations), comment=\"#\")) import os ids = pd.concat([get_ids(network) for network in networks], ignore_index=True) gr = ids.groupby('network') os.makedirs(\"weather\", exist_ok=True) for i, (k, v) in enumerate(gr): print(\"{}/{}\".format(i, len(network)), end='\\r') weather = get_weather(v['id']) weather.to_csv(\"weather/{}.csv\".format(k)) weather = pd.concat([ pd.read_csv(f, parse_dates='date', index_col=['station', 'date']) for f in glob.glob('weather/*.csv')]) weather.to_hdf(\"weather.h5\", \"weather\") weather = pd.read_hdf(\"weather.h5\", \"weather\").sort_index() weather.head() tmpf relh sped mslp p01i vsby gust_mph skyc1 skyc2 skyc3 station date 01M 2014-01-01 00:15:00 33.80 85.86 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 00:35:00 33.44 87.11 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 00:55:00 32.54 90.97 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 01:15:00 31.82 93.65 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 01:35:00 32.00 92.97 0.0 NaN 0.0 10.0 NaN CLR M M OK, that was a bit of work. Here’s a plot to reward ourselves.\nairports = ['DSM', 'ORD', 'JFK', 'PDX'] g = sns.FacetGrid(weather.sort_index().loc[airports].reset_index(), col='station', hue='station', col_wrap=2, size=4) g.map(sns.regplot, 'sped', 'gust_mph') plt.savefig('../content/images/indexes_wind_gust_facet.png'); airports = ['DSM', 'ORD', 'JFK', 'PDX'] g = sns.FacetGrid(weather.sort_index().loc[airports].reset_index(), col='station', hue='station', col_wrap=2, size=4) g.map(sns.regplot, 'sped', 'gust_mph') plt.savefig('../content/images/indexes_wind_gust_facet.svg', transparent=True); Set Operations Indexes are set-like (technically multisets, since you can have duplicates), so they support most python set operations. Indexes are immutable so you won’t find any of the inplace set operations. One other difference is that since Indexes are also array like, you can’t use some infix operators like - for difference. If you have a numeric index it is unclear whether you intend to perform math operations or set operations. You can use \u0026 for intersetion, | for union, and ^ for symmetric difference though, since there’s no ambiguity.\nFor example, lets find the set of airports that we have weather and flight information on. Since weather had a MultiIndex of airport,datetime, we’ll use the levels attribute to get at the airport data, separate from the date data.\n# Bring in the flights data flights = pd.read_hdf('flights.h5', 'flights') weather_locs = weather.index.levels[0] # The `categories` attribute of a Categorical is an Index origin_locs = flights.origin.cat.categories dest_locs = flights.dest.cat.categories airports = weather_locs \u0026 origin_locs \u0026 dest_locs airports Index(['ABE', 'ABI', 'ABQ', 'ABR', 'ABY', 'ACT', 'ACV', 'AEX', 'AGS', 'ALB', ... 'TUL', 'TUS', 'TVC', 'TWF', 'TXK', 'TYR', 'TYS', 'VLD', 'VPS', 'XNA'], dtype='object', length=267) print(\"Weather, no flights:\\n\\t\", weather_locs.difference(origin_locs | dest_locs), end='\\n\\n') print(\"Flights, no weather:\\n\\t\", (origin_locs | dest_locs).difference(weather_locs), end='\\n\\n') print(\"Dropped Stations:\\n\\t\", (origin_locs | dest_locs) ^ weather_locs) Weather, no flights: Index(['01M', '04V', '04W', '05U', '06D', '08D', '0A9', '0CO', '0E0', '0F2', ... 'Y50', 'Y51', 'Y63', 'Y70', 'YIP', 'YKM', 'YKN', 'YNG', 'ZPH', 'ZZV'], dtype='object', length=1909) Flights, no weather: Index(['ADK', 'ADQ', 'ANC', 'BET', 'BKG', 'BQN', 'BRW', 'CDV', 'CLD', 'FAI', 'FCA', 'GUM', 'HNL', 'ITO', 'JNU', 'KOA', 'KTN', 'LIH', 'MQT', 'OGG', 'OME', 'OTZ', 'PPG', 'PSE', 'PSG', 'SCC', 'SCE', 'SIT', 'SJU', 'STT', 'STX', 'WRG', 'YAK', 'YUM'], dtype='object') Dropped Stations: Index(['01M', '04V', '04W', '05U', '06D', '08D', '0A9', '0CO', '0E0', '0F2', ... 'Y63', 'Y70', 'YAK', 'YIP', 'YKM', 'YKN', 'YNG', 'YUM', 'ZPH', 'ZZV'], dtype='object', length=1943) Flavors Pandas has many subclasses of the regular Index, each tailored to a specific kind of data. Most of the time these will be created for you automatically, so you don’t have to worry about which one to choose.\nIndex Int64Index RangeIndex (Memory-saving special case of Int64Index) FloatIndex DatetimeIndex: Datetime64[ns] precision data PeriodIndex: Regularly-spaced, arbitrary precision datetime data. TimedeltaIndex: Timedelta data CategoricalIndex: Some of these are purely optimizations, others use information about the data to provide additional methods. And while sometimes you might work with indexes directly (like the set operations above), most of they time you’ll be operating on a Series or DataFrame, which in turn makes use of its Index.\nRow Slicing We saw in part one that they’re great for making row subsetting as easy as column subsetting.\nweather.loc['DSM'].head() tmpf relh sped mslp p01i vsby gust_mph skyc1 skyc2 skyc3 date 2014-01-01 00:54:00 10.94 72.79 10.3 1024.9 0.0 10.0 NaN FEW M M 2014-01-01 01:54:00 10.94 72.79 11.4 1025.4 0.0 10.0 NaN OVC M M 2014-01-01 02:54:00 10.94 72.79 8.0 1025.3 0.0 10.0 NaN BKN M M 2014-01-01 03:54:00 10.94 72.79 9.1 1025.3 0.0 10.0 NaN OVC M M 2014-01-01 04:54:00 10.04 72.69 9.1 1024.7 0.0 10.0 NaN BKN M M Without indexes we’d probably resort to boolean masks.\nweather2 = weather.reset_index() weather2[weather2['station'] == 'DSM'].head() station date tmpf relh sped mslp p01i vsby gust_mph skyc1 skyc2 skyc3 884855 DSM 2014-01-01 00:54:00 10.94 72.79 10.3 1024.9 0.0 10.0 NaN FEW M M 884856 DSM 2014-01-01 01:54:00 10.94 72.79 11.4 1025.4 0.0 10.0 NaN OVC M M 884857 DSM 2014-01-01 02:54:00 10.94 72.79 8.0 1025.3 0.0 10.0 NaN BKN M M 884858 DSM 2014-01-01 03:54:00 10.94 72.79 9.1 1025.3 0.0 10.0 NaN OVC M M 884859 DSM 2014-01-01 04:54:00 10.04 72.69 9.1 1024.7 0.0 10.0 NaN BKN M M Slightly less convenient, but still doable.\nIndexes for Easier Arithmetic, Analysis It’s nice to have your metadata (labels on each observation) next to you actual values. But if you store them in an array, they’ll get in the way. Say we wanted to translate the farenheit temperature to celcius.\n# With indecies temp = weather['tmpf'] c = (temp - 32) * 5 / 9 c.to_frame() tmpf station date 01M 2014-01-01 00:15:00 1.0 2014-01-01 00:35:00 0.8 2014-01-01 00:55:00 0.3 2014-01-01 01:15:00 -0.1 2014-01-01 01:35:00 0.0 ... ... ... ZZV 2014-01-30 19:53:00 -2.8 2014-01-30 20:53:00 -2.2 2014-01-30 21:53:00 -2.2 2014-01-30 22:53:00 -2.8 2014-01-30 23:53:00 -1.7 3303647 rows × 1 columns\n# without temp2 = weather.reset_index()[['station', 'date', 'tmpf']] temp2['tmpf'] = (temp2['tmpf'] - 32) * 5 / 9 temp2.head() station date tmpf 0 01M 2014-01-01 00:15:00 1.0 1 01M 2014-01-01 00:35:00 0.8 2 01M 2014-01-01 00:55:00 0.3 3 01M 2014-01-01 01:15:00 -0.1 4 01M 2014-01-01 01:35:00 0.0 Again, not terrible, but not as good. And, what if you had wanted to keep farenheit around as well, instead of overwriting it like we did? Then you’d need to make a copy of everything, including the station and date columns. We don’t have that problem, since indexes are mutable and safely shared between DataFrames / Series.\ntemp.index is c.index True Indexes for Alignment I’ve saved the best for last. Automatic alignment, or reindexing, is fundamental to pandas.\nAll binary operations (add, multiply, etc…) between Series/DataFrames first align and then proceed.\nLet’s suppose we have hourly observations on temperature and windspeed. And suppose some of the observations were invalid, and not reported (simulated below by sampling from the full dataset). We’ll assume the missing windspeed observations were potentially different from the missing temperature observations.\ndsm = weather.loc['DSM'] hourly = dsm.resample('H').mean() temp = hourly['tmpf'].sample(frac=.5, random_state=1).sort_index() sped = hourly['sped'].sample(frac=.5, random_state=2).sort_index() temp.head().to_frame() tmpf date 2014-01-01 00:00:00 10.94 2014-01-01 02:00:00 10.94 2014-01-01 03:00:00 10.94 2014-01-01 04:00:00 10.04 2014-01-01 05:00:00 10.04 sped.head() date 2014-01-01 01:00:00 11.4 2014-01-01 02:00:00 8.0 2014-01-01 03:00:00 9.1 2014-01-01 04:00:00 9.1 2014-01-01 05:00:00 10.3 Name: sped, dtype: float64 Notice that the two indexes aren’t identical.\nSuppose that the windspeed : temperature ratio is meaningful. When we go to compute that, pandas will automatically align the two by index label.\nsped / temp date 2014-01-01 00:00:00 NaN 2014-01-01 01:00:00 NaN 2014-01-01 02:00:00 0.731261 2014-01-01 03:00:00 0.831810 2014-01-01 04:00:00 0.906375 ... 2014-01-30 13:00:00 NaN 2014-01-30 14:00:00 0.584712 2014-01-30 17:00:00 NaN 2014-01-30 21:00:00 NaN 2014-01-30 23:00:00 NaN dtype: float64 This lets you focus on doing the operation, rather than manually aligning things, ensuring that the arrays are the same length and in the same order. By deault, missing values are inserted where the two don’t align. You can use the method version of any binary operation to specify a fill_value\nsped.div(temp, fill_value=1) date 2014-01-01 00:00:00 0.091408 2014-01-01 01:00:00 11.400000 2014-01-01 02:00:00 0.731261 2014-01-01 03:00:00 0.831810 2014-01-01 04:00:00 0.906375 ... 2014-01-30 13:00:00 0.027809 2014-01-30 14:00:00 0.584712 2014-01-30 17:00:00 0.023267 2014-01-30 21:00:00 0.035663 2014-01-30 23:00:00 13.700000 dtype: float64 And since I couldn’t find anywhere else to put it, you can control the axis the operation is aligned along as well.\nhourly.div(sped, axis='index') tmpf relh sped mslp p01i vsby gust_mph date 2014-01-01 00:00:00 NaN NaN NaN NaN NaN NaN NaN 2014-01-01 01:00:00 0.959649 6.385088 1.0 89.947368 0.0 0.877193 NaN 2014-01-01 02:00:00 1.367500 9.098750 1.0 128.162500 0.0 1.250000 NaN 2014-01-01 03:00:00 1.202198 7.998901 1.0 112.670330 0.0 1.098901 NaN 2014-01-01 04:00:00 1.103297 7.987912 1.0 112.604396 0.0 1.098901 NaN ... ... ... ... ... ... ... ... 2014-01-30 19:00:00 NaN NaN NaN NaN NaN NaN NaN 2014-01-30 20:00:00 NaN NaN NaN NaN NaN NaN NaN 2014-01-30 21:00:00 NaN NaN NaN NaN NaN NaN NaN 2014-01-30 22:00:00 NaN NaN NaN NaN NaN NaN NaN 2014-01-30 23:00:00 1.600000 4.535036 1.0 73.970803 0.0 0.729927 NaN 720 rows × 7 columns\nThe non row-labeled version of this is messy.\ntemp2 = temp.reset_index() sped2 = sped.reset_index() # Find rows where the operation is defined common_dates = pd.Index(temp2.date) \u0026 sped2.date pd.concat([ # concat to not lose date information sped2.loc[sped2['date'].isin(common_dates), 'date'], (sped2.loc[sped2.date.isin(common_dates), 'sped'] / temp2.loc[temp2.date.isin(common_dates), 'tmpf'])], axis=1).dropna(how='all') date 0 1 2014-01-01 02:00:00 0.731261 2 2014-01-01 03:00:00 0.831810 3 2014-01-01 04:00:00 0.906375 4 2014-01-01 05:00:00 1.025896 8 2014-01-01 13:00:00 NaN ... ... ... 351 2014-01-29 23:00:00 0.535609 354 2014-01-30 05:00:00 0.487735 356 2014-01-30 09:00:00 NaN 357 2014-01-30 10:00:00 0.618939 358 2014-01-30 14:00:00 NaN 170 rows × 2 columns\nYeah, I prefer the temp / sped version.\nAlignment isn’t limited to arithmetic operations, although those are the most obvious and easiest to demonstrate.\nMerging There are two ways of merging DataFrames / Series in pandas\nRelational Database style with pd.merge Array style with pd.concat Personally, I think in terms of the concat style. I learned pandas before I ever really used SQL, so it comes more naturally to me I suppose. pd.merge has more flexibilty, though I think most of the time you don’t need this flexibilty.\nConcat Version pd.concat([temp, sped], axis=1).head() tmpf sped date 2014-01-01 00:00:00 10.94 NaN 2014-01-01 01:00:00 NaN 11.4 2014-01-01 02:00:00 10.94 8.0 2014-01-01 03:00:00 10.94 9.1 2014-01-01 04:00:00 10.04 9.1 The axis parameter controls how the data should be stacked, 0 for vertically, 1 for horizontally. The join parameter controls the merge behavior on the shared axis, (the Index for axis=1). By default it’s like a union of the two indexes, or an outer join.\npd.concat([temp, sped], axis=1, join='inner') tmpf sped date 2014-01-01 02:00:00 10.94 8.000 2014-01-01 03:00:00 10.94 9.100 2014-01-01 04:00:00 10.04 9.100 2014-01-01 05:00:00 10.04 10.300 2014-01-01 13:00:00 8.96 13.675 ... ... ... 2014-01-29 23:00:00 35.96 18.200 2014-01-30 05:00:00 33.98 17.100 2014-01-30 09:00:00 35.06 16.000 2014-01-30 10:00:00 35.06 21.700 2014-01-30 14:00:00 35.06 20.500 170 rows × 2 columns\nMerge Version Since we’re joining by index here the merge version is quite similar. We’ll see an example later of a one-to-many join where the two differ.\npd.merge(temp.to_frame(), sped.to_frame(), left_index=True, right_index=True).head() tmpf sped date 2014-01-01 02:00:00 10.94 8.000 2014-01-01 03:00:00 10.94 9.100 2014-01-01 04:00:00 10.04 9.100 2014-01-01 05:00:00 10.04 10.300 2014-01-01 13:00:00 8.96 13.675 pd.merge(temp.to_frame(), sped.to_frame(), left_index=True, right_index=True, how='outer').head() tmpf sped date 2014-01-01 00:00:00 10.94 NaN 2014-01-01 01:00:00 NaN 11.4 2014-01-01 02:00:00 10.94 8.0 2014-01-01 03:00:00 10.94 9.1 2014-01-01 04:00:00 10.04 9.1 Like I said, I typically prefer concat to merge. The exception here is one-to-many type joins. Let’s walk through one of those, where we join the flight data to the weather data. To focus just on the merge, we’ll aggregate hour weather data to be daily, rather than trying to find the closest recorded weather observation to each departure (you could do that, but it’s not the focus right now). We’ll then join the one (airport, date) record to the many (airport, date, flight) records.\nQuick tangent, to get the weather data to daily frequency, we’ll need to resample (more on that in the timeseries section). The resample essentially involves breaking the recorded values into daily buckets and computing the aggregation function on each bucket. The only wrinkle is that we have to resample by station, so we’ll use the pd.TimeGrouper helper.\nidx_cols = ['unique_carrier', 'origin', 'dest', 'tail_num', 'fl_num', 'fl_date'] data_cols = ['crs_dep_time', 'dep_delay', 'crs_arr_time', 'arr_delay', 'taxi_out', 'taxi_in', 'wheels_off', 'wheels_on', 'distance'] df = flights.set_index(idx_cols)[data_cols].sort_index() def mode(x): ''' Arbitrarily break ties. ''' return x.value_counts().index[0] aggfuncs = {'tmpf': 'mean', 'relh': 'mean', 'sped': 'mean', 'mslp': 'mean', 'p01i': 'mean', 'vsby': 'mean', 'gust_mph': 'mean', 'skyc1': mode, 'skyc2': mode, 'skyc3': mode} # TimeGrouper works on a DatetimeIndex, so we move `station` to the # columns and then groupby it as well. daily = (weather.reset_index(level=\"station\") .groupby([pd.TimeGrouper('1d'), \"station\"]) .agg(aggfuncs)) daily.head() gust_mph vsby sped relh skyc1 tmpf skyc2 mslp p01i skyc3 date station 2014-01-01 01M NaN 9.229167 2.262500 81.117917 CLR 35.747500 M NaN 0.0 M 04V 31.307143 9.861111 11.131944 72.697778 CLR 18.350000 M NaN 0.0 M 04W NaN 10.000000 3.601389 69.908056 OVC -9.075000 M NaN 0.0 M 05U NaN 9.929577 3.770423 71.519859 CLR 26.321127 M NaN 0.0 M 06D NaN 9.576389 5.279167 73.784179 CLR -11.388060 M NaN 0.0 M The merge version m = pd.merge(flights, daily.reset_index().rename(columns={'date': 'fl_date', 'station': 'origin'}), on=['fl_date', 'origin']).set_index(idx_cols).sort_index() m.head() airline_id origin_airport_id origin_airport_seq_id origin_city_market_id origin_city_name origin_state_nm dest_airport_id dest_airport_seq_id dest_city_market_id dest_city_name ... gust_mph vsby sped relh skyc1 tmpf skyc2 mslp p01i skyc3 unique_carrier origin dest tail_num fl_num fl_date AA ABQ DFW N200AA 1090 2014-01-27 19805 10140 1014002 30140 Albuquerque, NM New Mexico 11298 1129803 30194 Dallas/Fort Worth, TX ... NaN 10.0 6.737500 34.267500 SCT 41.8325 M 1014.620833 0.0 M 1662 2014-01-06 19805 10140 1014002 30140 Albuquerque, NM New Mexico 11298 1129803 30194 Dallas/Fort Worth, TX ... NaN 10.0 9.270833 27.249167 CLR 28.7900 M 1029.016667 0.0 M N202AA 1332 2014-01-27 19805 10140 1014002 30140 Albuquerque, NM New Mexico 11298 1129803 30194 Dallas/Fort Worth, TX ... NaN 10.0 6.737500 34.267500 SCT 41.8325 M 1014.620833 0.0 M N426AA 1467 2014-01-15 19805 10140 1014002 30140 Albuquerque, NM New Mexico 11298 1129803 30194 Dallas/Fort Worth, TX ... NaN 10.0 6.216667 34.580000 FEW 40.2500 M 1027.800000 0.0 M 1662 2014-01-09 19805 10140 1014002 30140 Albuquerque, NM New Mexico 11298 1129803 30194 Dallas/Fort Worth, TX ... NaN 10.0 3.087500 42.162500 FEW 34.6700 M 1018.379167 0.0 M 5 rows × 40 columns\nm.sample(n=10000).pipe((sns.jointplot, 'data'), 'sped', 'dep_delay') plt.savefig('../content/images/indexes_sped_delay_join.svg', transparent=True) m.groupby('skyc1').dep_delay.agg(['mean', 'count']).sort_values(by='mean') mean count skyc1 M -1.948052 77 CLR 11.222288 115121 FEW 16.863177 161727 SCT 17.803048 19289 BKN 18.638034 54030 OVC 21.667762 52643 VV 30.487008 9583 import statsmodels.api as sm mod = sm.OLS.from_formula('dep_delay ~ C(skyc1) + distance + tmpf + relh + sped + mslp', data=m) res = mod.fit() res.summary() OLS Regression Results Dep. Variable: dep_delay R-squared: 0.026 Model: OLS Adj. R-squared: 0.025 Method: Least Squares F-statistic: 976.4 Date: Sun, 10 Apr 2016 Prob (F-statistic): 0.00 Time: 16:06:15 Log-Likelihood: -2.1453e+06 No. Observations: 410372 AIC: 4.291e+06 Df Residuals: 410360 BIC: 4.291e+06 Df Model: 11 Covariance Type: nonrobust coef std err t P\u003e|t| [95.0% Conf. Int.] Intercept -331.1032 10.828 -30.577 0.000 -352.327 -309.880 C(skyc1)[T.CLR] -4.4041 0.249 -17.662 0.000 -4.893 -3.915 C(skyc1)[T.FEW] -0.7330 0.226 -3.240 0.001 -1.176 -0.290 C(skyc1)[T.M] -16.4341 8.681 -1.893 0.058 -33.448 0.580 C(skyc1)[T.OVC] 0.3818 0.281 1.358 0.174 -0.169 0.933 C(skyc1)[T.SCT] 0.8589 0.380 2.260 0.024 0.114 1.604 C(skyc1)[T.VV ] 8.8603 0.509 17.414 0.000 7.863 9.858 distance 0.0008 0.000 6.174 0.000 0.001 0.001 tmpf -0.1841 0.005 -38.390 0.000 -0.193 -0.175 relh 0.1626 0.004 38.268 0.000 0.154 0.171 sped 0.6096 0.018 33.716 0.000 0.574 0.645 mslp 0.3340 0.010 31.960 0.000 0.313 0.354 Omnibus: 456713.147 Durbin-Watson: 1.872 Prob(Omnibus): 0.000 Jarque-Bera (JB): 76162962.824 Skew: 5.535 Prob(JB): 0.00 Kurtosis: 68.816 Cond. No. 2.07e+05 fig, ax = plt.subplots() ax.scatter(res.fittedvalues, res.resid, color='k', marker='.', alpha=.25) ax.set(xlabel='Predicted', ylabel='Residual') sns.despine() plt.savefig('../content/images/indexes_resid_fit.png', transparent=True) weather.head() tmpf relh sped mslp p01i vsby gust_mph skyc1 skyc2 skyc3 station date 01M 2014-01-01 00:15:00 33.80 85.86 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 00:35:00 33.44 87.11 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 00:55:00 32.54 90.97 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 01:15:00 31.82 93.65 0.0 NaN 0.0 10.0 NaN CLR M M 2014-01-01 01:35:00 32.00 92.97 0.0 NaN 0.0 10.0 NaN CLR M M import numpy as np import pandas as pd def read(fp): df = (pd.read_csv(fp) .rename(columns=str.lower) .drop('unnamed: 36', axis=1) .pipe(extract_city_name) .pipe(time_to_datetime, ['dep_time', 'arr_time', 'crs_arr_time', 'crs_dep_time']) .assign(fl_date=lambda x: pd.to_datetime(x['fl_date']), dest=lambda x: pd.Categorical(x['dest']), origin=lambda x: pd.Categorical(x['origin']), tail_num=lambda x: pd.Categorical(x['tail_num']), unique_carrier=lambda x: pd.Categorical(x['unique_carrier']), cancellation_code=lambda x: pd.Categorical(x['cancellation_code']))) return df def extract_city_name(df): ''' Chicago, IL -\u003e Chicago for origin_city_name and dest_city_name ''' cols = ['origin_city_name', 'dest_city_name'] city = df[cols].apply(lambda x: x.str.extract(\"(.*), \\w{2}\", expand=False)) df = df.copy() df[['origin_city_name', 'dest_city_name']] = city return df def time_to_datetime(df, columns): ''' Combine all time items into datetimes. 2014-01-01,0914 -\u003e 2014-01-01 09:14:00 ''' df = df.copy() def converter(col): timepart = (col.astype(str) .str.replace('\\.0$', '') # NaNs force float dtype .str.pad(4, fillchar='0')) return pd.to_datetime(df['fl_date'] + ' ' + timepart.str.slice(0, 2) + ':' + timepart.str.slice(2, 4), errors='coerce') return datetime_part df[columns] = df[columns].apply(converter) return df flights = read(\"878167309_T_ONTIME.csv\") locs = weather.index.levels[0] \u0026 flights.origin.unique() (weather.reset_index(level='station') .query('station in @locs') .groupby(['station', pd.TimeGrouper('H')])).mean() tmpf relh sped mslp p01i vsby gust_mph station date ABE 2014-01-01 00:00:00 26.06 47.82 14.8 1024.4 0.0 10.0 21.7 2014-01-01 01:00:00 24.08 51.93 8.0 1025.2 0.0 10.0 NaN 2014-01-01 02:00:00 24.08 49.87 6.8 1025.7 0.0 10.0 NaN 2014-01-01 03:00:00 23.00 52.18 9.1 1026.2 0.0 10.0 NaN 2014-01-01 04:00:00 23.00 52.18 4.6 1026.4 0.0 10.0 NaN ... ... ... ... ... ... ... ... ... XNA 2014-01-30 19:00:00 44.96 38.23 16.0 1009.7 0.0 10.0 25.1 2014-01-30 20:00:00 46.04 41.74 16.0 1010.3 0.0 10.0 NaN 2014-01-30 21:00:00 46.04 41.74 13.7 1010.9 0.0 10.0 20.5 2014-01-30 22:00:00 42.98 46.91 11.4 1011.5 0.0 10.0 NaN 2014-01-30 23:00:00 39.92 54.81 3.4 1012.2 0.0 10.0 NaN 191445 rows × 7 columns\ndf = (flights.copy()[['unique_carrier', 'tail_num', 'origin', 'dep_time']] .query('origin in @locs')) weather.loc['DSM'] tmpf relh sped mslp p01i vsby gust_mph skyc1 skyc2 skyc3 date 2014-01-01 00:54:00 10.94 72.79 10.3 1024.9 0.0 10.0 NaN FEW M M 2014-01-01 01:54:00 10.94 72.79 11.4 1025.4 0.0 10.0 NaN OVC M M 2014-01-01 02:54:00 10.94 72.79 8.0 1025.3 0.0 10.0 NaN BKN M M 2014-01-01 03:54:00 10.94 72.79 9.1 1025.3 0.0 10.0 NaN OVC M M 2014-01-01 04:54:00 10.04 72.69 9.1 1024.7 0.0 10.0 NaN BKN M M ... ... ... ... ... ... ... ... ... ... ... 2014-01-30 19:54:00 30.92 55.99 28.5 1006.3 0.0 10.0 35.3 FEW FEW M 2014-01-30 20:54:00 30.02 55.42 14.8 1008.4 0.0 10.0 28.5 FEW FEW M 2014-01-30 21:54:00 28.04 55.12 18.2 1010.4 0.0 10.0 26.2 FEW FEW M 2014-01-30 22:54:00 26.06 57.04 13.7 1011.8 0.0 10.0 NaN FEW FEW M 2014-01-30 23:54:00 21.92 62.13 13.7 1013.4 0.0 10.0 NaN FEW FEW M 896 rows × 10 columns\ndf = df fl_date unique_carrier airline_id tail_num fl_num origin_airport_id origin_airport_seq_id origin_city_market_id origin origin_city_name ... arr_delay cancelled cancellation_code diverted distance carrier_delay weather_delay nas_delay security_delay late_aircraft_delay 0 2014-01-01 AA 19805 N338AA 1 12478 1247802 31703 JFK New York ... 13.0 0.0 NaN 0.0 2475.0 NaN NaN NaN NaN NaN 1 2014-01-01 AA 19805 N339AA 2 12892 1289203 32575 LAX Los Angeles ... 111.0 0.0 NaN 0.0 2475.0 111.0 0.0 0.0 0.0 0.0 2 2014-01-01 AA 19805 N335AA 3 12478 1247802 31703 JFK New York ... 13.0 0.0 NaN 0.0 2475.0 NaN NaN NaN NaN NaN 3 2014-01-01 AA 19805 N367AA 5 11298 1129803 30194 DFW Dallas/Fort Worth ... 1.0 0.0 NaN 0.0 3784.0 NaN NaN NaN NaN NaN 4 2014-01-01 AA 19805 N364AA 6 13830 1383002 33830 OGG Kahului ... -8.0 0.0 NaN 0.0 3711.0 NaN NaN NaN NaN NaN ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 471944 2014-01-31 OO 20304 N292SW 5313 12889 1288903 32211 LAS Las Vegas ... -7.0 0.0 NaN 0.0 259.0 NaN NaN NaN NaN NaN 471945 2014-01-31 OO 20304 N580SW 5314 12892 1289203 32575 LAX Los Angeles ... -12.0 0.0 NaN 0.0 89.0 NaN NaN NaN NaN NaN 471946 2014-01-31 OO 20304 N580SW 5314 14689 1468902 34689 SBA Santa Barbara ... 11.0 0.0 NaN 0.0 89.0 NaN NaN NaN NaN NaN 471947 2014-01-31 OO 20304 N216SW 5315 11292 1129202 30325 DEN Denver ... 56.0 0.0 NaN 0.0 260.0 36.0 0.0 13.0 0.0 7.0 471948 2014-01-31 OO 20304 N216SW 5315 14543 1454302 34543 RKS Rock Springs ... 47.0 0.0 NaN 0.0 260.0 0.0 0.0 4.0 0.0 43.0 471949 rows × 36 columns\ndep.head() 0 2014-01-01 09:14:00 1 2014-01-01 11:32:00 2 2014-01-01 11:57:00 3 2014-01-01 13:07:00 4 2014-01-01 17:53:00 ... 163906 2014-01-11 16:57:00 163910 2014-01-11 11:04:00 181062 2014-01-12 17:02:00 199092 2014-01-13 23:36:00 239150 2014-01-16 16:46:00 Name: dep_time, dtype: datetime64[ns] flights.dep_time 0 2014-01-01 09:14:00 1 2014-01-01 11:32:00 2 2014-01-01 11:57:00 3 2014-01-01 13:07:00 4 2014-01-01 17:53:00 ... 471944 2014-01-31 09:05:00 471945 2014-01-31 09:24:00 471946 2014-01-31 10:39:00 471947 2014-01-31 09:28:00 471948 2014-01-31 11:22:00 Name: dep_time, dtype: datetime64[ns] flights.dep_time.unique() array(['2014-01-01T03:14:00.000000000-0600', '2014-01-01T05:32:00.000000000-0600', '2014-01-01T05:57:00.000000000-0600', ..., '2014-01-30T18:44:00.000000000-0600', '2014-01-31T17:16:00.000000000-0600', '2014-01-30T18:47:00.000000000-0600'], dtype='datetime64[ns]') stations flights.dep_time.head() 0 2014-01-01 09:14:00 1 2014-01-01 11:32:00 2 2014-01-01 11:57:00 3 2014-01-01 13:07:00 4 2014-01-01 17:53:00 Name: dep_time, dtype: datetime64[ns] ","wordCount":"4553","inLanguage":"en","datePublished":"2016-04-11T00:00:00Z","dateModified":"2016-04-11T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomaugspurger.net/posts/modern-3-indexes/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://tomaugspurger.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomaugspurger.net accesskey=h title="Tom's Blog (Alt + H)">Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tomaugspurger.net/about/ title=About><span>About</span></a></li><li><a href=https://tomaugspurger.net/archives title=Archive><span>Archive</span></a></li><li><a href=https://tomaugspurger.net/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://tomaugspurger.net/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Modern Panadas (Part 3): Indexes</h1><div class=post-meta><span title='2016-04-11 00:00:00 +0000 UTC'>April 11, 2016</span></div></header><div class=post-content><hr><p>This is part 3 in my series on writing modern idiomatic pandas.</p><ul><li><a href=/posts/modern-1-intro>Modern Pandas</a></li><li><a href=/posts/method-chaining>Method Chaining</a></li><li><a href=/posts/modern-3-indexes>Indexes</a></li><li><a href=/posts/modern-4-performance>Fast Pandas</a></li><li><a href=/posts/modern-5-tidy>Tidy Data</a></li><li><a href=/posts/modern-6-visualization>Visualization</a></li><li><a href=/posts/modern-7-timeseries>Time Series</a></li><li><a href=/posts/modern-8-scaling>Scaling</a></li></ul><hr><p><code>Indexes</code> can be a difficult concept to grasp at first.
I suspect this is partly becuase they&rsquo;re somewhat peculiar to pandas.
These aren&rsquo;t like the indexes put on relational database tables for performance optimizations.
Rather, they&rsquo;re more like the <code>row_labels</code> of an R DataFrame, but much more capable.</p><p><code>Indexes</code> offer</p><ul><li>metadata container</li><li>easy label-based row selection</li><li>easy label-based alignment in operations</li><li>label-based concatenation</li></ul><p>To demonstrate these, we&rsquo;ll first fetch some more data.
This will be weather data from sensors at a bunch of airports across the US.
See <a href=https://github.com/akrherz/iem/blob/master/scripts/asos/iem_scraper_example.py>here</a> for the example scraper I based this off of.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%</span>matplotlib inline
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> json
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> glob
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> datetime
</span></span><span style=display:flex><span><span style=color:#f92672>from</span> io <span style=color:#f92672>import</span> StringIO
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> seaborn <span style=color:#66d9ef>as</span> sns
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>set_style(<span style=color:#e6db74>&#39;ticks&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># States are broken into networks. The networks have a list of ids, each representing a station.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># We will take that list of ids and pass them as query parameters to the URL we built up ealier.</span>
</span></span><span style=display:flex><span>states <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;AK AL AR AZ CA CO CT DE FL GA HI IA ID IL IN KS KY LA MA MD ME
</span></span></span><span style=display:flex><span><span style=color:#e6db74> MI MN MO MS MT NC ND NE NH NJ NM NV NY OH OK OR PA RI SC SD TN TX UT VA VT
</span></span></span><span style=display:flex><span><span style=color:#e6db74> WA WI WV WY&#34;&#34;&#34;</span><span style=color:#f92672>.</span>split()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># IEM has Iowa AWOS sites in its own labeled network</span>
</span></span><span style=display:flex><span>networks <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;AWOS&#39;</span>] <span style=color:#f92672>+</span> [<span style=color:#e6db74>&#39;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>_ASOS&#39;</span><span style=color:#f92672>.</span>format(state) <span style=color:#66d9ef>for</span> state <span style=color:#f92672>in</span> states]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_weather</span>(stations, start<span style=color:#f92672>=</span>pd<span style=color:#f92672>.</span>Timestamp(<span style=color:#e6db74>&#39;2014-01-01&#39;</span>),
</span></span><span style=display:flex><span>                end<span style=color:#f92672>=</span>pd<span style=color:#f92672>.</span>Timestamp(<span style=color:#e6db74>&#39;2014-01-31&#39;</span>)):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Fetch weather data from MESONet between ``start`` and ``stop``.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#34;http://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#e6db74>&#34;&amp;data=tmpf&amp;data=relh&amp;data=sped&amp;data=mslp&amp;data=p01i&amp;data=vsby&amp;data=gust_mph&amp;data=skyc1&amp;data=skyc2&amp;data=skyc3&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#e6db74>&#34;&amp;tz=Etc/UTC&amp;format=comma&amp;latlon=no&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#e6db74>&#34;&amp;{start:year1=%Y&amp;month1=%m&amp;day1=</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>}&#34;</span>
</span></span><span style=display:flex><span>           <span style=color:#e6db74>&#34;&amp;{end:year2=%Y&amp;month2=%m&amp;day2=</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>}&amp;</span><span style=color:#e6db74>{stations}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>    stations <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&amp;&#34;</span><span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#34;station=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> s <span style=color:#66d9ef>for</span> s <span style=color:#f92672>in</span> stations)
</span></span><span style=display:flex><span>    weather <span style=color:#f92672>=</span> (pd<span style=color:#f92672>.</span>read_csv(url<span style=color:#f92672>.</span>format(start<span style=color:#f92672>=</span>start, end<span style=color:#f92672>=</span>end, stations<span style=color:#f92672>=</span>stations),
</span></span><span style=display:flex><span>                           comment<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#&#34;</span>)
</span></span><span style=display:flex><span>                 <span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;valid&#34;</span>: <span style=color:#e6db74>&#34;date&#34;</span>})
</span></span><span style=display:flex><span>                 <span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>str<span style=color:#f92672>.</span>strip)
</span></span><span style=display:flex><span>                 <span style=color:#f92672>.</span>assign(date<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> df: pd<span style=color:#f92672>.</span>to_datetime(df[<span style=color:#e6db74>&#39;date&#39;</span>]))
</span></span><span style=display:flex><span>                 <span style=color:#f92672>.</span>set_index([<span style=color:#e6db74>&#34;station&#34;</span>, <span style=color:#e6db74>&#34;date&#34;</span>])
</span></span><span style=display:flex><span>                 <span style=color:#f92672>.</span>sort_index())
</span></span><span style=display:flex><span>    float_cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;tmpf&#39;</span>, <span style=color:#e6db74>&#39;relh&#39;</span>, <span style=color:#e6db74>&#39;sped&#39;</span>, <span style=color:#e6db74>&#39;mslp&#39;</span>, <span style=color:#e6db74>&#39;p01i&#39;</span>, <span style=color:#e6db74>&#39;vsby&#39;</span>, <span style=color:#e6db74>&#34;gust_mph&#34;</span>]
</span></span><span style=display:flex><span>    weather[float_cols] <span style=color:#f92672>=</span> weather[float_cols]<span style=color:#f92672>.</span>apply(pd<span style=color:#f92672>.</span>to_numeric, errors<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;corce&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> weather
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>get_ids</span>(network):
</span></span><span style=display:flex><span>    url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://mesonet.agron.iastate.edu/geojson/network.php?network=</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url<span style=color:#f92672>.</span>format(network))
</span></span><span style=display:flex><span>    md <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>io<span style=color:#f92672>.</span>json<span style=color:#f92672>.</span>json_normalize(r<span style=color:#f92672>.</span>json()[<span style=color:#e6db74>&#39;features&#39;</span>])
</span></span><span style=display:flex><span>    md[<span style=color:#e6db74>&#39;network&#39;</span>] <span style=color:#f92672>=</span> network
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> md
</span></span></code></pre></div><p>Talk briefly about the gem of a method that is <code>json_normalize</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;http://mesonet.agron.iastate.edu/geojson/network.php?network=</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>r <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(url<span style=color:#f92672>.</span>format(<span style=color:#e6db74>&#34;AWOS&#34;</span>))
</span></span><span style=display:flex><span>js <span style=color:#f92672>=</span> r<span style=color:#f92672>.</span>json()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>js[<span style=color:#e6db74>&#39;features&#39;</span>][:<span style=color:#ae81ff>2</span>]
</span></span></code></pre></div><pre><code>[{'geometry': {'coordinates': [-94.2723694444, 43.0796472222],
   'type': 'Point'},
  'id': 'AXA',
  'properties': {'sid': 'AXA', 'sname': 'ALGONA'},
  'type': 'Feature'},
 {'geometry': {'coordinates': [-93.569475, 41.6878083333], 'type': 'Point'},
  'id': 'IKV',
  'properties': {'sid': 'IKV', 'sname': 'ANKENY'},
  'type': 'Feature'}]
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pd<span style=color:#f92672>.</span>DataFrame(js[<span style=color:#e6db74>&#39;features&#39;</span>])<span style=color:#f92672>.</span>head()<span style=color:#f92672>.</span>to_html()
</span></span></code></pre></div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>geometry</th><th>id</th><th>properties</th><th>type</th></tr></thead><tbody><tr><th>0</th><td>{\'coordinates\': [-94.2723694444, 43.0796472222...</td><td>AXA</td><td>{\'sname\': \'ALGONA\', \'sid\': \'AXA\'}</td><td>Feature</td></tr><tr><th>1</th><td>{\'coordinates\': [-93.569475, 41.6878083333], \'...</td><td>IKV</td><td>{\'sname\': \'ANKENY\', \'sid\': \'IKV\'}</td><td>Feature</td></tr><tr><th>2</th><td>{\'coordinates\': [-95.0465277778, 41.4058805556...</td><td>AIO</td><td>{\'sname\': \'ATLANTIC\', \'sid\': \'AIO\'}</td><td>Feature</td></tr><tr><th>3</th><td>{\'coordinates\': [-94.9204416667, 41.6993527778...</td><td>ADU</td><td>{\'sname\': \'AUDUBON\', \'sid\': \'ADU\'}</td><td>Feature</td></tr><tr><th>4</th><td>{\'coordinates\': [-93.848575, 42.0485694444], \'...</td><td>BNW</td><td>{\'sname\': \'BOONE MUNI\', \'sid\': \'BNW\'}</td><td>Feature</td></tr></tbody></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>js[<span style=color:#e6db74>&#39;features&#39;</span>][<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;geometry&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>94.2723694444</span>, <span style=color:#ae81ff>43.0796472222</span>],
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;AXA&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;properties&#39;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;AXA&#39;</span>,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;ALGONA&#39;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>js[<span style=color:#e6db74>&#39;features&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>94.2723694444</span>, <span style=color:#ae81ff>43.0796472222</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;AXA&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;AXA&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;ALGONA&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.569475</span>, <span style=color:#ae81ff>41.6878083333</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;IKV&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;IKV&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;ANKENY&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.0465277778</span>, <span style=color:#ae81ff>41.4058805556</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;AIO&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;AIO&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;ATLANTIC&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>94.9204416667</span>, <span style=color:#ae81ff>41.6993527778</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;ADU&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;ADU&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;AUDUBON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.848575</span>, <span style=color:#ae81ff>42.0485694444</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;BNW&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;BNW&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;BOONE MUNI&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>94.7888805556</span>, <span style=color:#ae81ff>42.0443611111</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CIN&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CIN&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;CARROLL&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>92.8983388889</span>, <span style=color:#ae81ff>40.6831805556</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;TVK&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;TVK&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Centerville&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.3607694444</span>, <span style=color:#ae81ff>41.0184305556</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CNC&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CNC&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;CHARITON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>92.6132222222</span>, <span style=color:#ae81ff>43.0730055556</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CCY&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CCY&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;CHARLES CITY&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.553775</span>, <span style=color:#ae81ff>42.7304194444</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CKP&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CKP&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Cherokee&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.0222722222</span>, <span style=color:#ae81ff>40.7241527778</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;ICL&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;ICL&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;CLARINDA&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.7592583333</span>, <span style=color:#ae81ff>42.7430416667</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CAV&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CAV&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;CLARION&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>90.332796</span>, <span style=color:#ae81ff>41.829504</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CWI&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CWI&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;CLINTON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.7604083333</span>, <span style=color:#ae81ff>41.2611111111</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CBF&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CBF&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;COUNCIL BLUFFS&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>94.3607972222</span>, <span style=color:#ae81ff>41.0187888889</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;CSQ&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;CSQ&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;CRESTON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.7433138889</span>, <span style=color:#ae81ff>43.2755194444</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;DEH&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;DEH&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;DECORAH&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.3799888889</span>, <span style=color:#ae81ff>41.9841944444</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;DNS&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;DNS&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;DENISON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.9834111111</span>, <span style=color:#ae81ff>41.0520888889</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;FFL&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;FFL&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;FAIRFIELD&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.6236694444</span>, <span style=color:#ae81ff>43.2323166667</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;FXY&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;FXY&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Forest City&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>94.203203</span>, <span style=color:#ae81ff>42.549741</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;FOD&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;FOD&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;FORT DODGE&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.3267166667</span>, <span style=color:#ae81ff>40.6614833333</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;FSW&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;FSW&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;FORT MADISON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>92.7331972222</span>, <span style=color:#ae81ff>41.7097305556</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;GGI&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;GGI&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Grinnell&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.3354555556</span>, <span style=color:#ae81ff>41.5834194444</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;HNR&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;HNR&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;HARLAN&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.9504</span>, <span style=color:#ae81ff>42.4544277778</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;IIB&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;IIB&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;INDEPENDENCE&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.2650805556</span>, <span style=color:#ae81ff>42.4690972222</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;IFA&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;IFA&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Iowa Falls&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.4273916667</span>, <span style=color:#ae81ff>40.4614611111</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;EOK&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;EOK&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;KEOKUK MUNI&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.1113916667</span>, <span style=color:#ae81ff>41.2984472222</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;OXV&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;OXV&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Knoxville&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>96.19225</span>, <span style=color:#ae81ff>42.775375</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;LRJ&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;LRJ&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;LE MARS&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.1604555556</span>, <span style=color:#ae81ff>42.2203611111</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;MXO&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;MXO&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;MONTICELLO MUNI&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.5122277778</span>, <span style=color:#ae81ff>40.9452527778</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;MPZ&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;MPZ&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;MOUNT PLEASANT&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.140575</span>, <span style=color:#ae81ff>41.3669944444</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;MUT&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;MUT&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;MUSCATINE&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.0190416667</span>, <span style=color:#ae81ff>41.6701111111</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;TNU&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;TNU&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;NEWTON MUNI&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.9759888889</span>, <span style=color:#ae81ff>42.6831388889</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;OLZ&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;OLZ&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;OELWEIN&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>96.0605861111</span>, <span style=color:#ae81ff>42.9894916667</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;ORC&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;ORC&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Orange City&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.6876138889</span>, <span style=color:#ae81ff>41.0471722222</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;I75&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;I75&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Osceola&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>92.4918666667</span>, <span style=color:#ae81ff>41.227275</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;OOA&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;OOA&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Oskaloosa&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>92.9431083333</span>, <span style=color:#ae81ff>41.3989138889</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;PEA&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;PEA&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;PELLA&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>94.1637083333</span>, <span style=color:#ae81ff>41.8277916667</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;PRO&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;PRO&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Perry&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.2624111111</span>, <span style=color:#ae81ff>41.01065</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;RDK&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;RDK&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;RED OAK&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.8353138889</span>, <span style=color:#ae81ff>43.2081611111</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;SHL&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;SHL&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;SHELDON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.4112333333</span>, <span style=color:#ae81ff>40.753275</span>], <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;SDA&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;SDA&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;SHENANDOAH MUNI&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>95.2399194444</span>, <span style=color:#ae81ff>42.5972277778</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;SLB&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;SLB&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Storm Lake&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>92.0248416667</span>, <span style=color:#ae81ff>42.2175777778</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;VTI&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;VTI&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;VINTON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>91.6748111111</span>, <span style=color:#ae81ff>41.2751444444</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;AWG&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;AWG&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;WASHINGTON&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>},
</span></span><span style=display:flex><span>{<span style=color:#e6db74>&#39;geometry&#39;</span>: {<span style=color:#e6db74>&#39;coordinates&#39;</span>: [<span style=color:#f92672>-</span><span style=color:#ae81ff>93.8690777778</span>, <span style=color:#ae81ff>42.4392305556</span>],
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Point&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;id&#39;</span>: <span style=color:#e6db74>&#39;EBS&#39;</span>,
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;properties&#39;</span>: {<span style=color:#e6db74>&#39;sid&#39;</span>: <span style=color:#e6db74>&#39;EBS&#39;</span>, <span style=color:#e6db74>&#39;sname&#39;</span>: <span style=color:#e6db74>&#39;Webster City&#39;</span>},
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#39;type&#39;</span>: <span style=color:#e6db74>&#39;Feature&#39;</span>}]
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>stations <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>io<span style=color:#f92672>.</span>json<span style=color:#f92672>.</span>json_normalize(js[<span style=color:#e6db74>&#39;features&#39;</span>])<span style=color:#f92672>.</span>id
</span></span><span style=display:flex><span>url <span style=color:#f92672>=</span> (<span style=color:#e6db74>&#34;http://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;&amp;data=tmpf&amp;data=relh&amp;data=sped&amp;data=mslp&amp;data=p01i&amp;data=vsby&amp;data=gust_mph&amp;data=skyc1&amp;data=skyc2&amp;data=skyc3&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;&amp;tz=Etc/UTC&amp;format=comma&amp;latlon=no&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;&amp;{start:year1=%Y&amp;month1=%m&amp;day1=</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>}&#34;</span>
</span></span><span style=display:flex><span>       <span style=color:#e6db74>&#34;&amp;{end:year2=%Y&amp;month2=%m&amp;day2=</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>}&amp;</span><span style=color:#e6db74>{stations}</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>stations <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&amp;&#34;</span><span style=color:#f92672>.</span>join(<span style=color:#e6db74>&#34;station=</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> s <span style=color:#66d9ef>for</span> s <span style=color:#f92672>in</span> stations)
</span></span><span style=display:flex><span>start <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Timestamp(<span style=color:#e6db74>&#39;2014-01-01&#39;</span>)
</span></span><span style=display:flex><span>end<span style=color:#f92672>=</span>pd<span style=color:#f92672>.</span>Timestamp(<span style=color:#e6db74>&#39;2014-01-31&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>weather <span style=color:#f92672>=</span> (pd<span style=color:#f92672>.</span>read_csv(url<span style=color:#f92672>.</span>format(start<span style=color:#f92672>=</span>start, end<span style=color:#f92672>=</span>end, stations<span style=color:#f92672>=</span>stations),
</span></span><span style=display:flex><span>                       comment<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;#&#34;</span>))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span>ids <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat([get_ids(network) <span style=color:#66d9ef>for</span> network <span style=color:#f92672>in</span> networks], ignore_index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>gr <span style=color:#f92672>=</span> ids<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;network&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>os<span style=color:#f92672>.</span>makedirs(<span style=color:#e6db74>&#34;weather&#34;</span>, exist_ok<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> i, (k, v) <span style=color:#f92672>in</span> enumerate(gr):
</span></span><span style=display:flex><span>    print(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>&#34;</span><span style=color:#f92672>.</span>format(i, len(network)), end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\r</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>    weather <span style=color:#f92672>=</span> get_weather(v[<span style=color:#e6db74>&#39;id&#39;</span>])
</span></span><span style=display:flex><span>    weather<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>&#34;weather/</span><span style=color:#e6db74>{}</span><span style=color:#e6db74>.csv&#34;</span><span style=color:#f92672>.</span>format(k))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>weather <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat([
</span></span><span style=display:flex><span>    pd<span style=color:#f92672>.</span>read_csv(f, parse_dates<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;date&#39;</span>, index_col<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;station&#39;</span>, <span style=color:#e6db74>&#39;date&#39;</span>])
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> f <span style=color:#f92672>in</span> glob<span style=color:#f92672>.</span>glob(<span style=color:#e6db74>&#39;weather/*.csv&#39;</span>)])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>weather<span style=color:#f92672>.</span>to_hdf(<span style=color:#e6db74>&#34;weather.h5&#34;</span>, <span style=color:#e6db74>&#34;weather&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>weather <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_hdf(<span style=color:#e6db74>&#34;weather.h5&#34;</span>, <span style=color:#e6db74>&#34;weather&#34;</span>)<span style=color:#f92672>.</span>sort_index()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>weather<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th></th><th>tmpf</th><th>relh</th><th>sped</th><th>mslp</th><th>p01i</th><th>vsby</th><th>gust_mph</th><th>skyc1</th><th>skyc2</th><th>skyc3</th></tr><tr><th>station</th><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan=5 valign=top>01M</th><th>2014-01-01 00:15:00</th><td>33.80</td><td>85.86</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 00:35:00</th><td>33.44</td><td>87.11</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 00:55:00</th><td>32.54</td><td>90.97</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 01:15:00</th><td>31.82</td><td>93.65</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 01:35:00</th><td>32.00</td><td>92.97</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr></tbody></table></div><p>OK, that was a bit of work. Here&rsquo;s a plot to reward ourselves.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>airports <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;DSM&#39;</span>, <span style=color:#e6db74>&#39;ORD&#39;</span>, <span style=color:#e6db74>&#39;JFK&#39;</span>, <span style=color:#e6db74>&#39;PDX&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>g <span style=color:#f92672>=</span> sns<span style=color:#f92672>.</span>FacetGrid(weather<span style=color:#f92672>.</span>sort_index()<span style=color:#f92672>.</span>loc[airports]<span style=color:#f92672>.</span>reset_index(),
</span></span><span style=display:flex><span>                  col<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;station&#39;</span>, hue<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;station&#39;</span>, col_wrap<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, size<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>g<span style=color:#f92672>.</span>map(sns<span style=color:#f92672>.</span>regplot, <span style=color:#e6db74>&#39;sped&#39;</span>, <span style=color:#e6db74>&#39;gust_mph&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>savefig(<span style=color:#e6db74>&#39;../content/images/indexes_wind_gust_facet.png&#39;</span>);
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>airports <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;DSM&#39;</span>, <span style=color:#e6db74>&#39;ORD&#39;</span>, <span style=color:#e6db74>&#39;JFK&#39;</span>, <span style=color:#e6db74>&#39;PDX&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>g <span style=color:#f92672>=</span> sns<span style=color:#f92672>.</span>FacetGrid(weather<span style=color:#f92672>.</span>sort_index()<span style=color:#f92672>.</span>loc[airports]<span style=color:#f92672>.</span>reset_index(),
</span></span><span style=display:flex><span>                  col<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;station&#39;</span>, hue<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;station&#39;</span>, col_wrap<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>, size<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>)
</span></span><span style=display:flex><span>g<span style=color:#f92672>.</span>map(sns<span style=color:#f92672>.</span>regplot, <span style=color:#e6db74>&#39;sped&#39;</span>, <span style=color:#e6db74>&#39;gust_mph&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>savefig(<span style=color:#e6db74>&#39;../content/images/indexes_wind_gust_facet.svg&#39;</span>, transparent<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>);
</span></span></code></pre></div><p><img loading=lazy src=Indexes_files/Indexes_18_0.png alt=png></p><h1 id=set-operations>Set Operations<a hidden class=anchor aria-hidden=true href=#set-operations>#</a></h1><p>Indexes are set-like (technically <em>multi</em>sets, since you can have duplicates), so they support most python <code>set</code> operations. Indexes are immutable so you won&rsquo;t find any of the inplace <code>set</code> operations.
One other difference is that since <code>Index</code>es are also array like, you can&rsquo;t use some infix operators like <code>-</code> for <code>difference</code>. If you have a numeric index it is unclear whether you intend to perform math operations or set operations.
You can use <code>&</code> for intersetion, <code>|</code> for union, and <code>^</code> for symmetric difference though, since there&rsquo;s no ambiguity.</p><p>For example, lets find the set of airports that we have weather and flight information on. Since <code>weather</code> had a MultiIndex of <code>airport,datetime</code>, we&rsquo;ll use the <code>levels</code> attribute to get at the airport data, separate from the date data.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Bring in the flights data</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flights <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_hdf(<span style=color:#e6db74>&#39;flights.h5&#39;</span>, <span style=color:#e6db74>&#39;flights&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>weather_locs <span style=color:#f92672>=</span> weather<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>levels[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span><span style=color:#75715e># The `categories` attribute of a Categorical is an Index</span>
</span></span><span style=display:flex><span>origin_locs <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>origin<span style=color:#f92672>.</span>cat<span style=color:#f92672>.</span>categories
</span></span><span style=display:flex><span>dest_locs <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>dest<span style=color:#f92672>.</span>cat<span style=color:#f92672>.</span>categories
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>airports <span style=color:#f92672>=</span> weather_locs <span style=color:#f92672>&amp;</span> origin_locs <span style=color:#f92672>&amp;</span> dest_locs
</span></span><span style=display:flex><span>airports
</span></span></code></pre></div><pre><code>Index(['ABE', 'ABI', 'ABQ', 'ABR', 'ABY', 'ACT', 'ACV', 'AEX', 'AGS', 'ALB',
       ...
       'TUL', 'TUS', 'TVC', 'TWF', 'TXK', 'TYR', 'TYS', 'VLD', 'VPS', 'XNA'],
      dtype='object', length=267)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Weather, no flights:</span><span style=color:#ae81ff>\n\t</span><span style=color:#e6db74>&#34;</span>, weather_locs<span style=color:#f92672>.</span>difference(origin_locs <span style=color:#f92672>|</span> dest_locs), end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Flights, no weather:</span><span style=color:#ae81ff>\n\t</span><span style=color:#e6db74>&#34;</span>, (origin_locs <span style=color:#f92672>|</span> dest_locs)<span style=color:#f92672>.</span>difference(weather_locs), end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#e6db74>&#34;Dropped Stations:</span><span style=color:#ae81ff>\n\t</span><span style=color:#e6db74>&#34;</span>, (origin_locs <span style=color:#f92672>|</span> dest_locs) <span style=color:#f92672>^</span> weather_locs)
</span></span></code></pre></div><pre><code>Weather, no flights:
	 Index(['01M', '04V', '04W', '05U', '06D', '08D', '0A9', '0CO', '0E0', '0F2',
       ...
       'Y50', 'Y51', 'Y63', 'Y70', 'YIP', 'YKM', 'YKN', 'YNG', 'ZPH', 'ZZV'],
      dtype='object', length=1909)

Flights, no weather:
	 Index(['ADK', 'ADQ', 'ANC', 'BET', 'BKG', 'BQN', 'BRW', 'CDV', 'CLD', 'FAI',
       'FCA', 'GUM', 'HNL', 'ITO', 'JNU', 'KOA', 'KTN', 'LIH', 'MQT', 'OGG',
       'OME', 'OTZ', 'PPG', 'PSE', 'PSG', 'SCC', 'SCE', 'SIT', 'SJU', 'STT',
       'STX', 'WRG', 'YAK', 'YUM'],
      dtype='object')

Dropped Stations:
	 Index(['01M', '04V', '04W', '05U', '06D', '08D', '0A9', '0CO', '0E0', '0F2',
       ...
       'Y63', 'Y70', 'YAK', 'YIP', 'YKM', 'YKN', 'YNG', 'YUM', 'ZPH', 'ZZV'],
      dtype='object', length=1943)
</code></pre><h1 id=flavors>Flavors<a hidden class=anchor aria-hidden=true href=#flavors>#</a></h1><p>Pandas has many subclasses of the regular <code>Index</code>, each tailored to a specific kind of data.
Most of the time these will be created for you automatically, so you don&rsquo;t have to worry about which one to choose.</p><ol><li><a href=http://pandas.pydata.org/pandas-docs/version/0.18.0/generated/pandas.Index.html#pandas.Index><code>Index</code></a></li><li><code>Int64Index</code></li><li><code>RangeIndex</code> (Memory-saving special case of <code>Int64Index</code>)</li><li><code>FloatIndex</code></li><li><code>DatetimeIndex</code>: Datetime64[ns] precision data</li><li><code>PeriodIndex</code>: Regularly-spaced, arbitrary precision datetime data.</li><li><code>TimedeltaIndex</code>: Timedelta data</li><li><code>CategoricalIndex</code>:</li></ol><p>Some of these are purely optimizations, others use information about the data to provide additional methods.
And while sometimes you might work with indexes directly (like the set operations above), most of they time you&rsquo;ll be operating on a Series or DataFrame, which in turn makes use of its Index.</p><h3 id=row-slicing>Row Slicing<a hidden class=anchor aria-hidden=true href=#row-slicing>#</a></h3><p>We saw in part one that they&rsquo;re great for making <em>row</em> subsetting as easy as column subsetting.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>weather<span style=color:#f92672>.</span>loc[<span style=color:#e6db74>&#39;DSM&#39;</span>]<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th><th>relh</th><th>sped</th><th>mslp</th><th>p01i</th><th>vsby</th><th>gust_mph</th><th>skyc1</th><th>skyc2</th><th>skyc3</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2014-01-01 00:54:00</th><td>10.94</td><td>72.79</td><td>10.3</td><td>1024.9</td><td>0.0</td><td>10.0</td><td>NaN</td><td>FEW</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 01:54:00</th><td>10.94</td><td>72.79</td><td>11.4</td><td>1025.4</td><td>0.0</td><td>10.0</td><td>NaN</td><td>OVC</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 02:54:00</th><td>10.94</td><td>72.79</td><td>8.0</td><td>1025.3</td><td>0.0</td><td>10.0</td><td>NaN</td><td>BKN</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 03:54:00</th><td>10.94</td><td>72.79</td><td>9.1</td><td>1025.3</td><td>0.0</td><td>10.0</td><td>NaN</td><td>OVC</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 04:54:00</th><td>10.04</td><td>72.69</td><td>9.1</td><td>1024.7</td><td>0.0</td><td>10.0</td><td>NaN</td><td>BKN</td><td>M</td><td>M</td></tr></tbody></table></div><p>Without indexes we&rsquo;d probably resort to boolean masks.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>weather2 <span style=color:#f92672>=</span> weather<span style=color:#f92672>.</span>reset_index()
</span></span><span style=display:flex><span>weather2[weather2[<span style=color:#e6db74>&#39;station&#39;</span>] <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;DSM&#39;</span>]<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>station</th><th>date</th><th>tmpf</th><th>relh</th><th>sped</th><th>mslp</th><th>p01i</th><th>vsby</th><th>gust_mph</th><th>skyc1</th><th>skyc2</th><th>skyc3</th></tr></thead><tbody><tr><th>884855</th><td>DSM</td><td>2014-01-01 00:54:00</td><td>10.94</td><td>72.79</td><td>10.3</td><td>1024.9</td><td>0.0</td><td>10.0</td><td>NaN</td><td>FEW</td><td>M</td><td>M</td></tr><tr><th>884856</th><td>DSM</td><td>2014-01-01 01:54:00</td><td>10.94</td><td>72.79</td><td>11.4</td><td>1025.4</td><td>0.0</td><td>10.0</td><td>NaN</td><td>OVC</td><td>M</td><td>M</td></tr><tr><th>884857</th><td>DSM</td><td>2014-01-01 02:54:00</td><td>10.94</td><td>72.79</td><td>8.0</td><td>1025.3</td><td>0.0</td><td>10.0</td><td>NaN</td><td>BKN</td><td>M</td><td>M</td></tr><tr><th>884858</th><td>DSM</td><td>2014-01-01 03:54:00</td><td>10.94</td><td>72.79</td><td>9.1</td><td>1025.3</td><td>0.0</td><td>10.0</td><td>NaN</td><td>OVC</td><td>M</td><td>M</td></tr><tr><th>884859</th><td>DSM</td><td>2014-01-01 04:54:00</td><td>10.04</td><td>72.69</td><td>9.1</td><td>1024.7</td><td>0.0</td><td>10.0</td><td>NaN</td><td>BKN</td><td>M</td><td>M</td></tr></tbody></table></div><p>Slightly less convenient, but still doable.</p><h3 id=indexes-for-easier-arithmetic-analysis>Indexes for Easier Arithmetic, Analysis<a hidden class=anchor aria-hidden=true href=#indexes-for-easier-arithmetic-analysis>#</a></h3><p>It&rsquo;s nice to have your metadata (labels on each observation) next to you actual values. But if you store them in an array, they&rsquo;ll get in the way. Say we wanted to translate the farenheit temperature to celcius.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># With indecies</span>
</span></span><span style=display:flex><span>temp <span style=color:#f92672>=</span> weather[<span style=color:#e6db74>&#39;tmpf&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>c <span style=color:#f92672>=</span> (temp <span style=color:#f92672>-</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>c<span style=color:#f92672>.</span>to_frame()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th></th><th>tmpf</th></tr><tr><th>station</th><th>date</th><th></th></tr></thead><tbody><tr><th rowspan=5 valign=top>01M</th><th>2014-01-01 00:15:00</th><td>1.0</td></tr><tr><th>2014-01-01 00:35:00</th><td>0.8</td></tr><tr><th>2014-01-01 00:55:00</th><td>0.3</td></tr><tr><th>2014-01-01 01:15:00</th><td>-0.1</td></tr><tr><th>2014-01-01 01:35:00</th><td>0.0</td></tr><tr><th>...</th><th>...</th><td>...</td></tr><tr><th rowspan=5 valign=top>ZZV</th><th>2014-01-30 19:53:00</th><td>-2.8</td></tr><tr><th>2014-01-30 20:53:00</th><td>-2.2</td></tr><tr><th>2014-01-30 21:53:00</th><td>-2.2</td></tr><tr><th>2014-01-30 22:53:00</th><td>-2.8</td></tr><tr><th>2014-01-30 23:53:00</th><td>-1.7</td></tr></tbody></table><p>3303647 rows × 1 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># without</span>
</span></span><span style=display:flex><span>temp2 <span style=color:#f92672>=</span> weather<span style=color:#f92672>.</span>reset_index()[[<span style=color:#e6db74>&#39;station&#39;</span>, <span style=color:#e6db74>&#39;date&#39;</span>, <span style=color:#e6db74>&#39;tmpf&#39;</span>]]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>temp2[<span style=color:#e6db74>&#39;tmpf&#39;</span>] <span style=color:#f92672>=</span> (temp2[<span style=color:#e6db74>&#39;tmpf&#39;</span>] <span style=color:#f92672>-</span> <span style=color:#ae81ff>32</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>9</span>
</span></span><span style=display:flex><span>temp2<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>station</th><th>date</th><th>tmpf</th></tr></thead><tbody><tr><th>0</th><td>01M</td><td>2014-01-01 00:15:00</td><td>1.0</td></tr><tr><th>1</th><td>01M</td><td>2014-01-01 00:35:00</td><td>0.8</td></tr><tr><th>2</th><td>01M</td><td>2014-01-01 00:55:00</td><td>0.3</td></tr><tr><th>3</th><td>01M</td><td>2014-01-01 01:15:00</td><td>-0.1</td></tr><tr><th>4</th><td>01M</td><td>2014-01-01 01:35:00</td><td>0.0</td></tr></tbody></table></div><p>Again, not terrible, but not as good.
And, what if you had wanted to keep farenheit around as well, instead of overwriting it like we did?
Then you&rsquo;d need to make a copy of everything, including the <code>station</code> and <code>date</code> columns.
We don&rsquo;t have that problem, since indexes are mutable and safely shared between DataFrames / Series.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>temp<span style=color:#f92672>.</span>index <span style=color:#f92672>is</span> c<span style=color:#f92672>.</span>index
</span></span></code></pre></div><pre><code>True
</code></pre><h3 id=indexes-for-alignment>Indexes for Alignment<a hidden class=anchor aria-hidden=true href=#indexes-for-alignment>#</a></h3><p>I&rsquo;ve saved the best for last.
Automatic alignment, or reindexing, is fundamental to pandas.</p><p>All binary operations (add, multiply, etc&mldr;) between Series/DataFrames first <em>align</em> and then proceed.</p><p>Let&rsquo;s suppose we have hourly observations on temperature and windspeed.
And suppose some of the observations were invalid, and not reported (simulated below by sampling from the full dataset). We&rsquo;ll assume the missing windspeed observations were potentially different from the missing temperature observations.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>dsm <span style=color:#f92672>=</span> weather<span style=color:#f92672>.</span>loc[<span style=color:#e6db74>&#39;DSM&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>hourly <span style=color:#f92672>=</span> dsm<span style=color:#f92672>.</span>resample(<span style=color:#e6db74>&#39;H&#39;</span>)<span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>temp <span style=color:#f92672>=</span> hourly[<span style=color:#e6db74>&#39;tmpf&#39;</span>]<span style=color:#f92672>.</span>sample(frac<span style=color:#f92672>=</span><span style=color:#ae81ff>.5</span>, random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>sort_index()
</span></span><span style=display:flex><span>sped <span style=color:#f92672>=</span> hourly[<span style=color:#e6db74>&#39;sped&#39;</span>]<span style=color:#f92672>.</span>sample(frac<span style=color:#f92672>=</span><span style=color:#ae81ff>.5</span>, random_state<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>.</span>sort_index()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>temp<span style=color:#f92672>.</span>head()<span style=color:#f92672>.</span>to_frame()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th></tr><tr><th>date</th><th></th></tr></thead><tbody><tr><th>2014-01-01 00:00:00</th><td>10.94</td></tr><tr><th>2014-01-01 02:00:00</th><td>10.94</td></tr><tr><th>2014-01-01 03:00:00</th><td>10.94</td></tr><tr><th>2014-01-01 04:00:00</th><td>10.04</td></tr><tr><th>2014-01-01 05:00:00</th><td>10.04</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sped<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><pre><code>date
2014-01-01 01:00:00    11.4
2014-01-01 02:00:00     8.0
2014-01-01 03:00:00     9.1
2014-01-01 04:00:00     9.1
2014-01-01 05:00:00    10.3
Name: sped, dtype: float64
</code></pre><p>Notice that the two indexes aren&rsquo;t identical.</p><p>Suppose that the <code>windspeed : temperature</code> ratio is meaningful.
When we go to compute that, pandas will automatically align the two by index label.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sped <span style=color:#f92672>/</span> temp
</span></span></code></pre></div><pre><code>date
2014-01-01 00:00:00         NaN
2014-01-01 01:00:00         NaN
2014-01-01 02:00:00    0.731261
2014-01-01 03:00:00    0.831810
2014-01-01 04:00:00    0.906375
                         ...   
2014-01-30 13:00:00         NaN
2014-01-30 14:00:00    0.584712
2014-01-30 17:00:00         NaN
2014-01-30 21:00:00         NaN
2014-01-30 23:00:00         NaN
dtype: float64
</code></pre><p>This lets you focus on doing the operation, rather than manually aligning things, ensuring that the arrays are the same length and in the same order.
By deault, missing values are inserted where the two don&rsquo;t align.
You can use the method version of any binary operation to specify a <code>fill_value</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sped<span style=color:#f92672>.</span>div(temp, fill_value<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span></code></pre></div><pre><code>date
2014-01-01 00:00:00     0.091408
2014-01-01 01:00:00    11.400000
2014-01-01 02:00:00     0.731261
2014-01-01 03:00:00     0.831810
2014-01-01 04:00:00     0.906375
                         ...    
2014-01-30 13:00:00     0.027809
2014-01-30 14:00:00     0.584712
2014-01-30 17:00:00     0.023267
2014-01-30 21:00:00     0.035663
2014-01-30 23:00:00    13.700000
dtype: float64
</code></pre><p>And since I couldn&rsquo;t find anywhere else to put it, you can control the axis the operation is aligned along as well.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>hourly<span style=color:#f92672>.</span>div(sped, axis<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;index&#39;</span>)
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th><th>relh</th><th>sped</th><th>mslp</th><th>p01i</th><th>vsby</th><th>gust_mph</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2014-01-01 00:00:00</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2014-01-01 01:00:00</th><td>0.959649</td><td>6.385088</td><td>1.0</td><td>89.947368</td><td>0.0</td><td>0.877193</td><td>NaN</td></tr><tr><th>2014-01-01 02:00:00</th><td>1.367500</td><td>9.098750</td><td>1.0</td><td>128.162500</td><td>0.0</td><td>1.250000</td><td>NaN</td></tr><tr><th>2014-01-01 03:00:00</th><td>1.202198</td><td>7.998901</td><td>1.0</td><td>112.670330</td><td>0.0</td><td>1.098901</td><td>NaN</td></tr><tr><th>2014-01-01 04:00:00</th><td>1.103297</td><td>7.987912</td><td>1.0</td><td>112.604396</td><td>0.0</td><td>1.098901</td><td>NaN</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>2014-01-30 19:00:00</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2014-01-30 20:00:00</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2014-01-30 21:00:00</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2014-01-30 22:00:00</th><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>2014-01-30 23:00:00</th><td>1.600000</td><td>4.535036</td><td>1.0</td><td>73.970803</td><td>0.0</td><td>0.729927</td><td>NaN</td></tr></tbody></table><p>720 rows × 7 columns</p></div><p>The non row-labeled version of this is messy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>temp2 <span style=color:#f92672>=</span> temp<span style=color:#f92672>.</span>reset_index()
</span></span><span style=display:flex><span>sped2 <span style=color:#f92672>=</span> sped<span style=color:#f92672>.</span>reset_index()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Find rows where the operation is defined</span>
</span></span><span style=display:flex><span>common_dates <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Index(temp2<span style=color:#f92672>.</span>date) <span style=color:#f92672>&amp;</span> sped2<span style=color:#f92672>.</span>date
</span></span><span style=display:flex><span>pd<span style=color:#f92672>.</span>concat([
</span></span><span style=display:flex><span>    <span style=color:#75715e># concat to not lose date information</span>
</span></span><span style=display:flex><span>    sped2<span style=color:#f92672>.</span>loc[sped2[<span style=color:#e6db74>&#39;date&#39;</span>]<span style=color:#f92672>.</span>isin(common_dates), <span style=color:#e6db74>&#39;date&#39;</span>],
</span></span><span style=display:flex><span>    (sped2<span style=color:#f92672>.</span>loc[sped2<span style=color:#f92672>.</span>date<span style=color:#f92672>.</span>isin(common_dates), <span style=color:#e6db74>&#39;sped&#39;</span>] <span style=color:#f92672>/</span>
</span></span><span style=display:flex><span>     temp2<span style=color:#f92672>.</span>loc[temp2<span style=color:#f92672>.</span>date<span style=color:#f92672>.</span>isin(common_dates), <span style=color:#e6db74>&#39;tmpf&#39;</span>])],
</span></span><span style=display:flex><span>    axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>dropna(how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;all&#39;</span>)
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>date</th><th>0</th></tr></thead><tbody><tr><th>1</th><td>2014-01-01 02:00:00</td><td>0.731261</td></tr><tr><th>2</th><td>2014-01-01 03:00:00</td><td>0.831810</td></tr><tr><th>3</th><td>2014-01-01 04:00:00</td><td>0.906375</td></tr><tr><th>4</th><td>2014-01-01 05:00:00</td><td>1.025896</td></tr><tr><th>8</th><td>2014-01-01 13:00:00</td><td>NaN</td></tr><tr><th>...</th><td>...</td><td>...</td></tr><tr><th>351</th><td>2014-01-29 23:00:00</td><td>0.535609</td></tr><tr><th>354</th><td>2014-01-30 05:00:00</td><td>0.487735</td></tr><tr><th>356</th><td>2014-01-30 09:00:00</td><td>NaN</td></tr><tr><th>357</th><td>2014-01-30 10:00:00</td><td>0.618939</td></tr><tr><th>358</th><td>2014-01-30 14:00:00</td><td>NaN</td></tr></tbody></table><p>170 rows × 2 columns</p></div><p>Yeah, I prefer the <code>temp / sped</code> version.</p><p>Alignment isn&rsquo;t limited to arithmetic operations, although those are the most obvious and easiest to demonstrate.</p><h1 id=merging>Merging<a hidden class=anchor aria-hidden=true href=#merging>#</a></h1><p>There are two ways of merging DataFrames / Series in pandas</p><ol><li>Relational Database style with <code>pd.merge</code></li><li>Array style with <code>pd.concat</code></li></ol><p>Personally, I think in terms of the <code>concat</code> style.
I learned pandas before I ever really used SQL, so it comes more naturally to me I suppose.
<code>pd.merge</code> has more flexibilty, though I think <em>most</em> of the time you don&rsquo;t need this flexibilty.</p><h3 id=concat-version>Concat Version<a hidden class=anchor aria-hidden=true href=#concat-version>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pd<span style=color:#f92672>.</span>concat([temp, sped], axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th><th>sped</th></tr><tr><th>date</th><th></th><th></th></tr></thead><tbody><tr><th>2014-01-01 00:00:00</th><td>10.94</td><td>NaN</td></tr><tr><th>2014-01-01 01:00:00</th><td>NaN</td><td>11.4</td></tr><tr><th>2014-01-01 02:00:00</th><td>10.94</td><td>8.0</td></tr><tr><th>2014-01-01 03:00:00</th><td>10.94</td><td>9.1</td></tr><tr><th>2014-01-01 04:00:00</th><td>10.04</td><td>9.1</td></tr></tbody></table></div><p>The <code>axis</code> parameter controls how the data should be stacked, <code>0</code> for vertically, <code>1</code> for horizontally.
The <code>join</code> parameter controls the merge behavior on the shared axis, (the Index for <code>axis=1</code>). By default it&rsquo;s like a union of the two indexes, or an outer join.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pd<span style=color:#f92672>.</span>concat([temp, sped], axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>, join<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;inner&#39;</span>)
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th><th>sped</th></tr><tr><th>date</th><th></th><th></th></tr></thead><tbody><tr><th>2014-01-01 02:00:00</th><td>10.94</td><td>8.000</td></tr><tr><th>2014-01-01 03:00:00</th><td>10.94</td><td>9.100</td></tr><tr><th>2014-01-01 04:00:00</th><td>10.04</td><td>9.100</td></tr><tr><th>2014-01-01 05:00:00</th><td>10.04</td><td>10.300</td></tr><tr><th>2014-01-01 13:00:00</th><td>8.96</td><td>13.675</td></tr><tr><th>...</th><td>...</td><td>...</td></tr><tr><th>2014-01-29 23:00:00</th><td>35.96</td><td>18.200</td></tr><tr><th>2014-01-30 05:00:00</th><td>33.98</td><td>17.100</td></tr><tr><th>2014-01-30 09:00:00</th><td>35.06</td><td>16.000</td></tr><tr><th>2014-01-30 10:00:00</th><td>35.06</td><td>21.700</td></tr><tr><th>2014-01-30 14:00:00</th><td>35.06</td><td>20.500</td></tr></tbody></table><p>170 rows × 2 columns</p></div><h3 id=merge-version>Merge Version<a hidden class=anchor aria-hidden=true href=#merge-version>#</a></h3><p>Since we&rsquo;re joining by index here the merge version is quite similar.
We&rsquo;ll see an example later of a one-to-many join where the two differ.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pd<span style=color:#f92672>.</span>merge(temp<span style=color:#f92672>.</span>to_frame(), sped<span style=color:#f92672>.</span>to_frame(), left_index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, right_index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th><th>sped</th></tr><tr><th>date</th><th></th><th></th></tr></thead><tbody><tr><th>2014-01-01 02:00:00</th><td>10.94</td><td>8.000</td></tr><tr><th>2014-01-01 03:00:00</th><td>10.94</td><td>9.100</td></tr><tr><th>2014-01-01 04:00:00</th><td>10.04</td><td>9.100</td></tr><tr><th>2014-01-01 05:00:00</th><td>10.04</td><td>10.300</td></tr><tr><th>2014-01-01 13:00:00</th><td>8.96</td><td>13.675</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>pd<span style=color:#f92672>.</span>merge(temp<span style=color:#f92672>.</span>to_frame(), sped<span style=color:#f92672>.</span>to_frame(), left_index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, right_index<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>,
</span></span><span style=display:flex><span>         how<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;outer&#39;</span>)<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th><th>sped</th></tr><tr><th>date</th><th></th><th></th></tr></thead><tbody><tr><th>2014-01-01 00:00:00</th><td>10.94</td><td>NaN</td></tr><tr><th>2014-01-01 01:00:00</th><td>NaN</td><td>11.4</td></tr><tr><th>2014-01-01 02:00:00</th><td>10.94</td><td>8.0</td></tr><tr><th>2014-01-01 03:00:00</th><td>10.94</td><td>9.1</td></tr><tr><th>2014-01-01 04:00:00</th><td>10.04</td><td>9.1</td></tr></tbody></table></div><p>Like I said, I typically prefer <code>concat</code> to <code>merge</code>.
The exception here is one-to-many type joins. Let&rsquo;s walk through one of those,
where we join the flight data to the weather data.
To focus just on the merge, we&rsquo;ll aggregate hour weather data to be daily, rather than trying to find the closest recorded weather observation to each departure (you could do that, but it&rsquo;s not the focus right now). We&rsquo;ll then join the one <code>(airport, date)</code> record to the many <code>(airport, date, flight)</code> records.</p><p>Quick tangent, to get the weather data to daily frequency, we&rsquo;ll need to resample (more on that in the timeseries section). The resample essentially involves breaking the recorded values into daily buckets and computing the aggregation function on each bucket. The only wrinkle is that we have to resample <em>by station</em>, so we&rsquo;ll use the <code>pd.TimeGrouper</code> helper.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>idx_cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;unique_carrier&#39;</span>, <span style=color:#e6db74>&#39;origin&#39;</span>, <span style=color:#e6db74>&#39;dest&#39;</span>, <span style=color:#e6db74>&#39;tail_num&#39;</span>, <span style=color:#e6db74>&#39;fl_num&#39;</span>, <span style=color:#e6db74>&#39;fl_date&#39;</span>]
</span></span><span style=display:flex><span>data_cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;crs_dep_time&#39;</span>, <span style=color:#e6db74>&#39;dep_delay&#39;</span>, <span style=color:#e6db74>&#39;crs_arr_time&#39;</span>, <span style=color:#e6db74>&#39;arr_delay&#39;</span>,
</span></span><span style=display:flex><span>             <span style=color:#e6db74>&#39;taxi_out&#39;</span>, <span style=color:#e6db74>&#39;taxi_in&#39;</span>, <span style=color:#e6db74>&#39;wheels_off&#39;</span>, <span style=color:#e6db74>&#39;wheels_on&#39;</span>, <span style=color:#e6db74>&#39;distance&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>df <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>set_index(idx_cols)[data_cols]<span style=color:#f92672>.</span>sort_index()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>mode</span>(x):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Arbitrarily break ties.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> x<span style=color:#f92672>.</span>value_counts()<span style=color:#f92672>.</span>index[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>aggfuncs <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;tmpf&#39;</span>: <span style=color:#e6db74>&#39;mean&#39;</span>, <span style=color:#e6db74>&#39;relh&#39;</span>: <span style=color:#e6db74>&#39;mean&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;sped&#39;</span>: <span style=color:#e6db74>&#39;mean&#39;</span>, <span style=color:#e6db74>&#39;mslp&#39;</span>: <span style=color:#e6db74>&#39;mean&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;p01i&#39;</span>: <span style=color:#e6db74>&#39;mean&#39;</span>, <span style=color:#e6db74>&#39;vsby&#39;</span>: <span style=color:#e6db74>&#39;mean&#39;</span>,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;gust_mph&#39;</span>: <span style=color:#e6db74>&#39;mean&#39;</span>, <span style=color:#e6db74>&#39;skyc1&#39;</span>: mode,
</span></span><span style=display:flex><span>            <span style=color:#e6db74>&#39;skyc2&#39;</span>: mode, <span style=color:#e6db74>&#39;skyc3&#39;</span>: mode}
</span></span><span style=display:flex><span><span style=color:#75715e># TimeGrouper works on a DatetimeIndex, so we move `station` to the</span>
</span></span><span style=display:flex><span><span style=color:#75715e># columns and then groupby it as well.</span>
</span></span><span style=display:flex><span>daily <span style=color:#f92672>=</span> (weather<span style=color:#f92672>.</span>reset_index(level<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;station&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span>groupby([pd<span style=color:#f92672>.</span>TimeGrouper(<span style=color:#e6db74>&#39;1d&#39;</span>), <span style=color:#e6db74>&#34;station&#34;</span>])
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span>agg(aggfuncs))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>daily<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th></th><th>gust_mph</th><th>vsby</th><th>sped</th><th>relh</th><th>skyc1</th><th>tmpf</th><th>skyc2</th><th>mslp</th><th>p01i</th><th>skyc3</th></tr><tr><th>date</th><th>station</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan=5 valign=top>2014-01-01</th><th>01M</th><td>NaN</td><td>9.229167</td><td>2.262500</td><td>81.117917</td><td>CLR</td><td>35.747500</td><td>M</td><td>NaN</td><td>0.0</td><td>M</td></tr><tr><th>04V</th><td>31.307143</td><td>9.861111</td><td>11.131944</td><td>72.697778</td><td>CLR</td><td>18.350000</td><td>M</td><td>NaN</td><td>0.0</td><td>M</td></tr><tr><th>04W</th><td>NaN</td><td>10.000000</td><td>3.601389</td><td>69.908056</td><td>OVC</td><td>-9.075000</td><td>M</td><td>NaN</td><td>0.0</td><td>M</td></tr><tr><th>05U</th><td>NaN</td><td>9.929577</td><td>3.770423</td><td>71.519859</td><td>CLR</td><td>26.321127</td><td>M</td><td>NaN</td><td>0.0</td><td>M</td></tr><tr><th>06D</th><td>NaN</td><td>9.576389</td><td>5.279167</td><td>73.784179</td><td>CLR</td><td>-11.388060</td><td>M</td><td>NaN</td><td>0.0</td><td>M</td></tr></tbody></table></div><h3 id=the-merge-version>The merge version<a hidden class=anchor aria-hidden=true href=#the-merge-version>#</a></h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>m <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>merge(flights, daily<span style=color:#f92672>.</span>reset_index()<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;date&#39;</span>: <span style=color:#e6db74>&#39;fl_date&#39;</span>, <span style=color:#e6db74>&#39;station&#39;</span>: <span style=color:#e6db74>&#39;origin&#39;</span>}),
</span></span><span style=display:flex><span>             on<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;fl_date&#39;</span>, <span style=color:#e6db74>&#39;origin&#39;</span>])<span style=color:#f92672>.</span>set_index(idx_cols)<span style=color:#f92672>.</span>sort_index()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>m<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th></th><th></th><th></th><th></th><th></th><th>airline_id</th><th>origin_airport_id</th><th>origin_airport_seq_id</th><th>origin_city_market_id</th><th>origin_city_name</th><th>origin_state_nm</th><th>dest_airport_id</th><th>dest_airport_seq_id</th><th>dest_city_market_id</th><th>dest_city_name</th><th>...</th><th>gust_mph</th><th>vsby</th><th>sped</th><th>relh</th><th>skyc1</th><th>tmpf</th><th>skyc2</th><th>mslp</th><th>p01i</th><th>skyc3</th></tr><tr><th>unique_carrier</th><th>origin</th><th>dest</th><th>tail_num</th><th>fl_num</th><th>fl_date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan=5 valign=top>AA</th><th rowspan=5 valign=top>ABQ</th><th rowspan=5 valign=top>DFW</th><th rowspan=2 valign=top>N200AA</th><th>1090</th><th>2014-01-27</th><td>19805</td><td>10140</td><td>1014002</td><td>30140</td><td>Albuquerque, NM</td><td>New Mexico</td><td>11298</td><td>1129803</td><td>30194</td><td>Dallas/Fort Worth, TX</td><td>...</td><td>NaN</td><td>10.0</td><td>6.737500</td><td>34.267500</td><td>SCT</td><td>41.8325</td><td>M</td><td>1014.620833</td><td>0.0</td><td>M</td></tr><tr><th>1662</th><th>2014-01-06</th><td>19805</td><td>10140</td><td>1014002</td><td>30140</td><td>Albuquerque, NM</td><td>New Mexico</td><td>11298</td><td>1129803</td><td>30194</td><td>Dallas/Fort Worth, TX</td><td>...</td><td>NaN</td><td>10.0</td><td>9.270833</td><td>27.249167</td><td>CLR</td><td>28.7900</td><td>M</td><td>1029.016667</td><td>0.0</td><td>M</td></tr><tr><th>N202AA</th><th>1332</th><th>2014-01-27</th><td>19805</td><td>10140</td><td>1014002</td><td>30140</td><td>Albuquerque, NM</td><td>New Mexico</td><td>11298</td><td>1129803</td><td>30194</td><td>Dallas/Fort Worth, TX</td><td>...</td><td>NaN</td><td>10.0</td><td>6.737500</td><td>34.267500</td><td>SCT</td><td>41.8325</td><td>M</td><td>1014.620833</td><td>0.0</td><td>M</td></tr><tr><th rowspan=2 valign=top>N426AA</th><th>1467</th><th>2014-01-15</th><td>19805</td><td>10140</td><td>1014002</td><td>30140</td><td>Albuquerque, NM</td><td>New Mexico</td><td>11298</td><td>1129803</td><td>30194</td><td>Dallas/Fort Worth, TX</td><td>...</td><td>NaN</td><td>10.0</td><td>6.216667</td><td>34.580000</td><td>FEW</td><td>40.2500</td><td>M</td><td>1027.800000</td><td>0.0</td><td>M</td></tr><tr><th>1662</th><th>2014-01-09</th><td>19805</td><td>10140</td><td>1014002</td><td>30140</td><td>Albuquerque, NM</td><td>New Mexico</td><td>11298</td><td>1129803</td><td>30194</td><td>Dallas/Fort Worth, TX</td><td>...</td><td>NaN</td><td>10.0</td><td>3.087500</td><td>42.162500</td><td>FEW</td><td>34.6700</td><td>M</td><td>1018.379167</td><td>0.0</td><td>M</td></tr></tbody></table><p>5 rows × 40 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>m<span style=color:#f92672>.</span>sample(n<span style=color:#f92672>=</span><span style=color:#ae81ff>10000</span>)<span style=color:#f92672>.</span>pipe((sns<span style=color:#f92672>.</span>jointplot, <span style=color:#e6db74>&#39;data&#39;</span>), <span style=color:#e6db74>&#39;sped&#39;</span>, <span style=color:#e6db74>&#39;dep_delay&#39;</span>)
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>savefig(<span style=color:#e6db74>&#39;../content/images/indexes_sped_delay_join.svg&#39;</span>, transparent<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><p><img loading=lazy src=Indexes_files/Indexes_63_0.png alt=png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>m<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;skyc1&#39;</span>)<span style=color:#f92672>.</span>dep_delay<span style=color:#f92672>.</span>agg([<span style=color:#e6db74>&#39;mean&#39;</span>, <span style=color:#e6db74>&#39;count&#39;</span>])<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;mean&#39;</span>)
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>mean</th><th>count</th></tr><tr><th>skyc1</th><th></th><th></th></tr></thead><tbody><tr><th>M</th><td>-1.948052</td><td>77</td></tr><tr><th>CLR</th><td>11.222288</td><td>115121</td></tr><tr><th>FEW</th><td>16.863177</td><td>161727</td></tr><tr><th>SCT</th><td>17.803048</td><td>19289</td></tr><tr><th>BKN</th><td>18.638034</td><td>54030</td></tr><tr><th>OVC</th><td>21.667762</td><td>52643</td></tr><tr><th>VV</th><td>30.487008</td><td>9583</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> statsmodels.api <span style=color:#66d9ef>as</span> sm
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>mod <span style=color:#f92672>=</span> sm<span style=color:#f92672>.</span>OLS<span style=color:#f92672>.</span>from_formula(<span style=color:#e6db74>&#39;dep_delay ~ C(skyc1) + distance + tmpf + relh + sped + mslp&#39;</span>, data<span style=color:#f92672>=</span>m)
</span></span><span style=display:flex><span>res <span style=color:#f92672>=</span> mod<span style=color:#f92672>.</span>fit()
</span></span><span style=display:flex><span>res<span style=color:#f92672>.</span>summary()
</span></span></code></pre></div><table class=simpletable><caption>OLS Regression Results</caption><tr><th>Dep. Variable:</th><td>dep_delay</td><th>R-squared:</th><td>0.026</td></tr><tr><th>Model:</th><td>OLS</td><th>Adj. R-squared:</th><td>0.025</td></tr><tr><th>Method:</th><td>Least Squares</td><th>F-statistic:</th><td>976.4</td></tr><tr><th>Date:</th><td>Sun, 10 Apr 2016</td><th>Prob (F-statistic):</th><td>0.00</td></tr><tr><th>Time:</th><td>16:06:15</td><th>Log-Likelihood:</th><td>-2.1453e+06</td></tr><tr><th>No. Observations:</th><td>410372</td><th>AIC:</th><td>4.291e+06</td></tr><tr><th>Df Residuals:</th><td>410360</td><th>BIC:</th><td>4.291e+06</td></tr><tr><th>Df Model:</th><td>11</td><th></th><td></td></tr><tr><th>Covariance Type:</th><td>nonrobust</td><th></th><td></td></tr></table><table class=simpletable><tr><td></td><th>coef</th><th>std err</th><th>t</th><th>P>|t|</th><th>[95.0% Conf. Int.]</th></tr><tr><th>Intercept</th><td>-331.1032</td><td>10.828</td><td>-30.577</td><td>0.000</td><td>-352.327 -309.880</td></tr><tr><th>C(skyc1)[T.CLR]</th><td>-4.4041</td><td>0.249</td><td>-17.662</td><td>0.000</td><td>-4.893 -3.915</td></tr><tr><th>C(skyc1)[T.FEW]</th><td>-0.7330</td><td>0.226</td><td>-3.240</td><td>0.001</td><td>-1.176 -0.290</td></tr><tr><th>C(skyc1)[T.M]</th><td>-16.4341</td><td>8.681</td><td>-1.893</td><td>0.058</td><td>-33.448 0.580</td></tr><tr><th>C(skyc1)[T.OVC]</th><td>0.3818</td><td>0.281</td><td>1.358</td><td>0.174</td><td>-0.169 0.933</td></tr><tr><th>C(skyc1)[T.SCT]</th><td>0.8589</td><td>0.380</td><td>2.260</td><td>0.024</td><td>0.114 1.604</td></tr><tr><th>C(skyc1)[T.VV ]</th><td>8.8603</td><td>0.509</td><td>17.414</td><td>0.000</td><td>7.863 9.858</td></tr><tr><th>distance</th><td>0.0008</td><td>0.000</td><td>6.174</td><td>0.000</td><td>0.001 0.001</td></tr><tr><th>tmpf</th><td>-0.1841</td><td>0.005</td><td>-38.390</td><td>0.000</td><td>-0.193 -0.175</td></tr><tr><th>relh</th><td>0.1626</td><td>0.004</td><td>38.268</td><td>0.000</td><td>0.154 0.171</td></tr><tr><th>sped</th><td>0.6096</td><td>0.018</td><td>33.716</td><td>0.000</td><td>0.574 0.645</td></tr><tr><th>mslp</th><td>0.3340</td><td>0.010</td><td>31.960</td><td>0.000</td><td>0.313 0.354</td></tr></table><table class=simpletable><tr><th>Omnibus:</th><td>456713.147</td><th>Durbin-Watson:</th><td>1.872</td></tr><tr><th>Prob(Omnibus):</th><td>0.000</td><th>Jarque-Bera (JB):</th><td>76162962.824</td></tr><tr><th>Skew:</th><td>5.535</td><th>Prob(JB):</th><td>0.00</td></tr><tr><th>Kurtosis:</th><td>68.816</td><th>Cond. No.</th><td>2.07e+05</td></tr></table><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>fig, ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots()
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>scatter(res<span style=color:#f92672>.</span>fittedvalues, res<span style=color:#f92672>.</span>resid, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;k&#39;</span>, marker<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;.&#39;</span>, alpha<span style=color:#f92672>=</span><span style=color:#ae81ff>.25</span>)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>set(xlabel<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Predicted&#39;</span>, ylabel<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;Residual&#39;</span>)
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>despine()
</span></span><span style=display:flex><span>plt<span style=color:#f92672>.</span>savefig(<span style=color:#e6db74>&#39;../content/images/indexes_resid_fit.png&#39;</span>, transparent<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span></code></pre></div><p><img loading=lazy src=Indexes_files/Indexes_67_0.png alt=png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>weather<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th></th><th>tmpf</th><th>relh</th><th>sped</th><th>mslp</th><th>p01i</th><th>vsby</th><th>gust_mph</th><th>skyc1</th><th>skyc2</th><th>skyc3</th></tr><tr><th>station</th><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan=5 valign=top>01M</th><th>2014-01-01 00:15:00</th><td>33.80</td><td>85.86</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 00:35:00</th><td>33.44</td><td>87.11</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 00:55:00</th><td>32.54</td><td>90.97</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 01:15:00</th><td>31.82</td><td>93.65</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 01:35:00</th><td>32.00</td><td>92.97</td><td>0.0</td><td>NaN</td><td>0.0</td><td>10.0</td><td>NaN</td><td>CLR</td><td>M</td><td>M</td></tr></tbody></table></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read</span>(fp):
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> (pd<span style=color:#f92672>.</span>read_csv(fp)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>str<span style=color:#f92672>.</span>lower)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>drop(<span style=color:#e6db74>&#39;unnamed: 36&#39;</span>, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>pipe(extract_city_name)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>pipe(time_to_datetime, [<span style=color:#e6db74>&#39;dep_time&#39;</span>, <span style=color:#e6db74>&#39;arr_time&#39;</span>, <span style=color:#e6db74>&#39;crs_arr_time&#39;</span>, <span style=color:#e6db74>&#39;crs_dep_time&#39;</span>])
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>assign(fl_date<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>to_datetime(x[<span style=color:#e6db74>&#39;fl_date&#39;</span>]),
</span></span><span style=display:flex><span>                    dest<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;dest&#39;</span>]),
</span></span><span style=display:flex><span>                    origin<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;origin&#39;</span>]),
</span></span><span style=display:flex><span>                    tail_num<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;tail_num&#39;</span>]),
</span></span><span style=display:flex><span>                    unique_carrier<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;unique_carrier&#39;</span>]),
</span></span><span style=display:flex><span>                    cancellation_code<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;cancellation_code&#39;</span>])))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>extract_city_name</span>(df):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Chicago, IL -&gt; Chicago for origin_city_name and dest_city_name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;origin_city_name&#39;</span>, <span style=color:#e6db74>&#39;dest_city_name&#39;</span>]
</span></span><span style=display:flex><span>    city <span style=color:#f92672>=</span> df[cols]<span style=color:#f92672>.</span>apply(<span style=color:#66d9ef>lambda</span> x: x<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>extract(<span style=color:#e6db74>&#34;(.*), \w</span><span style=color:#e6db74>{2}</span><span style=color:#e6db74>&#34;</span>, expand<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>))
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>    df[[<span style=color:#e6db74>&#39;origin_city_name&#39;</span>, <span style=color:#e6db74>&#39;dest_city_name&#39;</span>]] <span style=color:#f92672>=</span> city
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>time_to_datetime</span>(df, columns):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Combine all time items into datetimes.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    2014-01-01,0914 -&gt; 2014-01-01 09:14:00
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>converter</span>(col):
</span></span><span style=display:flex><span>        timepart <span style=color:#f92672>=</span> (col<span style=color:#f92672>.</span>astype(str)
</span></span><span style=display:flex><span>                       <span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;\.0$&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)  <span style=color:#75715e># NaNs force float dtype</span>
</span></span><span style=display:flex><span>                       <span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>pad(<span style=color:#ae81ff>4</span>, fillchar<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span>  pd<span style=color:#f92672>.</span>to_datetime(df[<span style=color:#e6db74>&#39;fl_date&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                               timepart<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>slice(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                               timepart<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>slice(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span>),
</span></span><span style=display:flex><span>                               errors<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;coerce&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> datetime_part
</span></span><span style=display:flex><span>    df[columns] <span style=color:#f92672>=</span> df[columns]<span style=color:#f92672>.</span>apply(converter)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flights <span style=color:#f92672>=</span> read(<span style=color:#e6db74>&#34;878167309_T_ONTIME.csv&#34;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>locs <span style=color:#f92672>=</span> weather<span style=color:#f92672>.</span>index<span style=color:#f92672>.</span>levels[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&amp;</span> flights<span style=color:#f92672>.</span>origin<span style=color:#f92672>.</span>unique()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(weather<span style=color:#f92672>.</span>reset_index(level<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;station&#39;</span>)
</span></span><span style=display:flex><span> <span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;station in @locs&#39;</span>)
</span></span><span style=display:flex><span> <span style=color:#f92672>.</span>groupby([<span style=color:#e6db74>&#39;station&#39;</span>, pd<span style=color:#f92672>.</span>TimeGrouper(<span style=color:#e6db74>&#39;H&#39;</span>)]))<span style=color:#f92672>.</span>mean()
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th></th><th>tmpf</th><th>relh</th><th>sped</th><th>mslp</th><th>p01i</th><th>vsby</th><th>gust_mph</th></tr><tr><th>station</th><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th rowspan=5 valign=top>ABE</th><th>2014-01-01 00:00:00</th><td>26.06</td><td>47.82</td><td>14.8</td><td>1024.4</td><td>0.0</td><td>10.0</td><td>21.7</td></tr><tr><th>2014-01-01 01:00:00</th><td>24.08</td><td>51.93</td><td>8.0</td><td>1025.2</td><td>0.0</td><td>10.0</td><td>NaN</td></tr><tr><th>2014-01-01 02:00:00</th><td>24.08</td><td>49.87</td><td>6.8</td><td>1025.7</td><td>0.0</td><td>10.0</td><td>NaN</td></tr><tr><th>2014-01-01 03:00:00</th><td>23.00</td><td>52.18</td><td>9.1</td><td>1026.2</td><td>0.0</td><td>10.0</td><td>NaN</td></tr><tr><th>2014-01-01 04:00:00</th><td>23.00</td><td>52.18</td><td>4.6</td><td>1026.4</td><td>0.0</td><td>10.0</td><td>NaN</td></tr><tr><th>...</th><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th rowspan=5 valign=top>XNA</th><th>2014-01-30 19:00:00</th><td>44.96</td><td>38.23</td><td>16.0</td><td>1009.7</td><td>0.0</td><td>10.0</td><td>25.1</td></tr><tr><th>2014-01-30 20:00:00</th><td>46.04</td><td>41.74</td><td>16.0</td><td>1010.3</td><td>0.0</td><td>10.0</td><td>NaN</td></tr><tr><th>2014-01-30 21:00:00</th><td>46.04</td><td>41.74</td><td>13.7</td><td>1010.9</td><td>0.0</td><td>10.0</td><td>20.5</td></tr><tr><th>2014-01-30 22:00:00</th><td>42.98</td><td>46.91</td><td>11.4</td><td>1011.5</td><td>0.0</td><td>10.0</td><td>NaN</td></tr><tr><th>2014-01-30 23:00:00</th><td>39.92</td><td>54.81</td><td>3.4</td><td>1012.2</td><td>0.0</td><td>10.0</td><td>NaN</td></tr></tbody></table><p>191445 rows × 7 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> (flights<span style=color:#f92672>.</span>copy()[[<span style=color:#e6db74>&#39;unique_carrier&#39;</span>, <span style=color:#e6db74>&#39;tail_num&#39;</span>, <span style=color:#e6db74>&#39;origin&#39;</span>, <span style=color:#e6db74>&#39;dep_time&#39;</span>]]
</span></span><span style=display:flex><span>      <span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;origin in @locs&#39;</span>))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>weather<span style=color:#f92672>.</span>loc[<span style=color:#e6db74>&#39;DSM&#39;</span>]
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>tmpf</th><th>relh</th><th>sped</th><th>mslp</th><th>p01i</th><th>vsby</th><th>gust_mph</th><th>skyc1</th><th>skyc2</th><th>skyc3</th></tr><tr><th>date</th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><th>2014-01-01 00:54:00</th><td>10.94</td><td>72.79</td><td>10.3</td><td>1024.9</td><td>0.0</td><td>10.0</td><td>NaN</td><td>FEW</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 01:54:00</th><td>10.94</td><td>72.79</td><td>11.4</td><td>1025.4</td><td>0.0</td><td>10.0</td><td>NaN</td><td>OVC</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 02:54:00</th><td>10.94</td><td>72.79</td><td>8.0</td><td>1025.3</td><td>0.0</td><td>10.0</td><td>NaN</td><td>BKN</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 03:54:00</th><td>10.94</td><td>72.79</td><td>9.1</td><td>1025.3</td><td>0.0</td><td>10.0</td><td>NaN</td><td>OVC</td><td>M</td><td>M</td></tr><tr><th>2014-01-01 04:54:00</th><td>10.04</td><td>72.69</td><td>9.1</td><td>1024.7</td><td>0.0</td><td>10.0</td><td>NaN</td><td>BKN</td><td>M</td><td>M</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>2014-01-30 19:54:00</th><td>30.92</td><td>55.99</td><td>28.5</td><td>1006.3</td><td>0.0</td><td>10.0</td><td>35.3</td><td>FEW</td><td>FEW</td><td>M</td></tr><tr><th>2014-01-30 20:54:00</th><td>30.02</td><td>55.42</td><td>14.8</td><td>1008.4</td><td>0.0</td><td>10.0</td><td>28.5</td><td>FEW</td><td>FEW</td><td>M</td></tr><tr><th>2014-01-30 21:54:00</th><td>28.04</td><td>55.12</td><td>18.2</td><td>1010.4</td><td>0.0</td><td>10.0</td><td>26.2</td><td>FEW</td><td>FEW</td><td>M</td></tr><tr><th>2014-01-30 22:54:00</th><td>26.06</td><td>57.04</td><td>13.7</td><td>1011.8</td><td>0.0</td><td>10.0</td><td>NaN</td><td>FEW</td><td>FEW</td><td>M</td></tr><tr><th>2014-01-30 23:54:00</th><td>21.92</td><td>62.13</td><td>13.7</td><td>1013.4</td><td>0.0</td><td>10.0</td><td>NaN</td><td>FEW</td><td>FEW</td><td>M</td></tr></tbody></table><p>896 rows × 10 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>df <span style=color:#f92672>=</span> df
</span></span></code></pre></div><div><table border=0 class=dataframe><thead><tr style=text-align:right><th></th><th>fl_date</th><th>unique_carrier</th><th>airline_id</th><th>tail_num</th><th>fl_num</th><th>origin_airport_id</th><th>origin_airport_seq_id</th><th>origin_city_market_id</th><th>origin</th><th>origin_city_name</th><th>...</th><th>arr_delay</th><th>cancelled</th><th>cancellation_code</th><th>diverted</th><th>distance</th><th>carrier_delay</th><th>weather_delay</th><th>nas_delay</th><th>security_delay</th><th>late_aircraft_delay</th></tr></thead><tbody><tr><th>0</th><td>2014-01-01</td><td>AA</td><td>19805</td><td>N338AA</td><td>1</td><td>12478</td><td>1247802</td><td>31703</td><td>JFK</td><td>New York</td><td>...</td><td>13.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>2475.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>1</th><td>2014-01-01</td><td>AA</td><td>19805</td><td>N339AA</td><td>2</td><td>12892</td><td>1289203</td><td>32575</td><td>LAX</td><td>Los Angeles</td><td>...</td><td>111.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>2475.0</td><td>111.0</td><td>0.0</td><td>0.0</td><td>0.0</td><td>0.0</td></tr><tr><th>2</th><td>2014-01-01</td><td>AA</td><td>19805</td><td>N335AA</td><td>3</td><td>12478</td><td>1247802</td><td>31703</td><td>JFK</td><td>New York</td><td>...</td><td>13.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>2475.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>3</th><td>2014-01-01</td><td>AA</td><td>19805</td><td>N367AA</td><td>5</td><td>11298</td><td>1129803</td><td>30194</td><td>DFW</td><td>Dallas/Fort Worth</td><td>...</td><td>1.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>3784.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>4</th><td>2014-01-01</td><td>AA</td><td>19805</td><td>N364AA</td><td>6</td><td>13830</td><td>1383002</td><td>33830</td><td>OGG</td><td>Kahului</td><td>...</td><td>-8.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>3711.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>471944</th><td>2014-01-31</td><td>OO</td><td>20304</td><td>N292SW</td><td>5313</td><td>12889</td><td>1288903</td><td>32211</td><td>LAS</td><td>Las Vegas</td><td>...</td><td>-7.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>259.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>471945</th><td>2014-01-31</td><td>OO</td><td>20304</td><td>N580SW</td><td>5314</td><td>12892</td><td>1289203</td><td>32575</td><td>LAX</td><td>Los Angeles</td><td>...</td><td>-12.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>89.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>471946</th><td>2014-01-31</td><td>OO</td><td>20304</td><td>N580SW</td><td>5314</td><td>14689</td><td>1468902</td><td>34689</td><td>SBA</td><td>Santa Barbara</td><td>...</td><td>11.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>89.0</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>471947</th><td>2014-01-31</td><td>OO</td><td>20304</td><td>N216SW</td><td>5315</td><td>11292</td><td>1129202</td><td>30325</td><td>DEN</td><td>Denver</td><td>...</td><td>56.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>260.0</td><td>36.0</td><td>0.0</td><td>13.0</td><td>0.0</td><td>7.0</td></tr><tr><th>471948</th><td>2014-01-31</td><td>OO</td><td>20304</td><td>N216SW</td><td>5315</td><td>14543</td><td>1454302</td><td>34543</td><td>RKS</td><td>Rock Springs</td><td>...</td><td>47.0</td><td>0.0</td><td>NaN</td><td>0.0</td><td>260.0</td><td>0.0</td><td>0.0</td><td>4.0</td><td>0.0</td><td>43.0</td></tr></tbody></table><p>471949 rows × 36 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>dep<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><pre><code>0        2014-01-01 09:14:00
1        2014-01-01 11:32:00
2        2014-01-01 11:57:00
3        2014-01-01 13:07:00
4        2014-01-01 17:53:00
                 ...        
163906   2014-01-11 16:57:00
163910   2014-01-11 11:04:00
181062   2014-01-12 17:02:00
199092   2014-01-13 23:36:00
239150   2014-01-16 16:46:00
Name: dep_time, dtype: datetime64[ns]
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>flights<span style=color:#f92672>.</span>dep_time
</span></span></code></pre></div><pre><code>0        2014-01-01 09:14:00
1        2014-01-01 11:32:00
2        2014-01-01 11:57:00
3        2014-01-01 13:07:00
4        2014-01-01 17:53:00
                 ...        
471944   2014-01-31 09:05:00
471945   2014-01-31 09:24:00
471946   2014-01-31 10:39:00
471947   2014-01-31 09:28:00
471948   2014-01-31 11:22:00
Name: dep_time, dtype: datetime64[ns]
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>flights<span style=color:#f92672>.</span>dep_time<span style=color:#f92672>.</span>unique()
</span></span></code></pre></div><pre><code>array(['2014-01-01T03:14:00.000000000-0600',
       '2014-01-01T05:32:00.000000000-0600',
       '2014-01-01T05:57:00.000000000-0600', ...,
       '2014-01-30T18:44:00.000000000-0600',
       '2014-01-31T17:16:00.000000000-0600',
       '2014-01-30T18:47:00.000000000-0600'], dtype='datetime64[ns]')
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>stations
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>flights<span style=color:#f92672>.</span>dep_time<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><pre><code>0   2014-01-01 09:14:00
1   2014-01-01 11:32:00
2   2014-01-01 11:57:00
3   2014-01-01 13:07:00
4   2014-01-01 17:53:00
Name: dep_time, dtype: datetime64[ns]
</code></pre></div><footer class=post-footer><ul class=post-tags><li><a href=https://tomaugspurger.net/tags/pandas/>pandas</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://tomaugspurger.net>Tom's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><a rel=me href=https://mastodon.social/@TomAugspurger></a>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
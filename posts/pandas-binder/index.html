<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>pandas + binder | Tom's Blog</title>
<meta name=keywords content="pandas"><meta name=description content="This post describes the start of a journey to get pandas&rsquo; documentation running on Binder. The end result is this nice button:
For a while now I&rsquo;ve been jealous of Dask&rsquo;s examples repository. That&rsquo;s a repository containing a collection of Jupyter notebooks demonstrating Dask in action. It stitches together some tools to present a set of documentation that is both viewable as a static site at examples.dask.org, and as a executable notebooks on mybinder."><meta name=author content><link rel=canonical href=https://tomaugspurger.net/posts/pandas-binder/><link crossorigin=anonymous href=/assets/css/stylesheet.ced21e6d3497ee93fed8f8b357448095840179bd510b5ea0e6013078712e6dd1.css integrity="sha256-ztIebTSX7pP+2PizV0SAlYQBeb1RC16g5gEweHEubdE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomaugspurger.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomaugspurger.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomaugspurger.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tomaugspurger.net/apple-touch-icon.png><link rel=mask-icon href=https://tomaugspurger.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="pandas + binder"><meta property="og:description" content="This post describes the start of a journey to get pandas&rsquo; documentation running on Binder. The end result is this nice button:
For a while now I&rsquo;ve been jealous of Dask&rsquo;s examples repository. That&rsquo;s a repository containing a collection of Jupyter notebooks demonstrating Dask in action. It stitches together some tools to present a set of documentation that is both viewable as a static site at examples.dask.org, and as a executable notebooks on mybinder."><meta property="og:type" content="article"><meta property="og:url" content="https://tomaugspurger.net/posts/pandas-binder/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-07-21T00:00:00+00:00"><meta property="article:modified_time" content="2019-07-21T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="pandas + binder"><meta name=twitter:description content="This post describes the start of a journey to get pandas&rsquo; documentation running on Binder. The end result is this nice button:
For a while now I&rsquo;ve been jealous of Dask&rsquo;s examples repository. That&rsquo;s a repository containing a collection of Jupyter notebooks demonstrating Dask in action. It stitches together some tools to present a set of documentation that is both viewable as a static site at examples.dask.org, and as a executable notebooks on mybinder."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://tomaugspurger.net/posts/"},{"@type":"ListItem","position":3,"name":"pandas + binder","item":"https://tomaugspurger.net/posts/pandas-binder/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"pandas + binder","name":"pandas \u002b binder","description":"This post describes the start of a journey to get pandas\u0026rsquo; documentation running on Binder. The end result is this nice button:\nFor a while now I\u0026rsquo;ve been jealous of Dask\u0026rsquo;s examples repository. That\u0026rsquo;s a repository containing a collection of Jupyter notebooks demonstrating Dask in action. It stitches together some tools to present a set of documentation that is both viewable as a static site at examples.dask.org, and as a executable notebooks on mybinder.","keywords":["pandas"],"articleBody":"This post describes the start of a journey to get pandas’ documentation running on Binder. The end result is this nice button:\nFor a while now I’ve been jealous of Dask’s examples repository. That’s a repository containing a collection of Jupyter notebooks demonstrating Dask in action. It stitches together some tools to present a set of documentation that is both viewable as a static site at examples.dask.org, and as a executable notebooks on mybinder.\nA bit of background on binder: it’s a tool for creating a shareable computing environment. This is perfect for introductory documentation. A prospective user may want to just try out a library to get a feel for it before they commit to installing. BinderHub is a tool for deploying binder services. You point a binderhub deployment (like mybinder) at a git repository with a collection of notebooks and an environment specification, and out comes your executable documentation.\nThanks to a lot of hard work by contributors and maintainers, the code examples in pandas’ documentation are already runnable (and this is verified on each commit). We use the IPython Sphinx Extension to execute examples and include their output. We write documentation like\n.. ipython:: python import pandas as pd s = pd.Series([1, 2]) s Which is then executed and rendered in the HTML docs as\nIn [1]: import pandas as pd In [2]: s = pd.Series([1, 2, 3]) In [3]: s Out[3]: 0 1 1 2 2 3 dtype: int64 So we have the most important thing: a rich source of documentation that’s already runnable.\nThere were a couple barriers to just pointing binder at https://github.com/pandas-dev/pandas, however. First, binder builds on top of a tool called repo2docker. This is what takes your Git repository and turns it into a Docker image that users will be dropped into. When someone visits the URL, binder will first check to see if it’s built a docker image. If it’s already cached, then that will just be loaded. If not, binder will have to clone the repository and build it from scratch, a time-consuming process. Pandas receives 5-10 commits per day, meaning many users would visit the site and be stuck waiting for a 5-10 minute docker build.1\nSecond, pandas uses Sphinx and ReST for its documentation. Binder needs a collection of Notebooks. Fortunately, the fine folks at QuantEcon (a fellow NumFOCUS project) wrote sphinxcontrib-jupyter, a tool for turning ReST files to Jupyter notebooks. Just what we needed.\nSo we had some great documentation that already runs, and a tool for converting ReST files to Jupyter notebooks. All the pieces were falling into place!\nUnfortunately, my first attempt failed. sphinxcontrib-jupyter looks for directives like\n.. code:: python while pandas uses\n.. ipython:: python I started slogging down a path to teach sphinxcontrib-jupyter how to recognize the IPython directive pandas uses when my kid woke up from his nap. Feeling dejected I gave up.\nBut later in the day, I had the (obvious in hindsight) realization that we have plenty of tools for substituting lines of text. A few (non-obvious) lines of bash later and we were ready to go. All the .. ipython:: python directives were now .. code:: python. Moral of the story: take breaks.\nMy work currently lives in this repository, and the notebooks are runnable on mybinder. But the short version is\nWe include github.com/pandas-dev/pandas as a submodule (which repo2docker supports just fine) We patch pandas Sphinx config to include sphinxcontrib-jupyter and its configuration We patch pandas source docs to change the ipython directives to be .. code:: python directives. I’m reasonably happy with how things are shaping up. I plan to migrate my repository to the pandas organization and propose a few changes to the pandas documentation (like a small header pointing from the rendered HTML docs to the binder). If you’d like to follow along, subscribe to this pandas issue.\nI’m also hopeful that other projects can apply a similar approach to their documentation too.\nI realize now that binder can target a specific branch or commit. I’m not sure if additional commits to that repository will trigger a rebuild, but I suspect not. We still needed to solve problem 2 though. ↩︎\n","wordCount":"696","inLanguage":"en","datePublished":"2019-07-21T00:00:00Z","dateModified":"2019-07-21T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomaugspurger.net/posts/pandas-binder/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://tomaugspurger.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomaugspurger.net accesskey=h title="Tom's Blog (Alt + H)">Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tomaugspurger.net/about/ title=About><span>About</span></a></li><li><a href=https://tomaugspurger.net/archives title=Archive><span>Archive</span></a></li><li><a href=https://tomaugspurger.net/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://tomaugspurger.net/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">pandas + binder</h1><div class=post-meta><span title='2019-07-21 00:00:00 +0000 UTC'>July 21, 2019</span></div></header><div class=post-content><p>This post describes the start of a journey to get pandas&rsquo; documentation running
on Binder. The end result is this nice button:</p><p><a href="https://mybinder.org/v2/gh/TomAugspurger/pandas-binder/master?filepath=build%2Fjupyter%2Fgetting_started%2F10min.ipynb"><img loading=lazy src=https://mybinder.org/badge_logo.svg alt=Binder></a></p><hr><p>For a while now I&rsquo;ve been jealous of <a href=https://github.com/dask/dask-examples>Dask&rsquo;s examples
repository</a>. That&rsquo;s a repository containing a
collection of Jupyter notebooks demonstrating Dask in action. It stitches
together some tools to present a set of documentation that is both viewable
as a static site at <a href=https://examples.dask.org>examples.dask.org</a>, and as a executable notebooks
on <a href="https://mybinder.org/v2/gh/dask/dask-examples/master?urlpath=lab">mybinder</a>.</p><p>A bit of background on binder: it&rsquo;s a tool for creating a shareable computing
environment. This is perfect for introductory documentation. A prospective user
may want to just try out a library to get a feel for it before they commit to
installing. Binder<em>Hub</em> is a tool for deploying binder services. You point a
binderhub deployment (like <a href=https://mybinder.org>mybinder</a>) at a git repository
with a collection of notebooks and an environment specification, and out comes
your executable documentation.</p><p>Thanks to a lot of hard work by contributors and maintainers, the code examples
in pandas&rsquo; documentation are already runnable (and this is verified on each
commit). We use the <a href=https://ipython.readthedocs.io/en/stable/sphinxext.html>IPython Sphinx
Extension</a> to execute
examples and include their output. We write documentation like</p><pre tabindex=0><code>.. ipython:: python

   import pandas as pd
   s = pd.Series([1, 2])
   s
</code></pre><p>Which is then <em>executed</em> and rendered in the HTML docs as</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>In [<span style=color:#ae81ff>1</span>]: <span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>2</span>]: s <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Series([<span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>3</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>In [<span style=color:#ae81ff>3</span>]: s
</span></span><span style=display:flex><span>Out[<span style=color:#ae81ff>3</span>]:
</span></span><span style=display:flex><span><span style=color:#ae81ff>0</span>    <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>    <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>2</span>    <span style=color:#ae81ff>3</span>
</span></span><span style=display:flex><span>dtype: int64
</span></span></code></pre></div><p>So we have the most important thing: a rich source of documentation that&rsquo;s
already runnable.</p><p>There were a couple barriers to just pointing binder at
<code>https://github.com/pandas-dev/pandas</code>, however. First, binder builds on top of
a tool called <a href=https://repo2docker.readthedocs.io/en/latest/>repo2docker</a>. This
is what takes your Git repository and turns it into a Docker image that users
will be dropped into. When someone visits the URL, binder will first check to
see if it&rsquo;s built a docker image. If it&rsquo;s already cached, then that will just be
loaded. If not, binder will have to clone the repository and build it from
scratch, a time-consuming process. Pandas receives 5-10 commits per day, meaning
many users would visit the site and be stuck waiting for a 5-10 minute docker
build.<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p>Second, pandas uses Sphinx and ReST for its documentation. Binder needs a collection
of Notebooks. Fortunately, the fine folks at <a href=https://quantecon.org>QuantEcon</a>
(a fellow NumFOCUS project) wrote
<a href=https://sphinxcontrib-jupyter.readthedocs.io><code>sphinxcontrib-jupyter</code></a>, a tool
for turning ReST files to Jupyter notebooks. Just what we needed.</p><p>So we had some great documentation that already runs, and a tool for converting
ReST files to Jupyter notebooks. All the pieces were falling into place!</p><p>Unfortunately, my first attempt failed. <code>sphinxcontrib-jupyter</code> looks for directives
like</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rst data-lang=rst><span style=display:flex><span>.. <span style=color:#f92672>code</span>:: python<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>while pandas uses</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-rst data-lang=rst><span style=display:flex><span>.. <span style=color:#f92672>ipython</span>:: python<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>I started slogging down a path to teach <code>sphinxcontrib-jupyter</code> how to recognize
the IPython directive pandas uses when my kid woke up from his nap. Feeling
dejected I gave up.</p><p>But later in the day, I had the (obvious in hindsight) realization that we have
plenty of tools for substituting lines of text. A few (non-obvious) <a href=https://github.com/TomAugspurger/pandas-binder/blob/20fc3e8f52a05d4b291211a41ed3015f37758f81/Makefile#L4>lines of
bash
later</a>
and we were ready to go. All the <code>.. ipython:: python</code> directives were now <code>.. code:: python</code>. Moral of the story: take breaks.</p><p>My work currently lives in <a href=https://github.com/TomAugspurger/pandas-binder>this repository</a>, and
the notebooks are runnable <a href="https://mybinder.org/v2/gh/TomAugspurger/pandas-binder/master?filepath=build%2Fjupyter%2Fgetting_started%2F10min.ipynb">on mybinder</a>. But the short version is</p><ol><li>We include github.com/pandas-dev/pandas as a submodule (which repo2docker
supports just fine)</li><li>We patch pandas Sphinx config to include sphinxcontrib-jupyter and its
configuration</li><li>We patch pandas source docs to change the ipython directives to be <code>.. code:: python</code> directives.</li></ol><p>I&rsquo;m reasonably happy with how things are shaping up. I plan to migrate my repository
to the pandas organization and propose a few changes to the pandas documentation
(like a small header pointing from the rendered HTML docs to the binder). If you&rsquo;d like to follow along,
subscribe to <a href=https://github.com/pandas-dev/pandas/issues/27514>this pandas issue</a>.</p><p>I&rsquo;m also hopeful that other projects can apply a similar approach to their documentation too.</p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>I realize now that binder can target a specific branch or commit. I&rsquo;m not
sure if additional commits to that repository will trigger a rebuild, but
I suspect not. We still needed to solve problem 2 though.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://tomaugspurger.net/tags/pandas/>pandas</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://tomaugspurger.net>Tom's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><a rel=me href=https://mastodon.social/@TomAugspurger></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>dplyr and pandas | Tom's Blog</title>
<meta name=keywords content="python,data science,pandas"><meta name=description content="This notebook compares pandas
and dplyr.
The comparison is just on syntax (verbage), not performance. Whether you&rsquo;re an R user looking to switch to pandas (or the other way around), I hope this guide will help ease the transition.
We&rsquo;ll work through the introductory dplyr vignette to analyze some flight data.
I&rsquo;m working on a better layout to show the two packages side by side.
But for now I&rsquo;m just putting the dplyr code in a comment above each python call."><meta name=author content><link rel=canonical href=https://tomaugspurger.net/posts/dplyr-pandas/><link crossorigin=anonymous href=/assets/css/stylesheet.ced21e6d3497ee93fed8f8b357448095840179bd510b5ea0e6013078712e6dd1.css integrity="sha256-ztIebTSX7pP+2PizV0SAlYQBeb1RC16g5gEweHEubdE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomaugspurger.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomaugspurger.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomaugspurger.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tomaugspurger.net/apple-touch-icon.png><link rel=mask-icon href=https://tomaugspurger.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomaugspurger.net/posts/dplyr-pandas/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="dplyr and pandas"><meta property="og:description" content="This notebook compares pandas
and dplyr.
The comparison is just on syntax (verbage), not performance. Whether you&rsquo;re an R user looking to switch to pandas (or the other way around), I hope this guide will help ease the transition.
We&rsquo;ll work through the introductory dplyr vignette to analyze some flight data.
I&rsquo;m working on a better layout to show the two packages side by side.
But for now I&rsquo;m just putting the dplyr code in a comment above each python call."><meta property="og:type" content="article"><meta property="og:url" content="https://tomaugspurger.net/posts/dplyr-pandas/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2014-10-16T07:00:00+00:00"><meta property="article:modified_time" content="2014-10-16T07:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="dplyr and pandas"><meta name=twitter:description content="This notebook compares pandas
and dplyr.
The comparison is just on syntax (verbage), not performance. Whether you&rsquo;re an R user looking to switch to pandas (or the other way around), I hope this guide will help ease the transition.
We&rsquo;ll work through the introductory dplyr vignette to analyze some flight data.
I&rsquo;m working on a better layout to show the two packages side by side.
But for now I&rsquo;m just putting the dplyr code in a comment above each python call."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomaugspurger.net/posts/"},{"@type":"ListItem","position":2,"name":"dplyr and pandas","item":"https://tomaugspurger.net/posts/dplyr-pandas/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"dplyr and pandas","name":"dplyr and pandas","description":"This notebook compares pandas and dplyr. The comparison is just on syntax (verbage), not performance. Whether you\u0026rsquo;re an R user looking to switch to pandas (or the other way around), I hope this guide will help ease the transition.\nWe\u0026rsquo;ll work through the introductory dplyr vignette to analyze some flight data.\nI\u0026rsquo;m working on a better layout to show the two packages side by side. But for now I\u0026rsquo;m just putting the dplyr code in a comment above each python call.\n","keywords":["python","data science","pandas"],"articleBody":"This notebook compares pandas and dplyr. The comparison is just on syntax (verbage), not performance. Whether you’re an R user looking to switch to pandas (or the other way around), I hope this guide will help ease the transition.\nWe’ll work through the introductory dplyr vignette to analyze some flight data.\nI’m working on a better layout to show the two packages side by side. But for now I’m just putting the dplyr code in a comment above each python call.\n# Some prep work to get the data from R and into pandas %matplotlib inline %load_ext rmagic import pandas as pd import seaborn as sns pd.set_option(\"display.max_rows\", 5) /Users/tom/Envs/py3/lib/python3.4/site-packages/IPython/extensions/rmagic.py:693: UserWarning: The rmagic extension in IPython is deprecated in favour of rpy2.ipython. If available, that will be loaded instead. http://rpy.sourceforge.net/ warnings.warn(\"The rmagic extension in IPython is deprecated in favour of \" %%R library(\"nycflights13\") write.csv(flights, \"flights.csv\") Data: nycflights13 flights = pd.read_csv(\"flights.csv\", index_col=0) # dim(flights) \u003c--- The R code flights.shape # \u003c--- The python code (336776, 16) # head(flights) flights.head() year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 3 2013 1 1 542 2 923 33 AA N619AA 1141 JFK MIA 160 1089 5 42 4 2013 1 1 544 -1 1004 -18 B6 N804JB 725 JFK BQN 183 1576 5 44 5 2013 1 1 554 -6 812 -25 DL N668DN 461 LGA ATL 116 762 5 54 Single table verbs dplyr has a small set of nicely defined verbs. I’ve listed their closest pandas verbs.\ndplyr pandas filter() (and slice()) query() (and loc[], iloc[]) arrange() sort() select() (and rename()) \\_\\_getitem\\_\\_ (and rename()) distinct() drop_duplicates() mutate() (and transmute()) None summarise() None sample_n() and sample_frac() None Some of the “missing” verbs in pandas are because there are other, different ways of achieving the same goal. For example summarise is spread across mean, std, etc. Others, like sample_n, just haven’t been implemented yet.\nFilter rows with filter(), query() # filter(flights, month == 1, day == 1) flights.query(\"month == 1 \u0026 day == 1\") year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 841 2013 1 1 NaN NaN NaN NaN AA N3EVAA 1925 LGA MIA NaN 1096 NaN NaN 842 2013 1 1 NaN NaN NaN NaN B6 N618JB 125 JFK FLL NaN 1069 NaN NaN 842 rows × 16 columns\nThe more verbose version:\n# flights[flights$month == 1 \u0026 flights$day == 1, ] flights[(flights.month == 1) \u0026 (flights.day == 1)] year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 841 2013 1 1 NaN NaN NaN NaN AA N3EVAA 1925 LGA MIA NaN 1096 NaN NaN 842 2013 1 1 NaN NaN NaN NaN B6 N618JB 125 JFK FLL NaN 1069 NaN NaN 842 rows × 16 columns\n# slice(flights, 1:10) flights.iloc[:9] year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 8 2013 1 1 557 -3 709 -14 EV N829AS 5708 LGA IAD 53 229 5 57 9 2013 1 1 557 -3 838 -8 B6 N593JB 79 JFK MCO 140 944 5 57 9 rows × 16 columns\nArrange rows with arrange(), sort() # arrange(flights, year, month, day) flights.sort(['year', 'month', 'day']) year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 111295 2013 12 31 NaN NaN NaN NaN UA NaN 219 EWR ORD NaN 719 NaN NaN 111296 2013 12 31 NaN NaN NaN NaN UA NaN 443 JFK LAX NaN 2475 NaN NaN 336776 rows × 16 columns\n# arrange(flights, desc(arr_delay)) flights.sort('arr_delay', ascending=False) year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute 7073 2013 1 9 641 1301 1242 1272 HA N384HA 51 JFK HNL 640 4983 6 41 235779 2013 6 15 1432 1137 1607 1127 MQ N504MQ 3535 JFK CMH 74 483 14 32 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 336775 2013 9 30 NaN NaN NaN NaN MQ N511MQ 3572 LGA CLE NaN 419 NaN NaN 336776 2013 9 30 NaN NaN NaN NaN MQ N839MQ 3531 LGA RDU NaN 431 NaN NaN 336776 rows × 16 columns\nSelect columns with select(), [] # select(flights, year, month, day) flights[['year', 'month', 'day']] year month day 1 2013 1 1 2 2013 1 1 ... ... ... ... 336775 2013 9 30 336776 2013 9 30 336776 rows × 3 columns\n# select(flights, year:day) # No real equivalent here. Although I think this is OK. # Typically I'll have the columns I want stored in a list # somewhere, which can be passed right into __getitem__ ([]). # select(flights, -(year:day)) # Again, simliar story. I would just use # flights.drop(cols_to_drop, axis=1) # or fligths[flights.columns.difference(pd.Index(cols_to_drop))] # point to dplyr! # select(flights, tail_num = tailnum) flights.rename(columns={'tailnum': 'tail_num'})['tail_num'] 1 N14228 ... 336776 N839MQ Name: tail_num, Length: 336776, dtype: object But like Hadley mentions, not that useful since it only returns the one column. dplyr and pandas compare well here.\n# rename(flights, tail_num = tailnum) flights.rename(columns={'tailnum': 'tail_num'}) year month day dep_time dep_delay arr_time arr_delay carrier tail_num flight origin dest air_time distance hour minute 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 336775 2013 9 30 NaN NaN NaN NaN MQ N511MQ 3572 LGA CLE NaN 419 NaN NaN 336776 2013 9 30 NaN NaN NaN NaN MQ N839MQ 3531 LGA RDU NaN 431 NaN NaN 336776 rows × 16 columns\nPandas is more verbose, but the the argument to columns can be any mapping. So it’s often used with a function to perform a common task, say df.rename(columns=lambda x: x.replace('-', '_')) to replace any dashes with underscores. Also, rename (the pandas version) can be applied to the Index.\nExtract distinct (unique) rows # distinct(select(flights, tailnum)) flights.tailnum.unique() array(['N14228', 'N24211', 'N619AA', ..., 'N776SK', 'N785SK', 'N557AS'], dtype=object) FYI this returns a numpy array instead of a Series.\n# distinct(select(flights, origin, dest)) flights[['origin', 'dest']].drop_duplicates() origin dest 1 EWR IAH 2 LGA IAH ... ... ... 255456 EWR ANC 275946 EWR LGA 224 rows × 2 columns\nOK, so dplyr wins there from a consistency point of view. unique is only defined on Series, not DataFrames. The original intention for drop_duplicates is to check for records that were accidentally included twice. This feels a bit hacky using it to select the distinct combinations, but it works!\nAdd new columns with mutate() # mutate(flights, # gain = arr_delay - dep_delay, # speed = distance / air_time * 60) flights['gain'] = flights.arr_delay - flights.dep_delay flights['speed'] = flights.distance / flights.air_time * 60 flights year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute gain speed 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 9 370.044053 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 16 374.273128 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 336775 2013 9 30 NaN NaN NaN NaN MQ N511MQ 3572 LGA CLE NaN 419 NaN NaN NaN NaN 336776 2013 9 30 NaN NaN NaN NaN MQ N839MQ 3531 LGA RDU NaN 431 NaN NaN NaN NaN 336776 rows × 18 columns\n# mutate(flights, # gain = arr_delay - dep_delay, # gain_per_hour = gain / (air_time / 60) # ) flights['gain'] = flights.arr_delay - flights.dep_delay flights['gain_per_hour'] = flights.gain / (flights.air_time / 60) flights year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute gain speed gain_per_hour 1 2013 1 1 517 2 830 11 UA N14228 1545 EWR IAH 227 1400 5 17 9 370.044053 2.378855 2 2013 1 1 533 4 850 20 UA N24211 1714 LGA IAH 227 1416 5 33 16 374.273128 4.229075 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 336775 2013 9 30 NaN NaN NaN NaN MQ N511MQ 3572 LGA CLE NaN 419 NaN NaN NaN NaN NaN 336776 2013 9 30 NaN NaN NaN NaN MQ N839MQ 3531 LGA RDU NaN 431 NaN NaN NaN NaN NaN 336776 rows × 19 columns\ndplyr's approach may be nicer here since you get to refer to the variables in subsequent statements within the mutate(). To achieve this with pandas, you have to add the gain variable as another column in flights. If I don’t want it around I would have to explicitly drop it.\n# transmute(flights, # gain = arr_delay - dep_delay, # gain_per_hour = gain / (air_time / 60) # ) flights['gain'] = flights.arr_delay - flights.dep_delay flights['gain_per_hour'] = flights.gain / (flights.air_time / 60) flights[['gain', 'gain_per_hour']] gain gain_per_hour 1 9 2.378855 2 16 4.229075 ... ... ... 336775 NaN NaN 336776 NaN NaN 336776 rows × 2 columns\nSummarise values with summarise() flights.dep_delay.mean() 12.639070257304708 Randomly sample rows with sample_n() and sample_frac() There’s an open PR on Github to make this nicer (closer to dplyr). For now you can drop down to numpy.\n# sample_n(flights, 10) flights.loc[np.random.choice(flights.index, 10)] year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute gain speed gain_per_hour 316903 2013 9 9 1539 -6 1650 -43 9E N918XJ 3459 JFK BNA 98 765 15 39 -37 468.367347 -22.653061 105369 2013 12 25 905 0 1126 -7 FL N939AT 275 LGA ATL 117 762 9 5 -7 390.769231 -3.589744 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 82862 2013 11 30 1627 -8 1750 -35 AA N4XRAA 343 LGA ORD 111 733 16 27 -27 396.216216 -14.594595 190653 2013 4 28 748 -7 856 -24 MQ N520MQ 3737 EWR ORD 107 719 7 48 -17 403.177570 -9.532710 10 rows × 19 columns\n# sample_frac(flights, 0.01) flights.iloc[np.random.randint(0, len(flights), .1 * len(flights))] year month day dep_time dep_delay arr_time arr_delay carrier tailnum flight origin dest air_time distance hour minute gain speed gain_per_hour 188581 2013 4 25 1836 -4 2145 7 DL N398DA 1629 JFK LAS 313 2248 18 36 11 430.926518 2.108626 307015 2013 8 29 1258 5 1409 -4 EV N12957 6054 EWR IAD 46 212 12 58 -9 276.521739 -11.739130 ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... ... 286563 2013 8 7 2126 18 6 7 UA N822UA 373 EWR PBI 138 1023 21 26 -11 444.782609 -4.782609 62818 2013 11 8 1300 0 1615 5 VX N636VA 411 JFK LAX 349 2475 13 0 5 425.501433 0.859599 33677 rows × 19 columns\nGrouped operations # planes \u003c- group_by(flights, tailnum) # delay \u003c- summarise(planes, # count = n(), # dist = mean(distance, na.rm = TRUE), # delay = mean(arr_delay, na.rm = TRUE)) # delay \u003c- filter(delay, count \u003e 20, dist \u003c 2000) planes = flights.groupby(\"tailnum\") delay = planes.agg({\"year\": \"count\", \"distance\": \"mean\", \"arr_delay\": \"mean\"}) delay.query(\"year \u003e 20 \u0026 distance \u003c 2000\") year arr_delay distance tailnum N0EGMQ 371 9.982955 676.188679 N10156 153 12.717241 757.947712 ... ... ... ... N999DN 61 14.311475 895.459016 N9EAMQ 248 9.235294 674.665323 2961 rows × 3 columns\nFor me, dplyr’s n() looked is a bit starge at first, but it’s already growing on me.\nI think pandas is more difficult for this particular example. There isn’t as natural a way to mix column-agnostic aggregations (like count) with column-specific aggregations like the other two. You end up writing could like .agg{'year': 'count'} which reads, “I want the count of year”, even though you don’t care about year specifically. Additionally assigning names can’t be done as cleanly in pandas; you have to just follow it up with a rename like before.\n# destinations \u003c- group_by(flights, dest) # summarise(destinations, # planes = n_distinct(tailnum), # flights = n() # ) destinations = flights.groupby('dest') destinations.agg({ 'tailnum': lambda x: len(x.unique()), 'year': 'count' }).rename(columns={'tailnum': 'planes', 'year': 'flights'}) flights planes dest ABQ 254 108 ACK 265 58 ... ... ... TYS 631 273 XNA 1036 176 105 rows × 2 columns\nSimilar to how dplyr provides optimized C++ versions of most of the summarise functions, pandas uses cython optimized versions for most of the agg methods.\n# daily \u003c- group_by(flights, year, month, day) # (per_day \u003c- summarise(daily, flights = n())) daily = flights.groupby(['year', 'month', 'day']) per_day = daily['distance'].count() per_day year month day 2013 1 1 842 ... 2013 12 31 776 Name: distance, Length: 365, dtype: int64 # (per_month \u003c- summarise(per_day, flights = sum(flights))) per_month = per_day.groupby(level=['year', 'month']).sum() per_month year month 2013 1 27004 ... 2013 12 28135 Name: distance, Length: 12, dtype: int64 # (per_year \u003c- summarise(per_month, flights = sum(flights))) per_year = per_month.sum() per_year 336776 I’m not sure how dplyr is handling the other columns, like year, in the last example. With pandas, it’s clear that we’re grouping by them since they’re included in the groupby. For the last example, we didn’t group by anything, so they aren’t included in the result.\nChaining Any follower of Hadley’s twitter account will know how much R users love the %\u003e% (pipe) operator. And for good reason!\n# flights %\u003e% # group_by(year, month, day) %\u003e% # select(arr_delay, dep_delay) %\u003e% # summarise( # arr = mean(arr_delay, na.rm = TRUE), # dep = mean(dep_delay, na.rm = TRUE) # ) %\u003e% # filter(arr \u003e 30 | dep \u003e 30) ( flights.groupby(['year', 'month', 'day']) [['arr_delay', 'dep_delay']] .mean() .query('arr_delay \u003e 30 | dep_delay \u003e 30') ) arr_delay dep_delay year month day 2013 1 16 34.247362 24.612865 31 32.602854 28.658363 1 ... ... ... 12 17 55.871856 40.705602 23 32.226042 32.254149 49 rows × 2 columns\nOther Data Sources Pandas has tons IO tools to help you get data in and out, including SQL databases via SQLAlchemy.\nSummary I think pandas held up pretty well, considering this was a vignette written for dplyr. I found the degree of similarity more interesting than the differences. The most difficult task was renaming of columns within an operation; they had to be followed up with a call to rename after the operation, which isn’t that burdensome honestly.\nMore and more it looks like we’re moving towards future where being a language or package partisan just doesn’t make sense. Not when you can load up a Jupyter (formerly IPython) notebook to call up a library written in R, and hand those results off to python or Julia or whatever for followup, before going back to R to make a cool shiny web app.\nThere will always be a place for your “utility belt” package like dplyr or pandas, but it wouldn’t hurt to be familiar with both.\nIf you want to contribute to pandas, we’re always looking for help at https://github.com/pydata/pandas/. You can get ahold of me directly on twitter.\n","wordCount":"2728","inLanguage":"en","datePublished":"2014-10-16T07:00:00Z","dateModified":"2014-10-16T07:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomaugspurger.net/posts/dplyr-pandas/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://tomaugspurger.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomaugspurger.net/ accesskey=h title="Tom's Blog (Alt + H)">Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://tomaugspurger.net/about/ title=About><span>About</span></a></li><li><a href=https://tomaugspurger.net/archives title=Archive><span>Archive</span></a></li><li><a href=https://tomaugspurger.net/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://tomaugspurger.net/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">dplyr and pandas</h1><div class=post-meta><span title='2014-10-16 07:00:00 +0000 UTC'>October 16, 2014</span></div></header><div class=post-content><p>This notebook compares <a href=http://pandas.pydata.org>pandas</a>
and <a href=http://cran.r-project.org/web/packages/dplyr/index.html>dplyr</a>.
The comparison is just on syntax (verbage), not performance. Whether you&rsquo;re an R user looking to switch to pandas (or the other way around), I hope this guide will help ease the transition.</p><p>We&rsquo;ll work through the <a href=http://cran.r-project.org/web/packages/dplyr/vignettes/introduction.html>introductory dplyr vignette</a> to analyze some flight data.</p><p>I&rsquo;m working on a better layout to show the two packages side by side.
But for now I&rsquo;m just putting the <code>dplyr</code> code in a comment above each python call.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># Some prep work to get the data from R and into pandas</span>
</span></span><span style=display:flex><span><span style=color:#f92672>%</span>matplotlib inline
</span></span><span style=display:flex><span><span style=color:#f92672>%</span>load_ext rmagic
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> seaborn <span style=color:#66d9ef>as</span> sns
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>pd<span style=color:#f92672>.</span>set_option(<span style=color:#e6db74>&#34;display.max_rows&#34;</span>, <span style=color:#ae81ff>5</span>)
</span></span></code></pre></div><pre><code>/Users/tom/Envs/py3/lib/python3.4/site-packages/IPython/extensions/rmagic.py:693: UserWarning: The rmagic extension in IPython is deprecated in favour of rpy2.ipython. If available, that will be loaded instead.
http://rpy.sourceforge.net/
  warnings.warn(&quot;The rmagic extension in IPython is deprecated in favour of &quot;
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-r data-lang=r><span style=display:flex><span><span style=color:#f92672>%%</span>R
</span></span><span style=display:flex><span><span style=color:#a6e22e>library</span>(<span style=color:#e6db74>&#34;nycflights13&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#a6e22e>write.csv</span>(flights, <span style=color:#e6db74>&#34;flights.csv&#34;</span>)
</span></span></code></pre></div><h1 id=data-nycflights13>Data: nycflights13<a hidden class=anchor aria-hidden=true href=#data-nycflights13>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>flights <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74>&#34;flights.csv&#34;</span>, index_col<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># dim(flights)   &lt;--- The R code</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>shape  <span style=color:#75715e># &lt;--- The python code</span>
</span></span></code></pre></div><pre><code>(336776, 16)
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># head(flights)</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>head()
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td></tr><tr><th>3</th><td>2013</td><td>1</td><td>1</td><td>542</td><td>2</td><td>923</td><td>33</td><td>AA</td><td>N619AA</td><td>1141</td><td>JFK</td><td>MIA</td><td>160</td><td>1089</td><td>5</td><td>42</td></tr><tr><th>4</th><td>2013</td><td>1</td><td>1</td><td>544</td><td>-1</td><td>1004</td><td>-18</td><td>B6</td><td>N804JB</td><td>725</td><td>JFK</td><td>BQN</td><td>183</td><td>1576</td><td>5</td><td>44</td></tr><tr><th>5</th><td>2013</td><td>1</td><td>1</td><td>554</td><td>-6</td><td>812</td><td>-25</td><td>DL</td><td>N668DN</td><td>461</td><td>LGA</td><td>ATL</td><td>116</td><td>762</td><td>5</td><td>54</td></tr></tbody></table></div><h1 id=single-table-verbs>Single table verbs<a hidden class=anchor aria-hidden=true href=#single-table-verbs>#</a></h1><p><code>dplyr</code> has a small set of nicely defined verbs. I&rsquo;ve listed their closest pandas verbs.</p><table><tr><td><b>dplyr</b></td><td><b>pandas</b></td></tr><tr><td>filter() (and slice())</td><td>query() (and loc[], iloc[])</td></tr><tr><td>arrange()</td><td>sort()</td></tr><tr><td>select() (and rename())</td><td>\_\_getitem\_\_ (and rename())</td></tr><tr><td>distinct()</td><td>drop_duplicates()</td></tr><tr><td>mutate() (and transmute())</td><td>None</td></tr><tr><td>summarise()</td><td>None</td></tr><tr><td>sample_n() and sample_frac()</td><td>None</td></tr></table><p>Some of the &ldquo;missing&rdquo; verbs in pandas are because there are other, different ways of achieving the same goal. For example <code>summarise</code> is spread across <code>mean</code>, <code>std</code>, etc. Others, like <code>sample_n</code>, just haven&rsquo;t been implemented yet.</p><h1 id=filter-rows-with-filter-query>Filter rows with filter(), query()<a hidden class=anchor aria-hidden=true href=#filter-rows-with-filter-query>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># filter(flights, month == 1, day == 1)</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#34;month == 1 &amp; day == 1&#34;</span>)
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>841</th><td>2013</td><td>1</td><td>1</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>AA</td><td>N3EVAA</td><td>1925</td><td>LGA</td><td>MIA</td><td>NaN</td><td>1096</td><td>NaN</td><td>NaN</td></tr><tr><th>842</th><td>2013</td><td>1</td><td>1</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>B6</td><td>N618JB</td><td>125</td><td>JFK</td><td>FLL</td><td>NaN</td><td>1069</td><td>NaN</td><td>NaN</td></tr></tbody></table><p>842 rows × 16 columns</p></div><p>The more verbose version:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># flights[flights$month == 1 &amp; flights$day == 1, ]</span>
</span></span><span style=display:flex><span>flights[(flights<span style=color:#f92672>.</span>month <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>&amp;</span> (flights<span style=color:#f92672>.</span>day <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)]
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>841</th><td>2013</td><td>1</td><td>1</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>AA</td><td>N3EVAA</td><td>1925</td><td>LGA</td><td>MIA</td><td>NaN</td><td>1096</td><td>NaN</td><td>NaN</td></tr><tr><th>842</th><td>2013</td><td>1</td><td>1</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>B6</td><td>N618JB</td><td>125</td><td>JFK</td><td>FLL</td><td>NaN</td><td>1069</td><td>NaN</td><td>NaN</td></tr></tbody></table><p>842 rows × 16 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># slice(flights, 1:10)</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>iloc[:<span style=color:#ae81ff>9</span>]
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>8</th><td>2013</td><td>1</td><td>1</td><td>557</td><td>-3</td><td>709</td><td>-14</td><td>EV</td><td>N829AS</td><td>5708</td><td>LGA</td><td>IAD</td><td>53</td><td>229</td><td>5</td><td>57</td></tr><tr><th>9</th><td>2013</td><td>1</td><td>1</td><td>557</td><td>-3</td><td>838</td><td>-8</td><td>B6</td><td>N593JB</td><td>79</td><td>JFK</td><td>MCO</td><td>140</td><td>944</td><td>5</td><td>57</td></tr></tbody></table><p>9 rows × 16 columns</p></div><h1 id=arrange-rows-with-arrange-sort>Arrange rows with arrange(), sort()<a hidden class=anchor aria-hidden=true href=#arrange-rows-with-arrange-sort>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># arrange(flights, year, month, day) </span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>sort([<span style=color:#e6db74>&#39;year&#39;</span>, <span style=color:#e6db74>&#39;month&#39;</span>, <span style=color:#e6db74>&#39;day&#39;</span>])
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>111295</th><td>2013</td><td>12</td><td>31</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>UA</td><td>NaN</td><td>219</td><td>EWR</td><td>ORD</td><td>NaN</td><td>719</td><td>NaN</td><td>NaN</td></tr><tr><th>111296</th><td>2013</td><td>12</td><td>31</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>UA</td><td>NaN</td><td>443</td><td>JFK</td><td>LAX</td><td>NaN</td><td>2475</td><td>NaN</td><td>NaN</td></tr></tbody></table><p>336776 rows × 16 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># arrange(flights, desc(arr_delay))</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>sort(<span style=color:#e6db74>&#39;arr_delay&#39;</span>, ascending<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th></tr></thead><tbody><tr><th>7073</th><td>2013</td><td>1</td><td>9</td><td>641</td><td>1301</td><td>1242</td><td>1272</td><td>HA</td><td>N384HA</td><td>51</td><td>JFK</td><td>HNL</td><td>640</td><td>4983</td><td>6</td><td>41</td></tr><tr><th>235779</th><td>2013</td><td>6</td><td>15</td><td>1432</td><td>1137</td><td>1607</td><td>1127</td><td>MQ</td><td>N504MQ</td><td>3535</td><td>JFK</td><td>CMH</td><td>74</td><td>483</td><td>14</td><td>32</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>336775</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N511MQ</td><td>3572</td><td>LGA</td><td>CLE</td><td>NaN</td><td>419</td><td>NaN</td><td>NaN</td></tr><tr><th>336776</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N839MQ</td><td>3531</td><td>LGA</td><td>RDU</td><td>NaN</td><td>431</td><td>NaN</td><td>NaN</td></tr></tbody></table><p>336776 rows × 16 columns</p></div><h1 id=select-columns-with-select->Select columns with select(), []<a hidden class=anchor aria-hidden=true href=#select-columns-with-select->#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># select(flights, year, month, day) </span>
</span></span><span style=display:flex><span>flights[[<span style=color:#e6db74>&#39;year&#39;</span>, <span style=color:#e6db74>&#39;month&#39;</span>, <span style=color:#e6db74>&#39;day&#39;</span>]]
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td></tr><tr><th>336775</th><td>2013</td><td>9</td><td>30</td></tr><tr><th>336776</th><td>2013</td><td>9</td><td>30</td></tr></tbody></table><p>336776 rows × 3 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># select(flights, year:day) </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># No real equivalent here. Although I think this is OK.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Typically I&#39;ll have the columns I want stored in a list</span>
</span></span><span style=display:flex><span><span style=color:#75715e># somewhere, which can be passed right into __getitem__ ([]).</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># select(flights, -(year:day)) </span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Again, simliar story. I would just use</span>
</span></span><span style=display:flex><span><span style=color:#75715e># flights.drop(cols_to_drop, axis=1)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># or fligths[flights.columns.difference(pd.Index(cols_to_drop))]</span>
</span></span><span style=display:flex><span><span style=color:#75715e># point to dplyr!</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># select(flights, tail_num = tailnum)</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;tailnum&#39;</span>: <span style=color:#e6db74>&#39;tail_num&#39;</span>})[<span style=color:#e6db74>&#39;tail_num&#39;</span>]
</span></span></code></pre></div><pre><code>1    N14228
...
336776    N839MQ
Name: tail_num, Length: 336776, dtype: object
</code></pre><p>But like Hadley mentions, not that useful since it only returns the one column. <code>dplyr</code> and <code>pandas</code> compare well here.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># rename(flights, tail_num = tailnum)</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;tailnum&#39;</span>: <span style=color:#e6db74>&#39;tail_num&#39;</span>})
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tail_num</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>336775</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N511MQ</td><td>3572</td><td>LGA</td><td>CLE</td><td>NaN</td><td>419</td><td>NaN</td><td>NaN</td></tr><tr><th>336776</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N839MQ</td><td>3531</td><td>LGA</td><td>RDU</td><td>NaN</td><td>431</td><td>NaN</td><td>NaN</td></tr></tbody></table><p>336776 rows × 16 columns</p></div><p>Pandas is more verbose, but the the argument to <code>columns</code> can be any mapping. So it&rsquo;s often used with a function to perform a common task, say <code>df.rename(columns=lambda x: x.replace('-', '_'))</code> to replace any dashes with underscores. Also, <code>rename</code> (the pandas version) can be applied to the Index.</p><h1 id=extract-distinct-unique-rows>Extract distinct (unique) rows<a hidden class=anchor aria-hidden=true href=#extract-distinct-unique-rows>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># distinct(select(flights, tailnum))</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>tailnum<span style=color:#f92672>.</span>unique()
</span></span></code></pre></div><pre><code>array(['N14228', 'N24211', 'N619AA', ..., 'N776SK', 'N785SK', 'N557AS'], dtype=object)
</code></pre><p>FYI this returns a numpy array instead of a Series.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># distinct(select(flights, origin, dest))</span>
</span></span><span style=display:flex><span>flights[[<span style=color:#e6db74>&#39;origin&#39;</span>, <span style=color:#e6db74>&#39;dest&#39;</span>]]<span style=color:#f92672>.</span>drop_duplicates()
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>origin</th><th>dest</th></tr></thead><tbody><tr><th>1</th><td>EWR</td><td>IAH</td></tr><tr><th>2</th><td>LGA</td><td>IAH</td></tr><tr><th>...</th><td>...</td><td>...</td></tr><tr><th>255456</th><td>EWR</td><td>ANC</td></tr><tr><th>275946</th><td>EWR</td><td>LGA</td></tr></tbody></table><p>224 rows × 2 columns</p></div><p>OK, so <code>dplyr</code> wins there from a consistency point of view. <code>unique</code> is only defined on Series, not DataFrames. The original intention for <code>drop_duplicates</code> is to check for records that were accidentally included twice. This feels a bit hacky using it to select the distinct combinations, but it works!</p><h1 id=add-new-columns-with-mutate>Add new columns with mutate()<a hidden class=anchor aria-hidden=true href=#add-new-columns-with-mutate>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># mutate(flights,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   gain = arr_delay - dep_delay,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   speed = distance / air_time * 60)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flights[<span style=color:#e6db74>&#39;gain&#39;</span>] <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>arr_delay <span style=color:#f92672>-</span> flights<span style=color:#f92672>.</span>dep_delay
</span></span><span style=display:flex><span>flights[<span style=color:#e6db74>&#39;speed&#39;</span>] <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>distance <span style=color:#f92672>/</span> flights<span style=color:#f92672>.</span>air_time <span style=color:#f92672>*</span> <span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>flights
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th><th>gain</th><th>speed</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td><td>9</td><td>370.044053</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td><td>16</td><td>374.273128</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>336775</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N511MQ</td><td>3572</td><td>LGA</td><td>CLE</td><td>NaN</td><td>419</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>336776</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N839MQ</td><td>3531</td><td>LGA</td><td>RDU</td><td>NaN</td><td>431</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr></tbody></table><p>336776 rows × 18 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># mutate(flights,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   gain = arr_delay - dep_delay,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   gain_per_hour = gain / (air_time / 60)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># )</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flights[<span style=color:#e6db74>&#39;gain&#39;</span>] <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>arr_delay <span style=color:#f92672>-</span> flights<span style=color:#f92672>.</span>dep_delay
</span></span><span style=display:flex><span>flights[<span style=color:#e6db74>&#39;gain_per_hour&#39;</span>] <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>gain <span style=color:#f92672>/</span> (flights<span style=color:#f92672>.</span>air_time <span style=color:#f92672>/</span> <span style=color:#ae81ff>60</span>)
</span></span><span style=display:flex><span>flights
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th><th>gain</th><th>speed</th><th>gain_per_hour</th></tr></thead><tbody><tr><th>1</th><td>2013</td><td>1</td><td>1</td><td>517</td><td>2</td><td>830</td><td>11</td><td>UA</td><td>N14228</td><td>1545</td><td>EWR</td><td>IAH</td><td>227</td><td>1400</td><td>5</td><td>17</td><td>9</td><td>370.044053</td><td>2.378855</td></tr><tr><th>2</th><td>2013</td><td>1</td><td>1</td><td>533</td><td>4</td><td>850</td><td>20</td><td>UA</td><td>N24211</td><td>1714</td><td>LGA</td><td>IAH</td><td>227</td><td>1416</td><td>5</td><td>33</td><td>16</td><td>374.273128</td><td>4.229075</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>336775</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N511MQ</td><td>3572</td><td>LGA</td><td>CLE</td><td>NaN</td><td>419</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr><tr><th>336776</th><td>2013</td><td>9</td><td>30</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>MQ</td><td>N839MQ</td><td>3531</td><td>LGA</td><td>RDU</td><td>NaN</td><td>431</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td><td>NaN</td></tr></tbody></table><p>336776 rows × 19 columns</p></div><p><code>dplyr's</code> approach may be nicer here since you get to refer to the variables in subsequent statements within the <code>mutate()</code>. To achieve this with pandas, you have to add the <code>gain</code> variable as another column in <code>flights</code>. If I don&rsquo;t want it around I would have to explicitly drop it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># transmute(flights,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   gain = arr_delay - dep_delay,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   gain_per_hour = gain / (air_time / 60)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># )</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>flights[<span style=color:#e6db74>&#39;gain&#39;</span>] <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>arr_delay <span style=color:#f92672>-</span> flights<span style=color:#f92672>.</span>dep_delay
</span></span><span style=display:flex><span>flights[<span style=color:#e6db74>&#39;gain_per_hour&#39;</span>] <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>gain <span style=color:#f92672>/</span> (flights<span style=color:#f92672>.</span>air_time <span style=color:#f92672>/</span> <span style=color:#ae81ff>60</span>)
</span></span><span style=display:flex><span>flights[[<span style=color:#e6db74>&#39;gain&#39;</span>, <span style=color:#e6db74>&#39;gain_per_hour&#39;</span>]]
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>gain</th><th>gain_per_hour</th></tr></thead><tbody><tr><th>1</th><td>9</td><td>2.378855</td></tr><tr><th>2</th><td>16</td><td>4.229075</td></tr><tr><th>...</th><td>...</td><td>...</td></tr><tr><th>336775</th><td>NaN</td><td>NaN</td></tr><tr><th>336776</th><td>NaN</td><td>NaN</td></tr></tbody></table><p>336776 rows × 2 columns</p></div><h1 id=summarise-values-with-summarise>Summarise values with summarise()<a hidden class=anchor aria-hidden=true href=#summarise-values-with-summarise>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>flights<span style=color:#f92672>.</span>dep_delay<span style=color:#f92672>.</span>mean()
</span></span></code></pre></div><pre><code>12.639070257304708
</code></pre><h1 id=randomly-sample-rows-with-sample_n-and-sample_frac>Randomly sample rows with sample_n() and sample_frac()<a hidden class=anchor aria-hidden=true href=#randomly-sample-rows-with-sample_n-and-sample_frac>#</a></h1><p>There&rsquo;s an open PR on <a href=https://github.com/pydata/pandas/pull/7274>Github</a> to make this nicer (closer to <code>dplyr</code>). For now you can drop down to numpy.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># sample_n(flights, 10)</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>loc[np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>choice(flights<span style=color:#f92672>.</span>index, <span style=color:#ae81ff>10</span>)]
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th><th>gain</th><th>speed</th><th>gain_per_hour</th></tr></thead><tbody><tr><th>316903</th><td>2013</td><td>9</td><td>9</td><td>1539</td><td>-6</td><td>1650</td><td>-43</td><td>9E</td><td>N918XJ</td><td>3459</td><td>JFK</td><td>BNA</td><td>98</td><td>765</td><td>15</td><td>39</td><td>-37</td><td>468.367347</td><td>-22.653061</td></tr><tr><th>105369</th><td>2013</td><td>12</td><td>25</td><td>905</td><td>0</td><td>1126</td><td>-7</td><td>FL</td><td>N939AT</td><td>275</td><td>LGA</td><td>ATL</td><td>117</td><td>762</td><td>9</td><td>5</td><td>-7</td><td>390.769231</td><td>-3.589744</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>82862</th><td>2013</td><td>11</td><td>30</td><td>1627</td><td>-8</td><td>1750</td><td>-35</td><td>AA</td><td>N4XRAA</td><td>343</td><td>LGA</td><td>ORD</td><td>111</td><td>733</td><td>16</td><td>27</td><td>-27</td><td>396.216216</td><td>-14.594595</td></tr><tr><th>190653</th><td>2013</td><td>4</td><td>28</td><td>748</td><td>-7</td><td>856</td><td>-24</td><td>MQ</td><td>N520MQ</td><td>3737</td><td>EWR</td><td>ORD</td><td>107</td><td>719</td><td>7</td><td>48</td><td>-17</td><td>403.177570</td><td>-9.532710</td></tr></tbody></table><p>10 rows × 19 columns</p></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># sample_frac(flights, 0.01)</span>
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>iloc[np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>randint(<span style=color:#ae81ff>0</span>, len(flights),
</span></span><span style=display:flex><span>                               <span style=color:#ae81ff>.1</span> <span style=color:#f92672>*</span> len(flights))]
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>month</th><th>day</th><th>dep_time</th><th>dep_delay</th><th>arr_time</th><th>arr_delay</th><th>carrier</th><th>tailnum</th><th>flight</th><th>origin</th><th>dest</th><th>air_time</th><th>distance</th><th>hour</th><th>minute</th><th>gain</th><th>speed</th><th>gain_per_hour</th></tr></thead><tbody><tr><th>188581</th><td>2013</td><td>4</td><td>25</td><td>1836</td><td>-4</td><td>2145</td><td>7</td><td>DL</td><td>N398DA</td><td>1629</td><td>JFK</td><td>LAS</td><td>313</td><td>2248</td><td>18</td><td>36</td><td>11</td><td>430.926518</td><td>2.108626</td></tr><tr><th>307015</th><td>2013</td><td>8</td><td>29</td><td>1258</td><td>5</td><td>1409</td><td>-4</td><td>EV</td><td>N12957</td><td>6054</td><td>EWR</td><td>IAD</td><td>46</td><td>212</td><td>12</td><td>58</td><td>-9</td><td>276.521739</td><td>-11.739130</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td><td>...</td></tr><tr><th>286563</th><td>2013</td><td>8</td><td>7</td><td>2126</td><td>18</td><td>6</td><td>7</td><td>UA</td><td>N822UA</td><td>373</td><td>EWR</td><td>PBI</td><td>138</td><td>1023</td><td>21</td><td>26</td><td>-11</td><td>444.782609</td><td>-4.782609</td></tr><tr><th>62818</th><td>2013</td><td>11</td><td>8</td><td>1300</td><td>0</td><td>1615</td><td>5</td><td>VX</td><td>N636VA</td><td>411</td><td>JFK</td><td>LAX</td><td>349</td><td>2475</td><td>13</td><td>0</td><td>5</td><td>425.501433</td><td>0.859599</td></tr></tbody></table><p>33677 rows × 19 columns</p></div><h1 id=grouped-operations>Grouped operations<a hidden class=anchor aria-hidden=true href=#grouped-operations>#</a></h1><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># planes &lt;- group_by(flights, tailnum)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># delay &lt;- summarise(planes,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   count = n(),</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   dist = mean(distance, na.rm = TRUE),</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   delay = mean(arr_delay, na.rm = TRUE))</span>
</span></span><span style=display:flex><span><span style=color:#75715e># delay &lt;- filter(delay, count &gt; 20, dist &lt; 2000)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>planes <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#34;tailnum&#34;</span>)
</span></span><span style=display:flex><span>delay <span style=color:#f92672>=</span> planes<span style=color:#f92672>.</span>agg({<span style=color:#e6db74>&#34;year&#34;</span>: <span style=color:#e6db74>&#34;count&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;distance&#34;</span>: <span style=color:#e6db74>&#34;mean&#34;</span>,
</span></span><span style=display:flex><span>                    <span style=color:#e6db74>&#34;arr_delay&#34;</span>: <span style=color:#e6db74>&#34;mean&#34;</span>})
</span></span><span style=display:flex><span>delay<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#34;year &gt; 20 &amp; distance &lt; 2000&#34;</span>)
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>year</th><th>arr_delay</th><th>distance</th></tr><tr><th>tailnum</th><th></th><th></th><th></th></tr></thead><tbody><tr><th>N0EGMQ</th><td>371</td><td>9.982955</td><td>676.188679</td></tr><tr><th>N10156</th><td>153</td><td>12.717241</td><td>757.947712</td></tr><tr><th>...</th><td>...</td><td>...</td><td>...</td></tr><tr><th>N999DN</th><td>61</td><td>14.311475</td><td>895.459016</td></tr><tr><th>N9EAMQ</th><td>248</td><td>9.235294</td><td>674.665323</td></tr></tbody></table><p>2961 rows × 3 columns</p></div><p>For me, dplyr&rsquo;s <code>n()</code> looked is a bit starge at first, but it&rsquo;s already growing on me.</p><p>I think pandas is more difficult for this particular example.
There isn&rsquo;t as natural a way to mix column-agnostic aggregations (like <code>count</code>) with column-specific aggregations like the other two. You end up writing could like <code>.agg{'year': 'count'}</code> which reads, &ldquo;I want the count of <code>year</code>&rdquo;, even though you don&rsquo;t care about <code>year</code> specifically.
Additionally assigning names can&rsquo;t be done as cleanly in pandas; you have to just follow it up with a <code>rename</code> like before.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># destinations &lt;- group_by(flights, dest)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># summarise(destinations,</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   planes = n_distinct(tailnum),</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   flights = n()</span>
</span></span><span style=display:flex><span><span style=color:#75715e># )</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>destinations <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;dest&#39;</span>)
</span></span><span style=display:flex><span>destinations<span style=color:#f92672>.</span>agg({
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;tailnum&#39;</span>: <span style=color:#66d9ef>lambda</span> x: len(x<span style=color:#f92672>.</span>unique()),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;year&#39;</span>: <span style=color:#e6db74>&#39;count&#39;</span>
</span></span><span style=display:flex><span>    })<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#39;tailnum&#39;</span>: <span style=color:#e6db74>&#39;planes&#39;</span>,
</span></span><span style=display:flex><span>                       <span style=color:#e6db74>&#39;year&#39;</span>: <span style=color:#e6db74>&#39;flights&#39;</span>})
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th>flights</th><th>planes</th></tr><tr><th>dest</th><th></th><th></th></tr></thead><tbody><tr><th>ABQ</th><td>254</td><td>108</td></tr><tr><th>ACK</th><td>265</td><td>58</td></tr><tr><th>...</th><td>...</td><td>...</td></tr><tr><th>TYS</th><td>631</td><td>273</td></tr><tr><th>XNA</th><td>1036</td><td>176</td></tr></tbody></table><p>105 rows × 2 columns</p></div><p>Similar to how <code>dplyr</code> provides optimized C++ versions of most of the <code>summarise</code> functions, pandas uses <a href=http://cython.org>cython</a> optimized versions for most of the <code>agg</code> methods.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># daily &lt;- group_by(flights, year, month, day)</span>
</span></span><span style=display:flex><span><span style=color:#75715e># (per_day   &lt;- summarise(daily, flights = n()))</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>daily <span style=color:#f92672>=</span> flights<span style=color:#f92672>.</span>groupby([<span style=color:#e6db74>&#39;year&#39;</span>, <span style=color:#e6db74>&#39;month&#39;</span>, <span style=color:#e6db74>&#39;day&#39;</span>])
</span></span><span style=display:flex><span>per_day <span style=color:#f92672>=</span> daily[<span style=color:#e6db74>&#39;distance&#39;</span>]<span style=color:#f92672>.</span>count()
</span></span><span style=display:flex><span>per_day
</span></span></code></pre></div><pre><code>year  month  day
2013  1      1      842
...
2013  12     31     776
Name: distance, Length: 365, dtype: int64
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># (per_month &lt;- summarise(per_day, flights = sum(flights)))</span>
</span></span><span style=display:flex><span>per_month <span style=color:#f92672>=</span> per_day<span style=color:#f92672>.</span>groupby(level<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;year&#39;</span>, <span style=color:#e6db74>&#39;month&#39;</span>])<span style=color:#f92672>.</span>sum()
</span></span><span style=display:flex><span>per_month
</span></span></code></pre></div><pre><code>year  month
2013  1        27004
...
2013  12       28135
Name: distance, Length: 12, dtype: int64
</code></pre><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># (per_year  &lt;- summarise(per_month, flights = sum(flights)))</span>
</span></span><span style=display:flex><span>per_year <span style=color:#f92672>=</span> per_month<span style=color:#f92672>.</span>sum()
</span></span><span style=display:flex><span>per_year
</span></span></code></pre></div><pre><code>336776
</code></pre><p>I&rsquo;m not sure how <code>dplyr</code> is handling the other columns, like <code>year</code>, in the last example. With pandas, it&rsquo;s clear that we&rsquo;re grouping by them since they&rsquo;re included in the groupby. For the last example, we didn&rsquo;t group by anything, so they aren&rsquo;t included in the result.</p><h1 id=chaining>Chaining<a hidden class=anchor aria-hidden=true href=#chaining>#</a></h1><p>Any follower of Hadley&rsquo;s <a href=https://twitter.com/hadleywickham/>twitter account</a> will know how much R users <em>love</em> the <code>%>%</code> (pipe) operator. And for good reason!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># flights %&gt;%</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   group_by(year, month, day) %&gt;%</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   select(arr_delay, dep_delay) %&gt;%</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   summarise(</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     arr = mean(arr_delay, na.rm = TRUE),</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#     dep = mean(dep_delay, na.rm = TRUE)</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   ) %&gt;%</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#   filter(arr &gt; 30 | dep &gt; 30)</span>
</span></span><span style=display:flex><span>(
</span></span><span style=display:flex><span>flights<span style=color:#f92672>.</span>groupby([<span style=color:#e6db74>&#39;year&#39;</span>, <span style=color:#e6db74>&#39;month&#39;</span>, <span style=color:#e6db74>&#39;day&#39;</span>])
</span></span><span style=display:flex><span>    [[<span style=color:#e6db74>&#39;arr_delay&#39;</span>, <span style=color:#e6db74>&#39;dep_delay&#39;</span>]]
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;arr_delay &gt; 30 | dep_delay &gt; 30&#39;</span>)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><div style=max-height:1000px;max-width:1500px;overflow:auto><table border=1 class=dataframe><thead><tr style=text-align:right><th></th><th></th><th></th><th>arr_delay</th><th>dep_delay</th></tr><tr><th>year</th><th>month</th><th>day</th><th></th><th></th></tr></thead><tbody><tr><th rowspan=5 valign=top>2013</th><th rowspan=2 valign=top>1</th><th>16</th><td>34.247362</td><td>24.612865</td></tr><tr><th>31</th><td>32.602854</td><td>28.658363</td></tr><tr><th>1</th><th>...</th><td>...</td><td>...</td></tr><tr><th rowspan=2 valign=top>12</th><th>17</th><td>55.871856</td><td>40.705602</td></tr><tr><th>23</th><td>32.226042</td><td>32.254149</td></tr></tbody></table><p>49 rows × 2 columns</p></div><h1 id=other-data-sources>Other Data Sources<a hidden class=anchor aria-hidden=true href=#other-data-sources>#</a></h1><p>Pandas has tons <a href=http://pandas.pydata.org/pandas-docs/version/0.15.0/io.html>IO tools</a> to help you get data in and out, including SQL databases via <a href=http://www.sqlalchemy.org>SQLAlchemy</a>.</p><h1 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h1><p>I think pandas held up pretty well, considering this was a vignette written for dplyr. I found the degree of similarity more interesting than the differences. The most difficult task was renaming of columns within an operation; they had to be followed up with a call to <code>rename</code> <em>after</em> the operation, which isn&rsquo;t that burdensome honestly.</p><p>More and more it looks like we&rsquo;re moving towards future where being a language or package partisan just doesn&rsquo;t make sense. Not when you can load up a <a href=http://jupyter.org>Jupyter</a> (formerly IPython) notebook to call up a library written in R, and hand those results off to python or Julia or whatever for followup, before going back to R to make a cool <a href=http://shiny.rstudio.com>shiny</a> web app.</p><p>There will always be a place for your &ldquo;utility belt&rdquo; package like dplyr or pandas, but it wouldn&rsquo;t hurt to be familiar with both.</p><p>If you want to contribute to pandas, we&rsquo;re always looking for help at <a href=https://github.com/pydata/pandas/>https://github.com/pydata/pandas/</a>.
You can get ahold of me directly on <a href=https://twitter.com/tomaugspurger>twitter</a>.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tomaugspurger.net/tags/python/>Python</a></li><li><a href=https://tomaugspurger.net/tags/data-science/>Data Science</a></li><li><a href=https://tomaugspurger.net/tags/pandas/>Pandas</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://tomaugspurger.net/>Tom's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><a rel=me href=https://mastodon.social/@TomAugspurger></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>My Real-World Match / Case | Tom's Blog</title>
<meta name=keywords content><meta name=description content='Ned Batchelder recently shared Real-world match/case, showing a real example of Python&rsquo;s Structural Pattern Matching. These real-world examples are a great complement to the tutorial, so I&rsquo;ll share mine.
While working on some STAC + Kerchunk stuff, in this pull request I used the match statement to parse some nested objects:
for k, v in refs.items():
    match k.split("/"):
        case [".zgroup"]:
            # k = ".zgroup"
            item.properties["kerchunk:zgroup"] = json.loads(v)
        case [".zattrs"]:
            # k = ".zattrs"
            item.properties["kerchunk:zattrs"] = json.loads(v)
        case [variable, ".zarray"]:
            # k = "prcp/.zarray"
            if u := item.properties["cube:dimensions"].get(variable):
                u["kerchunk:zarray"] = json.loads(refs[k])
            elif u := item.properties["cube:variables"].get(variable):
                u["kerchunk:zarray"] = json.loads(refs[k])
        case [variable, ".zattrs"]:
            # k = "prcp/.zattrs"
            if u := item.properties["cube:dimensions"].get(variable):
                u["kerchunk:zattrs"] = json.loads(refs[k])
            elif u := item.properties["cube:variables"].get(variable):
                u["kerchunk:zattrs"] = json.loads(refs[k])
        case [variable, index]:
            # k = "prcp/0.0.0"
            if u := item.properties["cube:dimensions"].get(variable):
                u.setdefault("kerchunk:value", collections.defaultdict(dict))
                u["kerchunk:value"][index] = refs[k]
            elif u := item.properties["cube:variables"].get(variable):
                u.setdefault("kerchunk:value", collections.defaultdict(dict))
                u["kerchunk:value"][index] = refs[k]
The for loop is iterating over a set of Kerchunk references, which are essentially the keys for a Zarr group. The keys vary a bit. They could be:'><meta name=author content><link rel=canonical href=https://tomaugspurger.net/posts/my-real-world-match/><link crossorigin=anonymous href=/assets/css/stylesheet.ced21e6d3497ee93fed8f8b357448095840179bd510b5ea0e6013078712e6dd1.css integrity="sha256-ztIebTSX7pP+2PizV0SAlYQBeb1RC16g5gEweHEubdE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomaugspurger.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomaugspurger.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomaugspurger.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tomaugspurger.net/apple-touch-icon.png><link rel=mask-icon href=https://tomaugspurger.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomaugspurger.net/posts/my-real-world-match/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="My Real-World Match / Case"><meta property="og:description" content='Ned Batchelder recently shared Real-world match/case, showing a real example of Python&rsquo;s Structural Pattern Matching. These real-world examples are a great complement to the tutorial, so I&rsquo;ll share mine.
While working on some STAC + Kerchunk stuff, in this pull request I used the match statement to parse some nested objects:
for k, v in refs.items():
    match k.split("/"):
        case [".zgroup"]:
            # k = ".zgroup"
            item.properties["kerchunk:zgroup"] = json.loads(v)
        case [".zattrs"]:
            # k = ".zattrs"
            item.properties["kerchunk:zattrs"] = json.loads(v)
        case [variable, ".zarray"]:
            # k = "prcp/.zarray"
            if u := item.properties["cube:dimensions"].get(variable):
                u["kerchunk:zarray"] = json.loads(refs[k])
            elif u := item.properties["cube:variables"].get(variable):
                u["kerchunk:zarray"] = json.loads(refs[k])
        case [variable, ".zattrs"]:
            # k = "prcp/.zattrs"
            if u := item.properties["cube:dimensions"].get(variable):
                u["kerchunk:zattrs"] = json.loads(refs[k])
            elif u := item.properties["cube:variables"].get(variable):
                u["kerchunk:zattrs"] = json.loads(refs[k])
        case [variable, index]:
            # k = "prcp/0.0.0"
            if u := item.properties["cube:dimensions"].get(variable):
                u.setdefault("kerchunk:value", collections.defaultdict(dict))
                u["kerchunk:value"][index] = refs[k]
            elif u := item.properties["cube:variables"].get(variable):
                u.setdefault("kerchunk:value", collections.defaultdict(dict))
                u["kerchunk:value"][index] = refs[k]
The for loop is iterating over a set of Kerchunk references, which are essentially the keys for a Zarr group. The keys vary a bit. They could be:'><meta property="og:type" content="article"><meta property="og:url" content="https://tomaugspurger.net/posts/my-real-world-match/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-12-13T21:00:00-06:00"><meta property="article:modified_time" content="2023-12-13T21:00:00-06:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="My Real-World Match / Case"><meta name=twitter:description content='Ned Batchelder recently shared Real-world match/case, showing a real example of Python&rsquo;s Structural Pattern Matching. These real-world examples are a great complement to the tutorial, so I&rsquo;ll share mine.
While working on some STAC + Kerchunk stuff, in this pull request I used the match statement to parse some nested objects:
for k, v in refs.items():
    match k.split("/"):
        case [".zgroup"]:
            # k = ".zgroup"
            item.properties["kerchunk:zgroup"] = json.loads(v)
        case [".zattrs"]:
            # k = ".zattrs"
            item.properties["kerchunk:zattrs"] = json.loads(v)
        case [variable, ".zarray"]:
            # k = "prcp/.zarray"
            if u := item.properties["cube:dimensions"].get(variable):
                u["kerchunk:zarray"] = json.loads(refs[k])
            elif u := item.properties["cube:variables"].get(variable):
                u["kerchunk:zarray"] = json.loads(refs[k])
        case [variable, ".zattrs"]:
            # k = "prcp/.zattrs"
            if u := item.properties["cube:dimensions"].get(variable):
                u["kerchunk:zattrs"] = json.loads(refs[k])
            elif u := item.properties["cube:variables"].get(variable):
                u["kerchunk:zattrs"] = json.loads(refs[k])
        case [variable, index]:
            # k = "prcp/0.0.0"
            if u := item.properties["cube:dimensions"].get(variable):
                u.setdefault("kerchunk:value", collections.defaultdict(dict))
                u["kerchunk:value"][index] = refs[k]
            elif u := item.properties["cube:variables"].get(variable):
                u.setdefault("kerchunk:value", collections.defaultdict(dict))
                u["kerchunk:value"][index] = refs[k]
The for loop is iterating over a set of Kerchunk references, which are essentially the keys for a Zarr group. The keys vary a bit. They could be:'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomaugspurger.net/posts/"},{"@type":"ListItem","position":2,"name":"My Real-World Match / Case","item":"https://tomaugspurger.net/posts/my-real-world-match/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"My Real-World Match / Case","name":"My Real-World Match \/ Case","description":"Ned Batchelder recently shared Real-world match/case, showing a real example of Python\u0026rsquo;s Structural Pattern Matching. These real-world examples are a great complement to the tutorial, so I\u0026rsquo;ll share mine.\nWhile working on some STAC + Kerchunk stuff, in this pull request I used the match statement to parse some nested objects:\nfor k, v in refs.items(): match k.split(\u0026#34;/\u0026#34;): case [\u0026#34;.zgroup\u0026#34;]: # k = \u0026#34;.zgroup\u0026#34; item.properties[\u0026#34;kerchunk:zgroup\u0026#34;] = json.loads(v) case [\u0026#34;.zattrs\u0026#34;]: # k = \u0026#34;.zattrs\u0026#34; item.properties[\u0026#34;kerchunk:zattrs\u0026#34;] = json.loads(v) case [variable, \u0026#34;.zarray\u0026#34;]: # k = \u0026#34;prcp/.zarray\u0026#34; if u := item.properties[\u0026#34;cube:dimensions\u0026#34;].get(variable): u[\u0026#34;kerchunk:zarray\u0026#34;] = json.loads(refs[k]) elif u := item.properties[\u0026#34;cube:variables\u0026#34;].get(variable): u[\u0026#34;kerchunk:zarray\u0026#34;] = json.loads(refs[k]) case [variable, \u0026#34;.zattrs\u0026#34;]: # k = \u0026#34;prcp/.zattrs\u0026#34; if u := item.properties[\u0026#34;cube:dimensions\u0026#34;].get(variable): u[\u0026#34;kerchunk:zattrs\u0026#34;] = json.loads(refs[k]) elif u := item.properties[\u0026#34;cube:variables\u0026#34;].get(variable): u[\u0026#34;kerchunk:zattrs\u0026#34;] = json.loads(refs[k]) case [variable, index]: # k = \u0026#34;prcp/0.0.0\u0026#34; if u := item.properties[\u0026#34;cube:dimensions\u0026#34;].get(variable): u.setdefault(\u0026#34;kerchunk:value\u0026#34;, collections.defaultdict(dict)) u[\u0026#34;kerchunk:value\u0026#34;][index] = refs[k] elif u := item.properties[\u0026#34;cube:variables\u0026#34;].get(variable): u.setdefault(\u0026#34;kerchunk:value\u0026#34;, collections.defaultdict(dict)) u[\u0026#34;kerchunk:value\u0026#34;][index] = refs[k] The for loop is iterating over a set of Kerchunk references, which are essentially the keys for a Zarr group. The keys vary a bit. They could be:\n","keywords":[],"articleBody":"Ned Batchelder recently shared Real-world match/case, showing a real example of Python’s Structural Pattern Matching. These real-world examples are a great complement to the tutorial, so I’ll share mine.\nWhile working on some STAC + Kerchunk stuff, in this pull request I used the match statement to parse some nested objects:\nfor k, v in refs.items(): match k.split(\"/\"): case [\".zgroup\"]: # k = \".zgroup\" item.properties[\"kerchunk:zgroup\"] = json.loads(v) case [\".zattrs\"]: # k = \".zattrs\" item.properties[\"kerchunk:zattrs\"] = json.loads(v) case [variable, \".zarray\"]: # k = \"prcp/.zarray\" if u := item.properties[\"cube:dimensions\"].get(variable): u[\"kerchunk:zarray\"] = json.loads(refs[k]) elif u := item.properties[\"cube:variables\"].get(variable): u[\"kerchunk:zarray\"] = json.loads(refs[k]) case [variable, \".zattrs\"]: # k = \"prcp/.zattrs\" if u := item.properties[\"cube:dimensions\"].get(variable): u[\"kerchunk:zattrs\"] = json.loads(refs[k]) elif u := item.properties[\"cube:variables\"].get(variable): u[\"kerchunk:zattrs\"] = json.loads(refs[k]) case [variable, index]: # k = \"prcp/0.0.0\" if u := item.properties[\"cube:dimensions\"].get(variable): u.setdefault(\"kerchunk:value\", collections.defaultdict(dict)) u[\"kerchunk:value\"][index] = refs[k] elif u := item.properties[\"cube:variables\"].get(variable): u.setdefault(\"kerchunk:value\", collections.defaultdict(dict)) u[\"kerchunk:value\"][index] = refs[k] The for loop is iterating over a set of Kerchunk references, which are essentially the keys for a Zarr group. The keys vary a bit. They could be:\nGroup metadata keys like .zgroup and .zattrs, which apply to the entire group. Array metadata keys like prcp/.zarray or prcp/.zattrs (prcp is short for precipitation), which apply to an individual array in the group. Chunk keys, like prcp/0.0.0, prcp/0.0.1, which indicate the chunk index in the n-dimensional array. The whole point of this block of code is to update some other data (either the STAC item or the value referenced by the key). Between the different kinds of keys and the different actions we want to take for each kind of key, this seems like a pretty much ideal situation for structural pattern matching.\nThe subject of our match is k.split(\"/\"):\nmatch k.split(\"/\") Thanks to the Kerchunk specification, we know that any key should have exactly 0 or 1 /s in it, so we can define different cases to handle each.\nSpecific string literals have special meaning (like \".zgroup\" and \".zarray\") and control the key we want to update, so we handle all those first.\nAnd the final case handles everything else: any data variable and index will match the\ncase [variable, index] The ability to bind the values like variable = \"prcp\" and index = \"0.0.0\" makes updating the target data structure seamless.\nCombine that with the walrus operator (the v:=), dict.setdefault, and collections.defaultdict, we get some pretty terse, clever code. Looking back at it a couple months later it’s probably bit too clever.\n","wordCount":"406","inLanguage":"en","datePublished":"2023-12-13T21:00:00-06:00","dateModified":"2023-12-13T21:00:00-06:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomaugspurger.net/posts/my-real-world-match/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://tomaugspurger.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomaugspurger.net/ accesskey=h title="Tom's Blog (Alt + H)">Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://tomaugspurger.net/about/ title=About><span>About</span></a></li><li><a href=https://tomaugspurger.net/archives title=Archive><span>Archive</span></a></li><li><a href=https://tomaugspurger.net/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://tomaugspurger.net/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">My Real-World Match / Case</h1><div class=post-meta><span title='2023-12-13 21:00:00 -0600 -0600'>December 13, 2023</span></div></header><div class=post-content><p>Ned Batchelder recently shared <a href=https://nedbatchelder.com/blog/202312/realworld_matchcase.html>Real-world match/case</a>, showing a real example of Python&rsquo;s <a href=https://peps.python.org/pep-0636/>Structural Pattern Matching</a>. These real-world examples are a great complement to the tutorial, so I&rsquo;ll share mine.</p><p>While working on some <a href=../stac-updates>STAC + Kerchunk stuff</a>, in <a href=https://github.com/stac-utils/xstac/pull/38>this pull request</a> I used the match statement to parse some nested objects:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>for</span> k, v <span style=color:#f92672>in</span> refs<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>match</span> k<span style=color:#f92672>.</span>split(<span style=color:#e6db74>&#34;/&#34;</span>):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> [<span style=color:#e6db74>&#34;.zgroup&#34;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#75715e># k = &#34;.zgroup&#34;</span>
</span></span><span style=display:flex><span>            item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;kerchunk:zgroup&#34;</span>] <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(v)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> [<span style=color:#e6db74>&#34;.zattrs&#34;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#75715e># k = &#34;.zattrs&#34;</span>
</span></span><span style=display:flex><span>            item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;kerchunk:zattrs&#34;</span>] <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(v)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> [variable, <span style=color:#e6db74>&#34;.zarray&#34;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#75715e># k = &#34;prcp/.zarray&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> u <span style=color:#f92672>:=</span> item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;cube:dimensions&#34;</span>]<span style=color:#f92672>.</span>get(variable):
</span></span><span style=display:flex><span>                u[<span style=color:#e6db74>&#34;kerchunk:zarray&#34;</span>] <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(refs[k])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> u <span style=color:#f92672>:=</span> item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;cube:variables&#34;</span>]<span style=color:#f92672>.</span>get(variable):
</span></span><span style=display:flex><span>                u[<span style=color:#e6db74>&#34;kerchunk:zarray&#34;</span>] <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(refs[k])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> [variable, <span style=color:#e6db74>&#34;.zattrs&#34;</span>]:
</span></span><span style=display:flex><span>            <span style=color:#75715e># k = &#34;prcp/.zattrs&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> u <span style=color:#f92672>:=</span> item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;cube:dimensions&#34;</span>]<span style=color:#f92672>.</span>get(variable):
</span></span><span style=display:flex><span>                u[<span style=color:#e6db74>&#34;kerchunk:zattrs&#34;</span>] <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(refs[k])
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> u <span style=color:#f92672>:=</span> item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;cube:variables&#34;</span>]<span style=color:#f92672>.</span>get(variable):
</span></span><span style=display:flex><span>                u[<span style=color:#e6db74>&#34;kerchunk:zattrs&#34;</span>] <span style=color:#f92672>=</span> json<span style=color:#f92672>.</span>loads(refs[k])
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>case</span> [variable, index]:
</span></span><span style=display:flex><span>            <span style=color:#75715e># k = &#34;prcp/0.0.0&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> u <span style=color:#f92672>:=</span> item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;cube:dimensions&#34;</span>]<span style=color:#f92672>.</span>get(variable):
</span></span><span style=display:flex><span>                u<span style=color:#f92672>.</span>setdefault(<span style=color:#e6db74>&#34;kerchunk:value&#34;</span>, collections<span style=color:#f92672>.</span>defaultdict(dict))
</span></span><span style=display:flex><span>                u[<span style=color:#e6db74>&#34;kerchunk:value&#34;</span>][index] <span style=color:#f92672>=</span> refs[k]
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>elif</span> u <span style=color:#f92672>:=</span> item<span style=color:#f92672>.</span>properties[<span style=color:#e6db74>&#34;cube:variables&#34;</span>]<span style=color:#f92672>.</span>get(variable):
</span></span><span style=display:flex><span>                u<span style=color:#f92672>.</span>setdefault(<span style=color:#e6db74>&#34;kerchunk:value&#34;</span>, collections<span style=color:#f92672>.</span>defaultdict(dict))
</span></span><span style=display:flex><span>                u[<span style=color:#e6db74>&#34;kerchunk:value&#34;</span>][index] <span style=color:#f92672>=</span> refs[k]
</span></span></code></pre></div><p>The <code>for</code> loop is iterating over a set of <a href=https://fsspec.github.io/kerchunk>Kerchunk</a> references, which are essentially the keys for a <a href=https://zarr.readthedocs.io/en/stable/spec/v2.html>Zarr</a> group. The keys vary a bit. They could be:</p><ol><li>Group metadata keys like <code>.zgroup</code> and <code>.zattrs</code>, which apply to the entire group.</li><li>Array metadata keys like <code>prcp/.zarray</code> or <code>prcp/.zattrs</code> (prcp is short for precipitation), which apply to an individual array in the group.</li><li>Chunk keys, like <code>prcp/0.0.0</code>, <code>prcp/0.0.1</code>, which indicate the chunk index in the n-dimensional array.</li></ol><p>The whole point of this block of code is to update some other data (either the STAC <code>item</code> or the value referenced by the key). Between the different kinds of keys and the different actions we want to take for each kind of key, this seems like a pretty much ideal situation for structural pattern matching.</p><p>The subject of our match is <code>k.split("/")</code>:</p><pre tabindex=0><code>match k.split(&#34;/&#34;)
</code></pre><p>Thanks to the Kerchunk specification, we know that any key should have exactly 0 or 1 <code>/</code>s in it, so we can define different cases to handle each.</p><p>Specific string literals have special meaning (like <code>".zgroup"</code> and <code>".zarray"</code>) and control the key we want to update, so we handle all those first.</p><p>And the final case handles everything else: any data <code>variable</code> and <code>index</code> will match the</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>case</span> [variable, index]
</span></span></code></pre></div><p>The ability to bind the values like <code>variable = "prcp"</code> and <code>index = "0.0.0"</code> makes updating the target data structure seamless.</p><p>Combine that with the walrus operator (the <code>v:=</code>), <code>dict.setdefault</code>, and <code>collections.defaultdict</code>, we get some pretty terse, clever code. Looking back at it a couple months later it&rsquo;s probably bit too clever.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tomaugspurger.net/>Tom's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><a rel=me href=https://mastodon.social/@TomAugspurger></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
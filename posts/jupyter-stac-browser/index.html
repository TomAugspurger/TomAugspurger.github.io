<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Jupyter, STAC, and Tool Building | Tom's Blog</title>
<meta name=keywords content><meta name=description content="Over in Planetary Computer land, we&rsquo;re working on bringing Sentinel-5P into our STAC catalog.
STAC items require a geometry property, a GeoJSON object that describes the footprint of the assets. Thanks to the satellites&rsquo; orbit and the (spatial) size of the assets, we started with some&mldr;interesting&mldr; footprints:
That initial footprint, shown in orange, would render the STAC collection essentially useless for spatial searches. The assets don&rsquo;t actually cover (most of) the southern hemisphere."><meta name=author content><link rel=canonical href=https://tomaugspurger.net/posts/jupyter-stac-browser/><link crossorigin=anonymous href=/assets/css/stylesheet.ced21e6d3497ee93fed8f8b357448095840179bd510b5ea0e6013078712e6dd1.css integrity="sha256-ztIebTSX7pP+2PizV0SAlYQBeb1RC16g5gEweHEubdE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomaugspurger.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomaugspurger.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomaugspurger.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tomaugspurger.net/apple-touch-icon.png><link rel=mask-icon href=https://tomaugspurger.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Jupyter, STAC, and Tool Building"><meta property="og:description" content="Over in Planetary Computer land, we&rsquo;re working on bringing Sentinel-5P into our STAC catalog.
STAC items require a geometry property, a GeoJSON object that describes the footprint of the assets. Thanks to the satellites&rsquo; orbit and the (spatial) size of the assets, we started with some&mldr;interesting&mldr; footprints:
That initial footprint, shown in orange, would render the STAC collection essentially useless for spatial searches. The assets don&rsquo;t actually cover (most of) the southern hemisphere."><meta property="og:type" content="article"><meta property="og:url" content="https://tomaugspurger.net/posts/jupyter-stac-browser/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-15T08:00:00-05:00"><meta property="article:modified_time" content="2023-04-15T08:00:00-05:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Jupyter, STAC, and Tool Building"><meta name=twitter:description content="Over in Planetary Computer land, we&rsquo;re working on bringing Sentinel-5P into our STAC catalog.
STAC items require a geometry property, a GeoJSON object that describes the footprint of the assets. Thanks to the satellites&rsquo; orbit and the (spatial) size of the assets, we started with some&mldr;interesting&mldr; footprints:
That initial footprint, shown in orange, would render the STAC collection essentially useless for spatial searches. The assets don&rsquo;t actually cover (most of) the southern hemisphere."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://tomaugspurger.net/posts/"},{"@type":"ListItem","position":3,"name":"Jupyter, STAC, and Tool Building","item":"https://tomaugspurger.net/posts/jupyter-stac-browser/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Jupyter, STAC, and Tool Building","name":"Jupyter, STAC, and Tool Building","description":"Over in Planetary Computer land, we\u0026rsquo;re working on bringing Sentinel-5P into our STAC catalog.\nSTAC items require a geometry property, a GeoJSON object that describes the footprint of the assets. Thanks to the satellites\u0026rsquo; orbit and the (spatial) size of the assets, we started with some\u0026hellip;interesting\u0026hellip; footprints:\nThat initial footprint, shown in orange, would render the STAC collection essentially useless for spatial searches. The assets don\u0026rsquo;t actually cover (most of) the southern hemisphere.","keywords":[],"articleBody":"Over in Planetary Computer land, we’re working on bringing Sentinel-5P into our STAC catalog.\nSTAC items require a geometry property, a GeoJSON object that describes the footprint of the assets. Thanks to the satellites’ orbit and the (spatial) size of the assets, we started with some…interesting… footprints:\nThat initial footprint, shown in orange, would render the STAC collection essentially useless for spatial searches. The assets don’t actually cover (most of) the southern hemisphere.\nPete Gadomski did some really great work to understand the problem and fix it (hopefully once and for all). As the satellite crosses the antimeridian, a pole, or both, naive approaches to generating a footprint fails. It takes some more complicated logic to generate a good geometry. That’s now available as antimeridian on PyPI. It produces much more sensible footprints:\nBuilding Tools The real reason I wanted to write this post was to talk about tool building. This is a common theme of the Oxide and Friends podcast, but I think spending time building these kinds of small, focused tools almost always pays off.\nPete had a handful of pathologic test cases in the antimeridian test suite, but I wanted a way to quickly examine hundreds of footprints that I got back from our test STAC catalog. There are probably already tools for this, but I was able to put one together in Jupyter in about 10 minutes by building on Jupyter Widgets and ipyleaflet.\nYou can see it in action here (using Sentinel-2 footprints rather than Sentinel 5-P):\nWe get a STAC footprint browser (connected to our Python kernel!) with a single, pretty simple function.\nm = ipyleaflet.Map(zoom=3) m.layout.width = \"600px\" layer = ipyleaflet.GeoJSON() m.add(layer) @ipywidgets.interact(item: pystac.ItemCollection = items) def browse(item: pystac.Item): shape = shapely.geometry.shape(item) m.center = tuple(shape.centroid.coords[0])[::-1] layer.data = item.geometry print(item.id, item.datetime.isoformat()) Using this browser, I could quickly scrub through the Sentinel-5P items with the arrow keys and verify that the footprints looked reasonable.\nThe demo for this lives in the Planetary Computer Examples repository, and you can view the rendered version.\n","wordCount":"337","inLanguage":"en","datePublished":"2023-04-15T08:00:00-05:00","dateModified":"2023-04-15T08:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomaugspurger.net/posts/jupyter-stac-browser/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://tomaugspurger.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomaugspurger.net accesskey=h title="Tom's Blog (Alt + H)">Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://tomaugspurger.net/about/ title=About><span>About</span></a></li><li><a href=https://tomaugspurger.net/archives title=Archive><span>Archive</span></a></li><li><a href=https://tomaugspurger.net/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://tomaugspurger.net/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Jupyter, STAC, and Tool Building</h1><div class=post-meta><span title='2023-04-15 08:00:00 -0500 -0500'>April 15, 2023</span></div></header><div class=post-content><p>Over in Planetary Computer land, we&rsquo;re <a href=https://github.com/microsoft/planetary-computer-tasks/pull/167>working on</a> bringing <a href=https://sentinels.copernicus.eu/web/sentinel/missions/sentinel-5p>Sentinel-5P</a> into our STAC catalog.</p><p>STAC items require a <code>geometry</code> property, a GeoJSON object that describes the footprint of the assets. Thanks to the satellites&rsquo; orbit and the (spatial) size of the assets, we started with some&mldr;interesting&mldr; footprints:</p><p><img loading=lazy src=https://user-images.githubusercontent.com/58314/231868547-21c786b9-dc88-4830-a07f-7aa3c1fdebc6.png alt></p><p>That initial footprint, shown in orange, would render the STAC collection essentially useless for spatial searches. The assets don&rsquo;t actually cover (most of) the southern hemisphere.</p><p><a href=https://fosstodon.org/@gadomski>Pete Gadomski</a> did some really great work to understand the problem and fix it (hopefully once and for all). As the satellite crosses the antimeridian, a pole, or both, naive approaches to generating a footprint fails. It takes some more <a href=https://github.com/gadomski/antimeridian/blob/main/src/antimeridian/_implementation.py>complicated logic</a> to generate a good geometry. That&rsquo;s now available as <a href=https://pypi.org/project/antimeridian>antimeridian</a> on PyPI. It produces much more sensible footprints:</p><p><img loading=lazy src=https://user-images.githubusercontent.com/58314/231868768-5439edcd-5e5a-40a9-b3f9-12947a081b85.png alt></p><h2 id=building-tools>Building Tools<a hidden class=anchor aria-hidden=true href=#building-tools>#</a></h2><p>The real reason I wanted to write this post was to talk about tool building. This is a common theme of the <a href=https://oxide.computer/podcasts/oxide-and-friends>Oxide and Friends</a> podcast, but I think spending time building these kinds of small, focused tools almost always pays off.</p><p>Pete had a handful of <a href=https://github.com/gadomski/antimeridian/tree/main/tests/data/input>pathologic test cases</a> in the antimeridian test suite, but I wanted a way to quickly examine hundreds of footprints that I got back from our test STAC catalog. There are probably already tools for this, but I was able to put one together in Jupyter in about 10 minutes by building on <a href=https://ipywidgets.readthedocs.io/en/latest/#>Jupyter Widgets</a> and <a href=https://ipyleaflet.readthedocs.io/en/latest/index.html>ipyleaflet</a>.</p><p>You can see it in action here (using Sentinel-2 footprints rather than Sentinel 5-P):</p><video controls width=600 src=https://ai4edatasetspublicassets.blob.core.windows.net/assets/pc_video/interact-stac-browser-web.mp4></video><p>We get a STAC footprint browser (connected to our Python kernel!) with a single, pretty simple function.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>m <span style=color:#f92672>=</span> ipyleaflet<span style=color:#f92672>.</span>Map(zoom<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>m<span style=color:#f92672>.</span>layout<span style=color:#f92672>.</span>width <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;600px&#34;</span>
</span></span><span style=display:flex><span>layer <span style=color:#f92672>=</span> ipyleaflet<span style=color:#f92672>.</span>GeoJSON()
</span></span><span style=display:flex><span>m<span style=color:#f92672>.</span>add(layer)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@ipywidgets.interact</span>(item: pystac<span style=color:#f92672>.</span>ItemCollection <span style=color:#f92672>=</span> items)
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>browse</span>(item: pystac<span style=color:#f92672>.</span>Item):
</span></span><span style=display:flex><span>    shape <span style=color:#f92672>=</span> shapely<span style=color:#f92672>.</span>geometry<span style=color:#f92672>.</span>shape(item)
</span></span><span style=display:flex><span>    m<span style=color:#f92672>.</span>center <span style=color:#f92672>=</span> tuple(shape<span style=color:#f92672>.</span>centroid<span style=color:#f92672>.</span>coords[<span style=color:#ae81ff>0</span>])[::<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    layer<span style=color:#f92672>.</span>data <span style=color:#f92672>=</span> item<span style=color:#f92672>.</span>geometry
</span></span><span style=display:flex><span>    print(item<span style=color:#f92672>.</span>id, item<span style=color:#f92672>.</span>datetime<span style=color:#f92672>.</span>isoformat())
</span></span></code></pre></div><p>Using this browser, I could quickly scrub through the Sentinel-5P items with the arrow keys and verify that the footprints looked reasonable.</p><p>The demo for this lives in the <a href=https://github.com/microsoft/PlanetaryComputerExamples/>Planetary Computer Examples</a> repository, and you can view the <a href=https://nbviewer.org/github/microsoft/PlanetaryComputerExamples/blob/main/tutorials/interactive-browser.ipynb>rendered version</a>.</p></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://tomaugspurger.net>Tom's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><a rel=me href=https://mastodon.social/@TomAugspurger></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
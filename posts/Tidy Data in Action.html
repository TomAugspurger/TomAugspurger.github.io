<!DOCTYPE html>
<html prefix="
og: http://ogp.me/ns#
article: http://ogp.me/ns/article#
" lang="en">
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Tidy Data in Action | Tom's Blog</title>

                <link href="../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">

                <link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml">

      <link rel="canonical" href="http://tomaugspurger.github.io/posts/Tidy%20Data%20in%20Action.html">



    
        <!--[if lt IE 9]><script src="/assets/js/html5.js"></script><![endif]-->

    

    
    <meta name="author" content="Tom Augspurger">
        <meta property="og:site_name" content="Tom's Blog">
    <meta property="og:title" content="Tidy Data in Action">
    <meta property="og:url" content="http://tomaugspurger.github.io/posts/Tidy Data in Action.html">
    <meta property="og:description" content="Hadley Whickham wrote a famous paper (for a certain definition of famous) about the importance of tidy data when doing data analysis.
I want to talk a bit about that, using an example from a StackOver">
    <meta property="og:type" content="article">
    <meta property="article:published_time" content="2014-03-27T16:00:00-05:00">
           <meta property="article:tag" content="data science">
           <meta property="article:tag" content="python">
           <meta property="article:tag" content="scripts">

    
    

</head>
<body>
    <section class="social">
        <ul>
                    <li><a href="../index.html" title="Home"><i class="icon-home"></i></a></li>
            <li><a href="../archive.html" title="Archives"><i class="icon-folder-open-alt"></i></a></li>
            <li><a href="../categories/index.html" title="Tags"><i class="icon-tags"></i></a></li>
            <li><a href="../rss.xml" title="RSS"><i class="icon-rss"></i></a></li>

        </ul>
    </section>
    <section class="page-content">
        <div class="content" rel="main">
    <div class="post">
        <h1 class="p-name entry-title" itemprop="headline name">Tidy Data in Action</h1>

        <div class="meta">
            <div class="authordate">
                <time class="timeago" datetime="2014-03-27T16:00:00-05:00">2014-03-27 16:00</time>
            
                      |  
        <a href="Tidy%20Data%20in%20Action.ipynb" id="sourcelink">Source</a>

            </div>
                    <div itemprop="keywords" class="tags">
        <ul>
        Tags : 
           <li><a class="tag p-category" href="../categories/data-science.html" rel="tag">data science</a></li>
           <li><a class="tag p-category" href="../categories/python.html" rel="tag">python</a></li>
           <li><a class="tag p-category" href="../categories/scripts.html" rel="tag">scripts</a></li>
        </ul>
        </div>

        </div>
        <div class="body">
            <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="http://had.co.nz">Hadley Whickham</a> wrote a famous paper (for a certain definition of famous) about the importance of <a href="http://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a> when doing data analysis.
I want to talk a bit about that, using an example from a StackOverflow post, with a solution using <a href="http://pandas.pydata.org">pandas</a>. The principles of tidy data aren't language specific.</p>
<p>A tidy dataset must satisfy three criteria (page 4 in <a href="http://vita.had.co.nz/papers/tidy-data.pdf">Whickham's paper</a>):</p>
<ol>
<li>Each variable forms a column.</li>
<li>Each observation forms a row.</li>
<li>Each type of observational unit forms a table.</li>
</ol>
<p>In this <a href="http://stackoverflow.com/questions/22695680/python-pandas-timedelta-specific-rows">StackOverflow post</a>, the asker had some data NBA games, and wanted to know the number of days since a team last played. Here's the example data:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="kn">import</span> <span class="nn">datetime</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'HomeTeam'</span><span class="p">:</span> <span class="p">[</span><span class="s">'HOU'</span><span class="p">,</span> <span class="s">'CHI'</span><span class="p">,</span> <span class="s">'DAL'</span><span class="p">,</span> <span class="s">'HOU'</span><span class="p">],</span>
                   <span class="s">'AwayTeam'</span> <span class="p">:</span> <span class="p">[</span><span class="s">'CHI'</span><span class="p">,</span> <span class="s">'DAL'</span><span class="p">,</span> <span class="s">'CHI'</span><span class="p">,</span> <span class="s">'DAL'</span><span class="p">],</span>
                   <span class="s">'HomeGameNum'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                   <span class="s">'AwayGameNum'</span> <span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
                   <span class="s">'Date'</span> <span class="p">:</span> <span class="p">[</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span>
                             <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">14</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">)]})</span>
<span class="n">df</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[1]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>AwayGameNum</th>
      <th>AwayTeam</th>
      <th>Date</th>
      <th>HomeGameNum</th>
      <th>HomeTeam</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 1</td>
      <td> CHI</td>
      <td> 2014-03-11</td>
      <td> 1</td>
      <td> HOU</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 1</td>
      <td> DAL</td>
      <td> 2014-03-12</td>
      <td> 2</td>
      <td> CHI</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 3</td>
      <td> CHI</td>
      <td> 2014-03-14</td>
      <td> 2</td>
      <td> DAL</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 3</td>
      <td> DAL</td>
      <td> 2014-03-15</td>
      <td> 2</td>
      <td> HOU</td>
    </tr>
  </tbody>
</table>
<p>4 rows × 5 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I want to focus on the second of the three criteria: <em>Each observation forms a row.</em>
Realize that the structure your dataset should take reflects the question you're trying to answer.
For the SO question, we want to answer "How many days has it been since this team's last game?"
Given this context what is an observation?</p>
<hr>
<p>We'll define an observation as a team playing on a day.
Does the original dataset in <code>df</code> satisfy the criteria for tidy data?
No, it doesn't since each row contains <strong>2</strong> observations, one for the home team and one for the away team.</p>
<p>Let's tidy up the dataset.</p>
<ul>
<li>I repeat each row (once for each team) and drop the game numbers (I don't need them for this example)</li>
<li>Select just the new rows (the one with odd indicies, <code>%</code> is the <a href="http://en.wikipedia.org/wiki/Modulo_operation">modulo operator</a> in python)</li>
<li>Overwrite the value of <code>Team</code> for the new rows, keeping the existing value for the old rows</li>
<li>rename the <code>HomeTeam</code> column to <code>is_home</code> and make it a boolen column (True when the team is home)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">s</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'Date'</span><span class="p">,</span> <span class="s">'HomeTeam'</span><span class="p">,</span> <span class="s">'AwayTeam'</span><span class="p">]]</span><span class="o">.</span><span class="n">reindex_axis</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="k">True</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'AwayTeam'</span><span class="p">:</span> <span class="s">'Team'</span><span class="p">})</span>

<span class="n">new</span> <span class="o">=</span> <span class="n">s</span><span class="p">[(</span><span class="n">s</span><span class="o">.</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)]</span>

<span class="n">s</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">new</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s">'Team'</span><span class="p">]</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="s">'HomeTeam'</span><span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s">'HomeTeam'</span><span class="p">:</span> <span class="s">'is_home'</span><span class="p">})</span>
<span class="n">s</span><span class="p">[</span><span class="s">'is_home'</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="p">[</span><span class="s">'Team'</span><span class="p">]</span> <span class="o">==</span> <span class="n">s</span><span class="p">[</span><span class="s">'is_home'</span><span class="p">]</span>
<span class="n">s</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[2]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>is_home</th>
      <th>Team</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 2014-03-11</td>
      <td> False</td>
      <td> CHI</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 2014-03-11</td>
      <td>  True</td>
      <td> HOU</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 2014-03-12</td>
      <td> False</td>
      <td> DAL</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 2014-03-12</td>
      <td>  True</td>
      <td> CHI</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 2014-03-14</td>
      <td> False</td>
      <td> CHI</td>
    </tr>
    <tr>
      <th>5</th>
      <td> 2014-03-14</td>
      <td>  True</td>
      <td> DAL</td>
    </tr>
    <tr>
      <th>6</th>
      <td> 2014-03-15</td>
      <td> False</td>
      <td> DAL</td>
    </tr>
    <tr>
      <th>7</th>
      <td> 2014-03-15</td>
      <td>  True</td>
      <td> HOU</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 3 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we have a 1:1 correspondance between rows and observations, answering the question is simple.</p>
<p>We'll just group by each team and find the difference between each consecutive <code>Date</code> for that team.
Then subtract one day so that back to back games reflect 0 days of rest.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span class="n">s</span><span class="p">[</span><span class="s">'rest'</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'Team'</span><span class="p">)[</span><span class="s">'Date'</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">s</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[3]:</div>

<div class="output_html rendered_html output_subarea output_execute_result">
<div style="max-height:1000px;max-width:1500px;overflow:auto;">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>is_home</th>
      <th>Team</th>
      <th>rest</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td> 2014-03-11</td>
      <td> False</td>
      <td> CHI</td>
      <td>   NaT</td>
    </tr>
    <tr>
      <th>1</th>
      <td> 2014-03-11</td>
      <td>  True</td>
      <td> HOU</td>
      <td>   NaT</td>
    </tr>
    <tr>
      <th>2</th>
      <td> 2014-03-12</td>
      <td> False</td>
      <td> DAL</td>
      <td>   NaT</td>
    </tr>
    <tr>
      <th>3</th>
      <td> 2014-03-12</td>
      <td>  True</td>
      <td> CHI</td>
      <td>0 days</td>
    </tr>
    <tr>
      <th>4</th>
      <td> 2014-03-14</td>
      <td> False</td>
      <td> CHI</td>
      <td>1 days</td>
    </tr>
    <tr>
      <th>5</th>
      <td> 2014-03-14</td>
      <td>  True</td>
      <td> DAL</td>
      <td>1 days</td>
    </tr>
    <tr>
      <th>6</th>
      <td> 2014-03-15</td>
      <td> False</td>
      <td> DAL</td>
      <td>0 days</td>
    </tr>
    <tr>
      <th>7</th>
      <td> 2014-03-15</td>
      <td>  True</td>
      <td> HOU</td>
      <td>3 days</td>
    </tr>
  </tbody>
</table>
<p>8 rows × 4 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I planned on comparing that one line solution to the code needed with the messy data.
But honestly, I'm having trouble writing the messy data version.
You don't really have anything to group on, so you'd need to keep track of the row where you last saw this team (either in <code>AwayTeam</code> or <code>HomeTeam</code>).
And then each row will have two answers, one for each team.
It's certainly possible to write the necessary code, but the fact that I'm struggling so much to write the messy version is pretty good evidence for the importance of tidy data.</p>

</div>
</div>
</div>
    </div>
  </div>

        </div>
                <ul class="pager">
            <li class="previous">
                <a href="Quiz%205%20Review.html" rel="prev" title="Stats for Strategy Quiz 5 Review">Previous post</a>
            </li>
            <li class="next">
                <a href="Quiz%206%20Review.html" rel="next" title="Stats for Strategy Quiz 6 Review">Next post</a>
            </li>
        </ul>

    </div>
                    <footer id="footer" role="contentinfo">
            <p>Contents © 2015         <a href="mailto:tom.w.augspurger@gmail.com">Tom Augspurger</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         </p>
            
        </footer>

        </div>
    </section>
    
    
                <script src="../assets/js/all-nocdn.js" type="text/javascript"></script>
    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul>
<li>
<a class="addthis_button_facebook"></a>
</li>
<li>
<a class="addthis_button_google_plusone_share"></a>
</li>
<li>
<a class="addthis_button_linkedin"></a>
</li>
<li>
<a class="addthis_button_twitter"></a>
</li>
</ul>
</div>
<script src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


        <script type="text/javascript">
            $(function(){
                $('.timeago').timeago();
            });
        </script>
</body>
</html>

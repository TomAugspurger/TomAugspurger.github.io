<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Modern Pandas (Part 2): Method Chaining | Tom's Blog</title>
<meta name=keywords content="pandas"><meta name=description content="
This is part 2 in my series on writing modern idiomatic pandas.

Modern Pandas
Method Chaining
Indexes
Fast Pandas
Tidy Data
Visualization
Time Series
Scaling


Method Chaining
Method chaining, where you call methods on an object one after another, is in vogue at the moment.
It&rsquo;s always been a style of programming that&rsquo;s been possible with pandas,
and over the past several releases, we&rsquo;ve added methods that enable even more chaining."><meta name=author content><link rel=canonical href=https://tomaugspurger.net/posts/method-chaining/><link crossorigin=anonymous href=/assets/css/stylesheet.ced21e6d3497ee93fed8f8b357448095840179bd510b5ea0e6013078712e6dd1.css integrity="sha256-ztIebTSX7pP+2PizV0SAlYQBeb1RC16g5gEweHEubdE=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://tomaugspurger.net/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tomaugspurger.net/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tomaugspurger.net/favicon-32x32.png><link rel=apple-touch-icon href=https://tomaugspurger.net/apple-touch-icon.png><link rel=mask-icon href=https://tomaugspurger.net/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tomaugspurger.net/posts/method-chaining/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Modern Pandas (Part 2): Method Chaining"><meta property="og:description" content="
This is part 2 in my series on writing modern idiomatic pandas.

Modern Pandas
Method Chaining
Indexes
Fast Pandas
Tidy Data
Visualization
Time Series
Scaling


Method Chaining
Method chaining, where you call methods on an object one after another, is in vogue at the moment.
It&rsquo;s always been a style of programming that&rsquo;s been possible with pandas,
and over the past several releases, we&rsquo;ve added methods that enable even more chaining."><meta property="og:type" content="article"><meta property="og:url" content="https://tomaugspurger.net/posts/method-chaining/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2016-04-04T00:00:00+00:00"><meta property="article:modified_time" content="2016-04-04T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Modern Pandas (Part 2): Method Chaining"><meta name=twitter:description content="
This is part 2 in my series on writing modern idiomatic pandas.

Modern Pandas
Method Chaining
Indexes
Fast Pandas
Tidy Data
Visualization
Time Series
Scaling


Method Chaining
Method chaining, where you call methods on an object one after another, is in vogue at the moment.
It&rsquo;s always been a style of programming that&rsquo;s been possible with pandas,
and over the past several releases, we&rsquo;ve added methods that enable even more chaining."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tomaugspurger.net/posts/"},{"@type":"ListItem","position":2,"name":"Modern Pandas (Part 2): Method Chaining","item":"https://tomaugspurger.net/posts/method-chaining/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Modern Pandas (Part 2): Method Chaining","name":"Modern Pandas (Part 2): Method Chaining","description":" This is part 2 in my series on writing modern idiomatic pandas.\nModern Pandas Method Chaining Indexes Fast Pandas Tidy Data Visualization Time Series Scaling Method Chaining Method chaining, where you call methods on an object one after another, is in vogue at the moment. It\u0026rsquo;s always been a style of programming that\u0026rsquo;s been possible with pandas, and over the past several releases, we\u0026rsquo;ve added methods that enable even more chaining.\n","keywords":["pandas"],"articleBody":" This is part 2 in my series on writing modern idiomatic pandas.\nModern Pandas Method Chaining Indexes Fast Pandas Tidy Data Visualization Time Series Scaling Method Chaining Method chaining, where you call methods on an object one after another, is in vogue at the moment. It’s always been a style of programming that’s been possible with pandas, and over the past several releases, we’ve added methods that enable even more chaining.\nassign (0.16.0): For adding new columns to a DataFrame in a chain (inspired by dplyr’s mutate) pipe (0.16.2): For including user-defined methods in method chains. rename (0.18.0): For altering axis names (in additional to changing the actual labels as before). Window methods (0.18): Took the top-level pd.rolling_* and pd.expanding_* functions and made them NDFrame methods with a groupby-like API. Resample (0.18.0) Added a new groupby-like API .where/mask/Indexers accept Callables (0.18.1): In the next release you’ll be able to pass a callable to the indexing methods, to be evaluated within the DataFrame’s context (like .query, but with code instead of strings). My scripts will typically start off with large-ish chain at the start getting things into a manageable state. It’s good to have the bulk of your munging done with right away so you can start to do Science™:\nHere’s a quick example:\n%matplotlib inline import os import numpy as np import pandas as pd import seaborn as sns import matplotlib.pyplot as plt sns.set(style='ticks', context='talk') import prep def read(fp): df = (pd.read_csv(fp) .rename(columns=str.lower) .drop('unnamed: 36', axis=1) .pipe(extract_city_name) .pipe(time_to_datetime, ['dep_time', 'arr_time', 'crs_arr_time', 'crs_dep_time']) .assign(fl_date=lambda x: pd.to_datetime(x['fl_date']), dest=lambda x: pd.Categorical(x['dest']), origin=lambda x: pd.Categorical(x['origin']), tail_num=lambda x: pd.Categorical(x['tail_num']), unique_carrier=lambda x: pd.Categorical(x['unique_carrier']), cancellation_code=lambda x: pd.Categorical(x['cancellation_code']))) return df def extract_city_name(df): ''' Chicago, IL -\u003e Chicago for origin_city_name and dest_city_name ''' cols = ['origin_city_name', 'dest_city_name'] city = df[cols].apply(lambda x: x.str.extract(\"(.*), \\w{2}\", expand=False)) df = df.copy() df[['origin_city_name', 'dest_city_name']] = city return df def time_to_datetime(df, columns): ''' Combine all time items into datetimes. 2014-01-01,0914 -\u003e 2014-01-01 09:14:00 ''' df = df.copy() def converter(col): timepart = (col.astype(str) .str.replace('\\.0$', '') # NaNs force float dtype .str.pad(4, fillchar='0')) return pd.to_datetime(df['fl_date'] + ' ' + timepart.str.slice(0, 2) + ':' + timepart.str.slice(2, 4), errors='coerce') df[columns] = df[columns].apply(converter) return df output = 'data/flights.h5' if not os.path.exists(output): df = read(\"data/627361791_T_ONTIME.csv\") df.to_hdf(output, 'flights', format='table') else: df = pd.read_hdf(output, 'flights', format='table') df.info() ","wordCount":"1853","inLanguage":"en","datePublished":"2016-04-04T00:00:00Z","dateModified":"2016-04-04T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://tomaugspurger.net/posts/method-chaining/"},"publisher":{"@type":"Organization","name":"Tom's Blog","logo":{"@type":"ImageObject","url":"https://tomaugspurger.net/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tomaugspurger.net/ accesskey=h title="Tom's Blog (Alt + H)">Tom's Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://tomaugspurger.net/about/ title=About><span>About</span></a></li><li><a href=https://tomaugspurger.net/archives title=Archive><span>Archive</span></a></li><li><a href=https://tomaugspurger.net/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://tomaugspurger.net/tags title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Modern Pandas (Part 2): Method Chaining</h1><div class=post-meta><span title='2016-04-04 00:00:00 +0000 UTC'>April 4, 2016</span></div></header><div class=post-content><hr><p>This is part 2 in my series on writing modern idiomatic pandas.</p><ul><li><a href=/posts/modern-1-intro>Modern Pandas</a></li><li><a href=/posts/method-chaining>Method Chaining</a></li><li><a href=/posts/modern-3-indexes>Indexes</a></li><li><a href=/posts/modern-4-performance>Fast Pandas</a></li><li><a href=/posts/modern-5-tidy>Tidy Data</a></li><li><a href=/posts/modern-6-visualization>Visualization</a></li><li><a href=/posts/modern-7-timeseries>Time Series</a></li><li><a href=/posts/modern-8-scaling>Scaling</a></li></ul><hr><h1 id=method-chaining>Method Chaining<a hidden class=anchor aria-hidden=true href=#method-chaining>#</a></h1><p>Method chaining, where you call methods on an object one after another, is in vogue at the moment.
It&rsquo;s always been a style of programming that&rsquo;s been possible with pandas,
and over the past several releases, we&rsquo;ve added methods that enable even more chaining.</p><ul><li><a href=http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.assign.html>assign</a> (0.16.0): For adding new columns to a DataFrame in a chain (inspired by dplyr&rsquo;s <code>mutate</code>)</li><li><a href=http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.pipe.html>pipe</a> (0.16.2): For including user-defined methods in method chains.</li><li><a href=http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#changes-to-rename>rename</a> (0.18.0): For altering axis names (in additional to changing the actual labels as before).</li><li><a href=http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#window-functions-are-now-methods>Window methods</a> (0.18): Took the top-level <code>pd.rolling_*</code> and <code>pd.expanding_*</code> functions and made them <code>NDFrame</code> methods with a <code>groupby</code>-like API.</li><li><a href=http://pandas.pydata.org/pandas-docs/version/0.18.0/whatsnew.html#resample-api>Resample</a> (0.18.0) Added a new <code>groupby</code>-like API</li><li><a href=https://github.com/pydata/pandas/pull/12539>.where/mask/Indexers accept Callables</a> (0.18.1): In the next release you&rsquo;ll be able to pass a callable to the indexing methods, to be evaluated within the DataFrame&rsquo;s context (like <code>.query</code>, but with code instead of strings).</li></ul><p>My scripts will typically start off with large-ish chain at the start getting things into a manageable state.
It&rsquo;s good to have the bulk of your munging done with right away so you can start to do Science™:</p><p>Here&rsquo;s a quick example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%</span>matplotlib inline
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> os
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> seaborn <span style=color:#66d9ef>as</span> sns
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>set(style<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ticks&#39;</span>, context<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;talk&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> prep
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>read</span>(fp):
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> (pd<span style=color:#f92672>.</span>read_csv(fp)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>str<span style=color:#f92672>.</span>lower)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>drop(<span style=color:#e6db74>&#39;unnamed: 36&#39;</span>, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>pipe(extract_city_name)
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>pipe(time_to_datetime, [<span style=color:#e6db74>&#39;dep_time&#39;</span>, <span style=color:#e6db74>&#39;arr_time&#39;</span>, <span style=color:#e6db74>&#39;crs_arr_time&#39;</span>, <span style=color:#e6db74>&#39;crs_dep_time&#39;</span>])
</span></span><span style=display:flex><span>            <span style=color:#f92672>.</span>assign(fl_date<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>to_datetime(x[<span style=color:#e6db74>&#39;fl_date&#39;</span>]),
</span></span><span style=display:flex><span>                    dest<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;dest&#39;</span>]),
</span></span><span style=display:flex><span>                    origin<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;origin&#39;</span>]),
</span></span><span style=display:flex><span>                    tail_num<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;tail_num&#39;</span>]),
</span></span><span style=display:flex><span>                    unique_carrier<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;unique_carrier&#39;</span>]),
</span></span><span style=display:flex><span>                    cancellation_code<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: pd<span style=color:#f92672>.</span>Categorical(x[<span style=color:#e6db74>&#39;cancellation_code&#39;</span>])))
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>extract_city_name</span>(df):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Chicago, IL -&gt; Chicago for origin_city_name and dest_city_name
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    cols <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#39;origin_city_name&#39;</span>, <span style=color:#e6db74>&#39;dest_city_name&#39;</span>]
</span></span><span style=display:flex><span>    city <span style=color:#f92672>=</span> df[cols]<span style=color:#f92672>.</span>apply(<span style=color:#66d9ef>lambda</span> x: x<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>extract(<span style=color:#e6db74>&#34;(.*), \w</span><span style=color:#e6db74>{2}</span><span style=color:#e6db74>&#34;</span>, expand<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>))
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>    df[[<span style=color:#e6db74>&#39;origin_city_name&#39;</span>, <span style=color:#e6db74>&#39;dest_city_name&#39;</span>]] <span style=color:#f92672>=</span> city
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>time_to_datetime</span>(df, columns):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;&#39;&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Combine all time items into datetimes.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    2014-01-01,0914 -&gt; 2014-01-01 09:14:00
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#39;&#39;&#39;</span>
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>converter</span>(col):
</span></span><span style=display:flex><span>        timepart <span style=color:#f92672>=</span> (col<span style=color:#f92672>.</span>astype(str)
</span></span><span style=display:flex><span>                       <span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>replace(<span style=color:#e6db74>&#39;\.0$&#39;</span>, <span style=color:#e6db74>&#39;&#39;</span>)  <span style=color:#75715e># NaNs force float dtype</span>
</span></span><span style=display:flex><span>                       <span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>pad(<span style=color:#ae81ff>4</span>, fillchar<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;0&#39;</span>))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> pd<span style=color:#f92672>.</span>to_datetime(df[<span style=color:#e6db74>&#39;fl_date&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39; &#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                               timepart<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>slice(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>2</span>) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;:&#39;</span> <span style=color:#f92672>+</span>
</span></span><span style=display:flex><span>                               timepart<span style=color:#f92672>.</span>str<span style=color:#f92672>.</span>slice(<span style=color:#ae81ff>2</span>, <span style=color:#ae81ff>4</span>),
</span></span><span style=display:flex><span>                               errors<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;coerce&#39;</span>)
</span></span><span style=display:flex><span>    df[columns] <span style=color:#f92672>=</span> df[columns]<span style=color:#f92672>.</span>apply(converter)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>output <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;data/flights.h5&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(output):
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> read(<span style=color:#e6db74>&#34;data/627361791_T_ONTIME.csv&#34;</span>)
</span></span><span style=display:flex><span>    df<span style=color:#f92672>.</span>to_hdf(output, <span style=color:#e6db74>&#39;flights&#39;</span>, format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;table&#39;</span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_hdf(output, <span style=color:#e6db74>&#39;flights&#39;</span>, format<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;table&#39;</span>)
</span></span><span style=display:flex><span>df<span style=color:#f92672>.</span>info()
</span></span></code></pre></div><pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
Int64Index: 450017 entries, 0 to 450016
Data columns (total 33 columns):
fl_date                  450017 non-null datetime64[ns]
unique_carrier           450017 non-null category
airline_id               450017 non-null int64
tail_num                 449378 non-null category
fl_num                   450017 non-null int64
origin_airport_id        450017 non-null int64
origin_airport_seq_id    450017 non-null int64
origin_city_market_id    450017 non-null int64
origin                   450017 non-null category
origin_city_name         450017 non-null object
dest_airport_id          450017 non-null int64
dest_airport_seq_id      450017 non-null int64
dest_city_market_id      450017 non-null int64
dest                     450017 non-null category
dest_city_name           450017 non-null object
crs_dep_time             450017 non-null datetime64[ns]
dep_time                 441445 non-null datetime64[ns]
dep_delay                441476 non-null float64
taxi_out                 441244 non-null float64
wheels_off               441244 non-null float64
wheels_on                440746 non-null float64
taxi_in                  440746 non-null float64
crs_arr_time             450017 non-null datetime64[ns]
arr_time                 440555 non-null datetime64[ns]
arr_delay                439645 non-null float64
cancelled                450017 non-null float64
cancellation_code        8886 non-null category
carrier_delay            97699 non-null float64
weather_delay            97699 non-null float64
nas_delay                97699 non-null float64
security_delay           97699 non-null float64
late_aircraft_delay      97699 non-null float64
unnamed: 32              0 non-null float64
dtypes: category(5), datetime64[ns](5), float64(13), int64(8), object(2)
memory usage: 103.2+ MB
</code></pre><p>I find method chains readable, though some people don&rsquo;t.
Both the code and the flow of execution are from top to bottom, and the function parameters are always near the function itself, unlike with heavily nested function calls.</p><p>My favorite example demonstrating this comes from <a href=http://trestletech.com/wp-content/uploads/2015/07/dplyr.pdf>Jeff Allen</a> (pdf). Compare these two ways of telling the same story:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-R data-lang=R><span style=display:flex><span><span style=color:#a6e22e>tumble_after</span>(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>broke</span>(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fell_down</span>(
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>fetch</span>(<span style=color:#a6e22e>went_up</span>(jack_jill, <span style=color:#e6db74>&#34;hill&#34;</span>), <span style=color:#e6db74>&#34;water&#34;</span>),
</span></span><span style=display:flex><span>            jack),
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;crown&#34;</span>),
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;jill&#34;</span>
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>and</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-R data-lang=R><span style=display:flex><span>jack_jill <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>went_up</span>(<span style=color:#e6db74>&#34;hill&#34;</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fetch</span>(<span style=color:#e6db74>&#34;water&#34;</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fell_down</span>(<span style=color:#e6db74>&#34;jack&#34;</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>broke</span>(<span style=color:#e6db74>&#34;crown&#34;</span>) <span style=color:#f92672>%&gt;%</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>tumble_after</span>(<span style=color:#e6db74>&#34;jill&#34;</span>)
</span></span></code></pre></div><p>Even if you weren&rsquo;t aware that in R <code>%>%</code> (pronounced <em>pipe</em>) calls the function on the right with the thing on the left as an argument, you can still make out what&rsquo;s going on. Compare that with the first style, where you need to unravel the code to figure out the order of execution and which arguments are being passed where.</p><p>Admittedly, you probably wouldn&rsquo;t write the first one.
It&rsquo;d be something like</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>on_hill <span style=color:#f92672>=</span> went_up(jack_jill, <span style=color:#e6db74>&#39;hill&#39;</span>)
</span></span><span style=display:flex><span>with_water <span style=color:#f92672>=</span> fetch(on_hill, <span style=color:#e6db74>&#39;water&#39;</span>)
</span></span><span style=display:flex><span>fallen <span style=color:#f92672>=</span> fell_down(with_water, <span style=color:#e6db74>&#39;jack&#39;</span>)
</span></span><span style=display:flex><span>broken <span style=color:#f92672>=</span> broke(fallen, <span style=color:#e6db74>&#39;jack&#39;</span>)
</span></span><span style=display:flex><span>after <span style=color:#f92672>=</span> tmple_after(broken, <span style=color:#e6db74>&#39;jill&#39;</span>)
</span></span></code></pre></div><p>I don&rsquo;t like this version because I have to spend time coming up with appropriate names for variables.
That&rsquo;s bothersome when we don&rsquo;t <em>really</em> care about the <code>on_hill</code> variable. We&rsquo;re just passing it into the next step.</p><p>A fourth way of writing the same story may be available. Suppose you owned a <code>JackAndJill</code> object, and could define the methods on it. Then you&rsquo;d have something like R&rsquo;s <code>%>%</code> example.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>jack_jill <span style=color:#f92672>=</span> JackAndJill()
</span></span><span style=display:flex><span>(jack_jill<span style=color:#f92672>.</span>went_up(<span style=color:#e6db74>&#39;hill&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>fetch(<span style=color:#e6db74>&#39;water&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>fell_down(<span style=color:#e6db74>&#39;jack&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>broke(<span style=color:#e6db74>&#39;crown&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>tumble_after(<span style=color:#e6db74>&#39;jill&#39;</span>)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>But the problem is you don&rsquo;t own the <code>ndarray</code> or <code>DataFrame</code> or <a href=http://xarray.pydata.org/en/stable/data-structures.html#dataarray><code>DataArray</code></a>, and the exact method you want may not exist.
Monekypatching on your own methods is fragile.
It&rsquo;s not easy to correctly subclass pandas&rsquo; DataFrame to extend it with your own methods.
Composition, where you create a class that holds onto a DataFrame internally, may be fine for your own code, but it won&rsquo;t interact well with the rest of the ecosystem so your code will be littered with lines extracting and repacking the underlying DataFrame.</p><p>Perhaps you could submit a pull request to pandas implementing your method.
But then you&rsquo;d need to convince the maintainers that it&rsquo;s broadly useful enough to merit its inclusion (and worth their time to maintain it). And <code>DataFrame</code> has something like 250+ methods, so we&rsquo;re reluctant to add more.</p><p>Enter <a href=http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.pipe.html><code>DataFrame.pipe</code></a>. All the benefits of having your specific function as a method on the DataFrame, without us having to maintain it, and without it overloading the already large pandas API. A win for everyone.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>jack_jill <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame()
</span></span><span style=display:flex><span>(jack_jill<span style=color:#f92672>.</span>pipe(went_up, <span style=color:#e6db74>&#39;hill&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>pipe(fetch, <span style=color:#e6db74>&#39;water&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>pipe(fell_down, <span style=color:#e6db74>&#39;jack&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>pipe(broke, <span style=color:#e6db74>&#39;crown&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>pipe(tumble_after, <span style=color:#e6db74>&#39;jill&#39;</span>)
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><p>This really is just right-to-left function execution. The first argument to <code>pipe</code>, a callable, is called with the DataFrame on the left as its first argument, and any additional arguments you specify.</p><p>I hope the analogy to data analysis code is clear.
Code is read more often than it is written.
When you or your coworkers or research partners have to go back in two months to update your script, having the story of raw data to results be told as clearly as possible will save you time.</p><h2 id=costs>Costs<a hidden class=anchor aria-hidden=true href=#costs>#</a></h2><p>One drawback to excessively long chains is that debugging can be harder.
If something looks wrong at the end, you don&rsquo;t have intermediate values to inspect. There&rsquo;s a close parallel here to python&rsquo;s generators. Generators are great for keeping memory consumption down, but they can be hard to debug since values are consumed.</p><p>For my typical exploratory workflow, this isn&rsquo;t really a big problem. I&rsquo;m working with a single dataset that isn&rsquo;t being updated, and the path from raw data to usuable data isn&rsquo;t so large that I can&rsquo;t drop an <code>import pdb; pdb.set_trace()</code> in the middle of my code to poke around.</p><p>For large workflows, you&rsquo;ll probably want to move away from pandas to something more structured, like <a href=http://pythonhosted.org/airflow/>Airflow</a> or <a href=http://luigi.readthedocs.org/en/stable/index.html>Luigi</a>.</p><p>When writing medium sized <a href=https://en.wikipedia.org/wiki/Extract,_transform,_load>ETL</a> jobs in python that will be run repeatedly, I&rsquo;ll use decorators to inspect and log properties about the DataFrames at each step of the process.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> functools <span style=color:#f92672>import</span> wraps
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> logging
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>log_shape</span>(func):
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@wraps</span>(func)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> func(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (func<span style=color:#f92672>.</span>__name__, result<span style=color:#f92672>.</span>shape))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>log_dtypes</span>(func):
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@wraps</span>(func)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>def</span> <span style=color:#a6e22e>wrapper</span>(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs):
</span></span><span style=display:flex><span>        result <span style=color:#f92672>=</span> func(<span style=color:#f92672>*</span>args, <span style=color:#f92672>**</span>kwargs)
</span></span><span style=display:flex><span>        logging<span style=color:#f92672>.</span>info(<span style=color:#e6db74>&#34;</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>,</span><span style=color:#e6db74>%s</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>%</span> (func<span style=color:#f92672>.</span>__name__, result<span style=color:#f92672>.</span>dtypes))
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> wrapper
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@log_shape</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@log_dtypes</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>load</span>(fp):
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(fp, index_col<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>, parse_dates<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@log_shape</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@log_dtypes</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>update_events</span>(df, new_events):
</span></span><span style=display:flex><span>    df<span style=color:#f92672>.</span>loc[new_events<span style=color:#f92672>.</span>index, <span style=color:#e6db74>&#39;foo&#39;</span>] <span style=color:#f92672>=</span> new_events
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> df
</span></span></code></pre></div><p>This plays nicely with <a href=http://engarde.readthedocs.org><code>engarde</code></a>, a little library I wrote to validate data as it flows through the pipeline (it essentialy turns those logging statements into excpetions if something looks wrong).</p><h2 id=inplace>Inplace?<a hidden class=anchor aria-hidden=true href=#inplace>#</a></h2><p>Most pandas methods have an <code>inplace</code> keyword that&rsquo;s <code>False</code> by default.
In general, you shouldn&rsquo;t do inplace operations.</p><p>First, if you like method chains then you simply can&rsquo;t use inplace since the return value is <code>None</code>, terminating the chain.</p><p>Second, I suspect people have a mental model of <code>inplace</code> operations happening, you know, inplace. That is, extra memory doesn&rsquo;t need to be allocated for the result. <a href=http://stackoverflow.com/a/22533110>But that might not actually be true</a>.
Quoting Jeff Reback from that answer</p><blockquote><p>Their is <strong>no guarantee</strong> that an inplace operation is actually faster. Often they are actually the same operation that works on a copy, but the top-level reference is reassigned.</p></blockquote><p>That is, the pandas code might look something like this</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>dataframe_method</span>(self, inplace<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>):
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> self<span style=color:#f92672>.</span>copy()  <span style=color:#75715e># regardless of inplace</span>
</span></span><span style=display:flex><span>    result <span style=color:#f92672>=</span> <span style=color:#f92672>...</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> inplace:
</span></span><span style=display:flex><span>        self<span style=color:#f92672>.</span>_update_inplace(data)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> result
</span></span></code></pre></div><p>There&rsquo;s a lot of defensive copying in pandas.
Part of this comes down to pandas being built on top of NumPy, and not having full control over how memory is handled and shared.
We saw it above when we defined our own functions <code>extract_city_name</code> and <code>time_to_datetime</code>.
Without the <code>copy</code>, adding the columns would modify the input DataFrame, which just isn&rsquo;t polite.</p><p>Finally, inplace operations don&rsquo;t make sense in projects like <a href=http://www.ibis-project.org>ibis</a> or <a href=http://dask.pydata.org/en/latest/>dask</a>, where you&rsquo;re manipulating expressions or building up a DAG of tasks to be executed, rather than manipulating the data directly.</p><h2 id=application>Application<a hidden class=anchor aria-hidden=true href=#application>#</a></h2><p>I feel like we haven&rsquo;t done much coding, mostly just me shouting from the top of a soapbox (sorry about that).
Let&rsquo;s do some exploratory analysis.</p><p>What does the daily flight pattern look like?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>(df<span style=color:#f92672>.</span>dropna(subset<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;dep_time&#39;</span>, <span style=color:#e6db74>&#39;unique_carrier&#39;</span>])
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>loc[df[<span style=color:#e6db74>&#39;unique_carrier&#39;</span>]
</span></span><span style=display:flex><span>       <span style=color:#f92672>.</span>isin(df[<span style=color:#e6db74>&#39;unique_carrier&#39;</span>]<span style=color:#f92672>.</span>value_counts()<span style=color:#f92672>.</span>index[:<span style=color:#ae81ff>5</span>])]
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>set_index(<span style=color:#e6db74>&#39;dep_time&#39;</span>)
</span></span><span style=display:flex><span>   <span style=color:#75715e># TimeGrouper to resample &amp; groupby at once</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>groupby([<span style=color:#e6db74>&#39;unique_carrier&#39;</span>, pd<span style=color:#f92672>.</span>TimeGrouper(<span style=color:#e6db74>&#34;H&#34;</span>)])
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>fl_num<span style=color:#f92672>.</span>count()
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>unstack(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>fillna(<span style=color:#ae81ff>0</span>)
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>rolling(<span style=color:#ae81ff>24</span>)
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>sum()
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>rename_axis(<span style=color:#e6db74>&#34;Flights per Day&#34;</span>, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>   <span style=color:#f92672>.</span>plot()
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>despine()
</span></span></code></pre></div><p><img loading=lazy src=/images/modern_2_method_chaining_8_0.png alt=png></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> statsmodels.api <span style=color:#66d9ef>as</span> sm
</span></span></code></pre></div><pre><code>/Users/taugspurger/miniconda3/envs/modern-pandas/lib/python3.6/site-packages/statsmodels/compat/pandas.py:56: FutureWarning: The pandas.core.datetools module is deprecated and will be removed in a future version. Please use the pandas.tseries module instead.
  from pandas.core import datetools
</code></pre><p>Does a plane with multiple flights on the same day get backed up, causing later flights to be delayed more?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>%</span>config InlineBackend<span style=color:#f92672>.</span>figure_format <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;png&#39;</span>
</span></span><span style=display:flex><span>flights <span style=color:#f92672>=</span> (df[[<span style=color:#e6db74>&#39;fl_date&#39;</span>, <span style=color:#e6db74>&#39;tail_num&#39;</span>, <span style=color:#e6db74>&#39;dep_time&#39;</span>, <span style=color:#e6db74>&#39;dep_delay&#39;</span>]]
</span></span><span style=display:flex><span>           <span style=color:#f92672>.</span>dropna()
</span></span><span style=display:flex><span>           <span style=color:#f92672>.</span>sort_values(<span style=color:#e6db74>&#39;dep_time&#39;</span>)
</span></span><span style=display:flex><span>           <span style=color:#f92672>.</span>loc[<span style=color:#66d9ef>lambda</span> x: x<span style=color:#f92672>.</span>dep_delay <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>500</span>]
</span></span><span style=display:flex><span>           <span style=color:#f92672>.</span>assign(turn <span style=color:#f92672>=</span> <span style=color:#66d9ef>lambda</span> x:
</span></span><span style=display:flex><span>                x<span style=color:#f92672>.</span>groupby([<span style=color:#e6db74>&#39;fl_date&#39;</span>, <span style=color:#e6db74>&#39;tail_num&#39;</span>])
</span></span><span style=display:flex><span>                 <span style=color:#f92672>.</span>dep_time
</span></span><span style=display:flex><span>                 <span style=color:#f92672>.</span>transform(<span style=color:#e6db74>&#39;rank&#39;</span>)<span style=color:#f92672>.</span>astype(int)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>fig, ax <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>boxplot(x<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;turn&#39;</span>, y<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;dep_delay&#39;</span>, data<span style=color:#f92672>=</span>flights, ax<span style=color:#f92672>=</span>ax)
</span></span><span style=display:flex><span>ax<span style=color:#f92672>.</span>set_ylim(<span style=color:#f92672>-</span><span style=color:#ae81ff>50</span>, <span style=color:#ae81ff>50</span>)
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>despine()
</span></span></code></pre></div><p><img loading=lazy src=/images/modern_2_method_chaining_11_0.png alt=png></p><p>Doesn&rsquo;t really look like it. Maybe other planes are swapped in when one gets delayed,
but we don&rsquo;t have data on <em>scheduled</em> flights per plane.</p><p>Do flights later in the day have longer delays?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>plt<span style=color:#f92672>.</span>figure(figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>15</span>, <span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>(df[[<span style=color:#e6db74>&#39;fl_date&#39;</span>, <span style=color:#e6db74>&#39;tail_num&#39;</span>, <span style=color:#e6db74>&#39;dep_time&#39;</span>, <span style=color:#e6db74>&#39;dep_delay&#39;</span>]]
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>dropna()
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>assign(hour<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: x<span style=color:#f92672>.</span>dep_time<span style=color:#f92672>.</span>dt<span style=color:#f92672>.</span>hour)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;5 &lt; dep_delay &lt; 600&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#f92672>.</span>pipe((sns<span style=color:#f92672>.</span>boxplot, <span style=color:#e6db74>&#39;data&#39;</span>), <span style=color:#e6db74>&#39;hour&#39;</span>, <span style=color:#e6db74>&#39;dep_delay&#39;</span>))
</span></span><span style=display:flex><span>sns<span style=color:#f92672>.</span>despine()
</span></span></code></pre></div><p><img loading=lazy src=/images/modern_2_method_chaining_13_0.png alt=png></p><p>There could be something here. I didn&rsquo;t show it here since I filtered them out,
but the vast majority of flights do leave on time.</p><p>Thanks for reading!
This section was a bit more abstract, since we were talking about styles
of coding rather than how to actually accomplish tasks.
I&rsquo;m sometimes guilty of putting too much work into making my data wrangling code look nice and feel correct, at the expense of actually analyzing the data.
This isn&rsquo;t a competition to have the best or cleanest pandas code; pandas is always just a means to the end that is your research or business problem.
Thanks for indulging me.
Next time we&rsquo;ll talk about a much more practical topic: performance.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tomaugspurger.net/tags/pandas/>Pandas</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://tomaugspurger.net/>Tom's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><a rel=me href=https://mastodon.social/@TomAugspurger></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>
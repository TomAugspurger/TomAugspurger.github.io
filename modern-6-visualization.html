<!DOCTYPE html>
<html lang="en">
<head>
          <title>DatasFrame</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
        <link rel="stylesheet" href="./theme/css/main.css" />
        <script src="//code.jquery.com/jquery-2.2.2.min.js"></script>



    <meta name="tags" content="python" />
    <meta name="tags" content="data science" />
    <meta name="tags" content="pandas" />
    <meta name="tags" content="modern" />

</head>

<body id="index" class="home">
    <nav>
      <a href=".">Home | </a>
      <a href="/archives.html">Archive | </a>
      <a href="/categories.html">Categories | </a>
      <a href="/pages/about.html">About | </a>
      <a href="https://tomaugspurger.github.io/feeds/all.rss.xml">RSS</a>
    </nav>

<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="./modern-6-visualization.html" rel="bookmark"
         title="Permalink to Modern Pandas (Part 6): Visualization">Modern Pandas (Part 6): Visualization</a></h2>
 
  </header>
  <footer class="post-info">
    <abbr class="published" title="2016-04-28T09:00:00-05:00">
      Thu 28 April 2016
    </abbr>
    <address class="vcard author">
      By           <a class="url fn" href="./author/tom-augspurger.html">Tom Augspurger</a>
    </address>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <hr />
<p>This is part 6 in my series on writing modern idiomatic pandas.</p>
<ul>
<li><a href="modern-1.html">Modern Pandas</a></li>
<li><a href="method-chaining.html">Method Chaining</a></li>
<li><a href="modern-3-indexes.html">Indexes</a></li>
<li><a href="modern-4-performance.html">Fast Pandas</a></li>
<li><a href="modern-5-tidy.html">Tidy Data</a></li>
<li><a href="modern-6-visualization.html">Visualization</a></li>
<li><a href="modern-7-timeseries.html">Time Series</a></li>
</ul>
<p><a href="http://nbviewer.jupyter.org/gist/TomAugspurger/cd5197cef13d6103aba01abb4569d266">This post is available as a Jupyter notebook</a></p>
<hr />
<p>A few weeks ago, the R community went through some hand-wringing about plotting packages.
For outsiders (like me) the details aren't that important, but some brief background might be useful so we can transfer the takeaways to Python.
The competing systems are "base R", which is the plotting system built into the language, and ggplot2, Hadley Wickham's implementation of the grammar of graphics.
For those interested in more details, start with</p>
<ul>
<li><a href="http://simplystatistics.org/2016/02/11/why-i-dont-use-ggplot2/">Why I Don't Use ggplot2</a></li>
<li><a href="http://varianceexplained.org/r/why-I-use-ggplot2/">Why I use ggplot2</a></li>
<li><a href="http://flowingdata.com/2016/03/22/comparing-ggplot2-and-r-base-graphics/">Comparing ggplot2 and base r graphics</a></li>
</ul>
<p>The most important takeaways are that</p>
<ol>
<li>Either system is capable of producing anything the other can</li>
<li>ggplot2 is usually better for exploratory analysis</li>
</ol>
<p>Item 2 is not universally agreed upon, and it certainly isn't true for every type of chart, but we'll take it as fact for now.
I'm not foolish enough to attempt a formal analogy here, like "matplotlib is python's base R".
But there's at least a rough comparison:
like dplyr/tidyr and ggplot2, the combination of pandas and seaborn allows for fast iteration and exploration.
When you need to, you can "drop down" into matplotlib for further refinement.</p>
<h1>Overview</h1>
<p>Here's a brief sketch of the plotting landscape as of April 2016.
For some reason, plotting tools feel a bit more personal than other parts of this series so far, so I feel the need to blanket this who discussion in a caveat: this is my personal take, shaped by my personal background and tastes.
Also, I'm not at all an expert on visualization, just a consumer.
For real advice, you should <a href="http://twitter.com/mbostock">listen</a> to the <a href="https://twitter.com/oceankidbilly">experts</a> in this <a href="https://twitter.com/arnicas">area</a>.
Take this all with an extra grain or two of salt.</p>
<h2><a href="http://matplotlib.org/">Matplotlib</a></h2>
<p>Matplotlib is an amazing project, and is the foundation of pandas' built-in plotting and Seaborn.
It handles everything from the integration with various drawing backends, to several APIs handling drawing charts or adding and transforming individual glyphs (artists).
I've found knowing the <a href="http://matplotlib.org/api/pyplot_api.html">pyplot API</a> useful.
You're less likely to need things like <a href="http://matplotlib.org/users/transforms_tutorial.html">Transforms</a> or <a href="http://matplotlib.org/api/artist_api.html">artists</a>, but when you do the documentation is there.</p>
<p>Matplotlib has built up something of a bad reputation for being verbose.
I think that complaint is valid, but misplaced.
Matplotlib lets you control essentially anything on the figure.
An overly-verbose API just means there's an opportunity for a higher-level, domain specific, package to exist (like seaborn for statistical graphics).</p>
<h2><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/visualization.html">Pandas' builtin-plotting</a></h2>
<p><code>DataFrame</code> and <code>Series</code> have a <code>.plot</code> namespace, with various chart types available (<code>line</code>, <code>hist</code>, <code>scatter</code>, etc.).
Pandas objects provide additional metadata that can be used to enhance plots (the Index for a better automatic x-axis then <code>range(n)</code> or Index names as axis labels for example).</p>
<p>And since pandas had fewer backwards-compatibility constraints, it had a bit better default aesthetics.
The <a href="http://matplotlib.org/style_changes.html">matplotlib 2.0 release</a> will level this, and pandas has <a href="https://github.com/pydata/pandas/issues/11783">deprecated its custom plotting styles</a>, in favor of matplotlib's<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" rel="footnote">1</a></sup>.</p>
<p>At this point, I see pandas <code>DataFrame.plot</code> as a useful exploratory tool for quick throwaway plots.</p>
<h2><a href="https://stanford.edu/~mwaskom/software/seaborn/">Seaborn</a></h2>
<p><a href="https://stanford.edu/~mwaskom/software/seaborn/">Seaborn</a>, created by Michael Waskom, "provides a high-level interface for drawing attractive statistical graphics."
Seaborn gives a great API for quickly exploring different visual representations of your data. We'll be focusing on that today.</p>
<h2><a href="http://bokeh.pydata.org/en/latest/">Bokeh</a></h2>
<p><a href="http://bokeh.pydata.org/en/latest/">Bokeh</a> is a (still under heavy development) visualization library that targets the browser.</p>
<p>Like matplotlib, Bokeh has a few APIs at various levels of abstraction.
They have a glyph API for drawing single or arrays of glyphs (circles, rectangles, polygons, etc.).
More recently they introduced a Charts API, for producing canned charts from data structures like dicts or DataFrames.</p>
<h2>Other Libraries</h2>
<p>This is a (probably incomplete) list of other visualization libraries that I don't know enough about to comment on</p>
<ul>
<li><a href="https://plot.ly/python/">Ploty</a></li>
<li><a href="http://lightning-viz.org/">Lightning</a></li>
<li><a href="http://holoviews.org/">HoloViews</a></li>
<li><a href="http://www.glueviz.org/en/stable/">Glueviz</a></li>
<li><a href="http://vispy.org/">vispy</a></li>
<li><a href="https://github.com/bloomberg/bqplot">bqplot</a></li>
</ul>
<p>It's also possible to use Javascript tools like D3 directly in the Jupyter notebook, but we won't go into those today.</p>
<h1>Examples</h1>
<p>I do want to pause and explain the type of work I'm doing with these packages.
The vast majority of plots I create are for exploratory analysis, helping me understand the dataset I'm working with.
They aren't intended for the client (whoever that is) to see.
Occasionally that exploratory plot will evolve towards a final product that will be used to explain things to the client.
In this case I'll either polish the exploratory plot, or rewrite it in another system more suitable for the final product (in D3 or Bokeh, say, if it needs to be an interactive document in the browser).</p>
<p>Now that we have a feel for the overall landscape (from my point of view), let's delve into a few examples.
We'll use the <code>diamonds</code> dataset from ggplot2.
You could use Vincent Arelbundock's <a href="https://github.com/vincentarelbundock/Rdatasets">RDatasets package</a> to find it (<code>pd.read_csv('http://vincentarelbundock.github.io/Rdatasets/csv/ggplot2/diamonds.csv')</code>), but I wanted to checkout <a href="https://github.com/wesm/feather">feather</a>.</p>
<div class="codehilite"><pre><span></span><span class="o">%</span><span class="n">load_ext</span> <span class="n">rpy2</span><span class="o">.</span><span class="n">ipython</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="o">%%</span>R
<span class="kp">suppressPackageStartupMessages</span><span class="p">(</span><span class="kn">library</span><span class="p">(</span>ggplot2<span class="p">))</span>
<span class="kn">library</span><span class="p">(</span>feather<span class="p">)</span>
write_feather<span class="p">(</span>diamonds<span class="p">,</span> <span class="s">&#39;diamonds.fthr&#39;</span><span class="p">)</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">feather</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">feather</span><span class="o">.</span><span class="n">read_dataframe</span><span class="p">(</span><span class="s1">&#39;diamonds.fthr&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>carat</th>
      <th>cut</th>
      <th>color</th>
      <th>clarity</th>
      <th>depth</th>
      <th>table</th>
      <th>price</th>
      <th>x</th>
      <th>y</th>
      <th>z</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.23</td>
      <td>Ideal</td>
      <td>E</td>
      <td>SI2</td>
      <td>61.5</td>
      <td>55.0</td>
      <td>326</td>
      <td>3.95</td>
      <td>3.98</td>
      <td>2.43</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.21</td>
      <td>Premium</td>
      <td>E</td>
      <td>SI1</td>
      <td>59.8</td>
      <td>61.0</td>
      <td>326</td>
      <td>3.89</td>
      <td>3.84</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.23</td>
      <td>Good</td>
      <td>E</td>
      <td>VS1</td>
      <td>56.9</td>
      <td>65.0</td>
      <td>327</td>
      <td>4.05</td>
      <td>4.07</td>
      <td>2.31</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.29</td>
      <td>Premium</td>
      <td>I</td>
      <td>VS2</td>
      <td>62.4</td>
      <td>58.0</td>
      <td>334</td>
      <td>4.20</td>
      <td>4.23</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.31</td>
      <td>Good</td>
      <td>J</td>
      <td>SI2</td>
      <td>63.3</td>
      <td>58.0</td>
      <td>335</td>
      <td>4.34</td>
      <td>4.35</td>
      <td>2.75</td>
    </tr>
  </tbody>
</table>
</div>

<div class="codehilite"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>


<div class="codehilite"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 53940 entries, 0 to 53939
Data columns (total 10 columns):
carat      53940 non-null float64
cut        53940 non-null category
color      53940 non-null category
clarity    53940 non-null category
depth      53940 non-null float64
table      53940 non-null float64
price      53940 non-null int32
x          53940 non-null float64
y          53940 non-null float64
z          53940 non-null float64
dtypes: category(3), float64(6), int32(1)
memory usage: 2.8 MB
</pre></div>


<p>Notice that the categorical dtypes are preserved.</p>
<h2>Bokeh</h2>
<div class="codehilite"><pre><span></span><span class="kn">import</span> <span class="nn">bokeh.charts</span> <span class="kn">as</span> <span class="nn">bc</span>
<span class="kn">import</span> <span class="nn">bokeh.plotting</span> <span class="kn">as</span> <span class="nn">bk</span>
</pre></div>


<p>Bokeh provides two APIs, a low-level glyph API and a higher-level Charts API.
Here's an example of the charts API.</p>
<div class="codehilite"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">xy</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">x</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
         <span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
         <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">bc</span><span class="o">.</span><span class="n">Scatter</span><span class="p">,</span> <span class="s2">&quot;xy&quot;</span><span class="p">,</span> <span class="s2">&quot;price&quot;</span><span class="p">))</span>
<span class="n">bk</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
</pre></div>


<p><link
    href="http://cdn.pydata.org/bokeh/release/bokeh-0.11.1.min.css"
    rel="stylesheet" type="text/css">
<script src="http://cdn.pydata.org/bokeh/release/bokeh-0.11.1.min.js"></script></p>
<script async=true type="text/javascript" src="images/script.js"></script>

<div class="plotdiv" id="2279cca6-cb5e-4d6c-bb0e-d09f9578d10d"></div>

<p>It's not clear to me where the scientific community will come down on Bokeh for exploratory analysis.
The ability to share interactive graphics is compelling.
The trend towards more and more analysis and communication happening in the browser will only enhance this feature of Bokeh.</p>
<p>Personally though, I have a lot of inertia behind matplotlib so I haven't switched to Bokeh for day-to-day exploratory analysis.</p>
<p>I have greatly enjoyed Bokeh for building dashboards and <a href="http://bokeh.pydata.org/en/latest/docs/user_guide/interaction.html">webapps</a> with Bokeh server.
It's still young, and I've hit <a href="http://stackoverflow.com/questions/36610328/control-bokeh-plot-state-with-http-request">some rough edges</a>, but I'm happy to put up with some awkwardness to avoid writing more javascript.</p>
<h2>Matplotlib</h2>
<p>Since it's relatively new, I should point out that matplotlib 1.5 added support for plotting labeled data.</p>
<div class="codehilite"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;carat&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/mpl-scatter.png" /></p>
<p>This isn't limited to just <code>DataFrame</code>s.
It supports anything that uses <code>__getitem__</code> (square-brackets) with string keys.
Other than that, I don't have much to add to the <a href="http://matplotlib.org/">matplotlib documentation</a>.</p>
<h2>Pandas Built-in Plotting</h2>
<p>The metadata in DataFrames gives a bit better defaults on plots.</p>
<div class="codehilite"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;carat&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;depth&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">15</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/pd-scatter.png" /></p>
<p>We get axis labels from the column names.
Nothing major, just nice.</p>
<p>Pandas can be more convenient for plotting a bunch of columns with a shared x-axis (the index), say several timeseries.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">pandas_datareader</span> <span class="kn">import</span> <span class="n">fred</span>

<span class="n">gdp</span> <span class="o">=</span> <span class="n">fred</span><span class="o">.</span><span class="n">FredReader</span><span class="p">([</span><span class="s1">&#39;GCEC96&#39;</span><span class="p">,</span> <span class="s1">&#39;GPDIC96&#39;</span><span class="p">],</span> <span class="n">start</span><span class="o">=</span><span class="s1">&#39;2000-01-01&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
<span class="n">gdp</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;GCEC96&quot;</span><span class="p">:</span> <span class="s2">&quot;Government Expenditure&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;GPDIC96&quot;</span><span class="p">:</span> <span class="s2">&quot;Private Investment&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="images/vis-gdp.svg" /></p>
<p>Most <code>DataFrame.plot</code> methods will take a boolean <code>subplots</code> keyword, for drawing on separate <code>axes</code> within the same figure. This can be nicer than setting those up manually with matplotlib, though as we'll see next seaborn has an even better API here.</p>
<h2>Seaborn</h2>
<p>The rest of this post will focus on seaborn, and why I think it's especially great for exploratory analysis.</p>
<p>I would encourage you to read Seaborn's <a href="https://stanford.edu/~mwaskom/software/seaborn/introduction.html#introduction">introductory notes</a>, which describe its design philosophy and attempted goals. Some highlights:</p>
<blockquote>
<p>Seaborn aims to make visualization a central part of exploring and understanding data.</p>
</blockquote>
<p>It does this through a consistent, understandable (to me anyway) API.</p>
<blockquote>
<p>The plotting functions try to do something useful when called with a minimal set of arguments, and they expose a number of customizable options through additional parameters.</p>
</blockquote>
<p>Which works great for exploratory analysis, with the option to turn that into something more polished if it looks promising.</p>
<blockquote>
<p>Some of the functions plot directly into a matplotlib axes object, while others operate on an entire figure and produce plots with several panels.</p>
</blockquote>
<p>The fact that seaborn is built on matplotlib means that if you are familiar with the pyplot API, your knowledge will still be useful.</p>
<p>Most seaborn plotting functions (one per chart-type) take an <code>x</code>, <code>y</code>, <code>hue</code>, and <code>data</code> arguments (only some are required, depending on the plot type). If you're working with DataFrames, you'll pass in strings referring to column names, and the DataFrame for <code>data</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">countplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cut&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/vis-countplot.svg" /></p>
<div class="codehilite"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;cut&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>


<p><img alt="png" src="images/vis-barplot.svg" /></p>
<p>Bivariate relationships can easily be explored, either one at a time:</p>
<div class="codehilite"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;carat&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">,</span>
              <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/vis-joinplot.png" /></p>
<p>Or many at once</p>
<div class="codehilite"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;cut&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/vis-pairplot.png" /></p>
<p><code>pairplot</code> is a convenience wrapper around <code>PairGrid</code>, and offers our first look at an important seaborn abstraction, the <code>Grid</code>. <em>Seaborn <code>Grid</code>s provide a link between a matplotlib <code>Figure</code> with multiple <code>axes</code> and features in your dataset.</em></p>
<p>There are two main ways of interacting with grids. First, seaborn provides convenience-wrapper functions like <code>pairplot</code>, that have good defaults for common tasks. If you need more flexibility, you can work with the <code>Grid</code> directly by mapping plotting functions over each axes.</p>
<div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">core</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="err">α</span><span class="o">=.</span><span class="mo">05</span><span class="p">):</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span> <span class="o">&gt;</span> <span class="n">df</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="err">α</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="err">α</span><span class="p">))</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>


<div class="codehilite"><pre><span></span><span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">cubehelix_palette</span><span class="p">(</span><span class="n">as_cmap</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dark</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">light</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">core</span><span class="p">)</span>
   <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">)</span>
   <span class="o">.</span><span class="n">map_upper</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
   <span class="o">.</span><span class="n">map_diag</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">)</span>
   <span class="o">.</span><span class="n">map_lower</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">hexbin</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">gridsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/vis-pairgrid.png" /></p>
<p><code>PairGrid</code> is a special case of <code>Grid</code> faceting by each <code>(x, y)</code> combination.
Next we'll use <code>FacetGrid</code>, another class for producing <code>Grid</code>s, with control over how each facet (individual axes) gets determined. In this example, we'll facet by <code>cut</code>.</p>
<div class="codehilite"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="s1">&#39;cut&#39;</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">1.76</span><span class="p">,</span> <span class="n">margin_titles</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">,</span> <span class="n">shade</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">g</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15000</span><span class="p">))</span>
</pre></div>


<p><img alt="png" src="images/vis-kde-facet.svg" /></p>
<p>This last example shows the tight integration with matplotlib. <code>g.axes</code> is an array of <code>matplotlib.Axes</code> and <code>g.fig</code> is a <code>matplotlib.Figure</code>.
This is a pretty common pattern when using seaborn: use a seaborn plotting method (or grid) to get a good start, and then adjust with matplotlib as needed.</p>
<p>I <em>think</em> (not an expert on this at all) that one thing people like about the grammar of graphics is its flexibility.
You aren't limited to a fixed set of chart types defined by the library author.
Instead, you construct your chart by layering scales, aesthetics and geometries.
And using <code>ggplot2</code> in R is a delight.</p>
<p>That said, I wouldn't really call what seaborn / matplotlib offer that limited.
You can create pretty complex charts suited to your needs.</p>
<div class="codehilite"><pre><span></span><span class="n">agged</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;cut&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">PairGrid</span><span class="p">(</span><span class="n">agged</span><span class="p">,</span> <span class="n">x_vars</span><span class="o">=</span><span class="n">agged</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">2</span><span class="p">:],</span> <span class="n">y_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;cut&#39;</span><span class="p">,</span> <span class="s1">&#39;color&#39;</span><span class="p">],</span>
                 <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=.</span><span class="mi">65</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;h&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Blues_d&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/facet-stripplot.svg" /></p>
<div class="codehilite"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">,</span> <span class="s1">&#39;carat&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/vis-factet-rag.png" /></p>
<p>Initially I had many more examples showing off seaborn, but I'll spare you.
Seaborn's <a href="https://stanford.edu/~mwaskom/software/seaborn/">documentation</a> is thorough (and just beautiful to look at).</p>
<p>We'll end with a nice scikit-learn integration for exploring the parameter-space on a GridSearch object.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.grid_search</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>
</pre></div>


<p>For those unfamiliar with machine learning or scikit-learn, the basic idea is your algorithm (<code>RandomForestClassifer</code>) is trying to maximize some objective function (percent of correctly classified items in this case).
There are various <em>hyperparameters</em> that affect the fit.
We can search this space by trying out a bunch of possible values for each parameter with the <code>GridSearchCV</code> estimator.</p>
<div class="codehilite"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s1">&#39;titanic&#39;</span><span class="p">)</span>

<span class="n">clf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">()</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">max_depth</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">],</span>
                  <span class="n">min_samples_split</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>
                  <span class="n">min_samples_leaf</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">est</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;survived&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;survived&#39;</span><span class="p">,</span> <span class="s1">&#39;who&#39;</span><span class="p">,</span> <span class="s1">&#39;alive&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">median</span><span class="p">())</span>
<span class="n">est</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</pre></div>


<p>Let's unpack the scores (a list of tuples) into a DataFrame.</p>
<div class="codehilite"><pre><span></span><span class="n">scores</span> <span class="o">=</span> <span class="n">est</span><span class="o">.</span><span class="n">grid_scores_</span>
<span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">params</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">scores</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">mean_validation_score</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">row</span><span class="o">.</span><span class="n">cv_validation_scores</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">parameters</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">params</span><span class="p">])</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean_&#39;</span><span class="p">,</span> <span class="s1">&#39;std_&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="p">)</span>
</pre></div>


<p>And visualize it, seeing that max-depth should probably be at least 10.</p>
<div class="codehilite"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">factorplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;max_depth&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean_&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">scores</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">,</span>
               <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="images/vis-grid-search.svg" /></p>
<p>Thanks for reading!
I want to reiterate at the end that this is just <em>my</em> way of doing data visualization.
Your needs might differ, meaning you might need different tools.
You can still use pandas to get it to the point where it's ready to be visualized!</p>
<p>As always, <a href="https://twitter.com/tomaugspurger">feedback is welcome</a>.</p>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p>OK, technically <a href="https://github.com/pydata/pandas/issues/11727">I just broke</a> it when fixing matplotlib 1.5 compatibility, so we deprecated it after the fact.&#160;<a class="footnote-backref" href="#fnref:1" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
  </div><!-- /.entry-content -->
</section>

    <footer>
      <p>&copy; Tom Augspurger </p>
    </footer>
  </main>

</body>
</html>
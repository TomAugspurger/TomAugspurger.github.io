<!DOCTYPE html>
<html lang="en">

<head>
  <!-- ## for client-side less
  <link rel="stylesheet/less" type="text/css" href="/theme/css/style.less">
  <script src="//cdnjs.cloudflare.com/ajax/libs/less.js/1.7.3/less.min.js" type="text/javascript"></script>
  -->
  <link rel="icon" type="image/vnd.microsoft.icon" href="/">
  <link rel="stylesheet" type="text/css" href="/theme/css/normalize.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/style.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto+Mono">
  <link rel="stylesheet" type="text/css" href="/theme/css/font-awesome.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/hatena-bookmark-icon.css">
  <link rel="stylesheet" type="text/css" href="theme/css/custom.css">


  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="author" content="Tom Augspurger">
  <meta name="description" content="Posts and writings by Tom Augspurger">

  <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="datas-frame Atom" />

<meta name="keywords" content="pandas">

  <title>
    datas-frame
&ndash; Modern Panadas (Part 3): Indexes  </title>

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-48304175-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <main>
    <header>
      <div class="site-name">
        <a href="">datas-frame</a>
      </div>
      <p>
        <a href="/archives.html"><i class="fa fa-archive"></i> Archive</a>
      </p>
    </header>

<article>
  <div class="article__title">
    <h1><a href="/modern-3-indexes.html">Modern Panadas (Part 3): Indexes</a></h1>
  </div>
  <div class="article__meta">
    <p class="article__meta__post-date">Posted on: Mon 11 April 2016</p>
 Tags:
      <a href="/tag/pandas.html">#pandas</a>    </p>
  </div>
  <div class="article__text">
    <hr>
<p>This is part 3 in my series on writing modern idiomatic pandas.</p>
<ul>
<li><a href="modern-1-intro">Modern Pandas</a></li>
<li><a href="method-chaining">Method Chaining</a></li>
<li><a href="modern-3-indexes">Indexes</a></li>
<li><a href="modern-4-performance">Fast Pandas</a></li>
<li><a href="modern-5-tidy">Tidy Data</a></li>
<li><a href="modern-6-visualization">Visualization</a></li>
<li><a href="modern-7-timeseries">Time Series</a></li>
<li><a href="modern-8-scaling">Scaling</a></li>
</ul>
<hr>
<p><code>Indexes</code> can be a difficult concept to grasp at first.
I suspect this is partly becuase they're somewhat peculiar to pandas.
These aren't like the indexes put on relational database tables for performance optimizations.
Rather, they're more like the <code>row_labels</code> of an R DataFrame, but much more capable.</p>
<p><code>Indexes</code> offer</p>
<ul>
<li>metadata container</li>
<li>easy label-based row selection</li>
<li>easy label-based alignment in operations</li>
<li>label-based concatenation</li>
</ul>
<p>To demonstrate these, we'll first fetch some more data.
This will be weather data from sensors at a bunch of airports across the US.
See <a href="https://github.com/akrherz/iem/blob/master/scripts/asos/iem_scraper_example.py">here</a> for the example scraper I based this off of.</p>
<div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>

<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="kn">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;ticks&#39;</span><span class="p">)</span>

<span class="c1"># States are broken into networks. The networks have a list of ids, each representing a station.</span>
<span class="c1"># We will take that list of ids and pass them as query parameters to the URL we built up ealier.</span>
<span class="n">states</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;AK AL AR AZ CA CO CT DE FL GA HI IA ID IL IN KS KY LA MA MD ME</span>
<span class="s2"> MI MN MO MS MT NC ND NE NH NJ NM NV NY OH OK OR PA RI SC SD TN TX UT VA VT</span>
<span class="s2"> WA WI WV WY&quot;&quot;&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>

<span class="c1"># IEM has Iowa AWOS sites in its own labeled network</span>
<span class="n">networks</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AWOS&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;{}_ASOS&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state</span><span class="p">)</span> <span class="k">for</span> <span class="n">state</span> <span class="ow">in</span> <span class="n">states</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_weather</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">),</span>
                <span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31&#39;</span><span class="p">)):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Fetch weather data from MESONet between ``start`` and ``stop``.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;http://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?&quot;</span>
           <span class="s2">&quot;&amp;data=tmpf&amp;data=relh&amp;data=sped&amp;data=mslp&amp;data=p01i&amp;data=vsby&amp;data=gust_mph&amp;data=skyc1&amp;data=skyc2&amp;data=skyc3&quot;</span>
           <span class="s2">&quot;&amp;tz=Etc/UTC&amp;format=comma&amp;latlon=no&quot;</span>
           <span class="s2">&quot;&amp;{start:year1=%Y&amp;month1=%m&amp;day1=</span><span class="si">%d</span><span class="s2">}&quot;</span>
           <span class="s2">&quot;&amp;{end:year2=%Y&amp;month2=%m&amp;day2=</span><span class="si">%d</span><span class="s2">}&amp;{stations}&quot;</span><span class="p">)</span>
    <span class="n">stations</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;station=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">)</span>
    <span class="n">weather</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">stations</span><span class="o">=</span><span class="n">stations</span><span class="p">),</span>
                           <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;valid&quot;</span><span class="p">:</span> <span class="s2">&quot;date&quot;</span><span class="p">})</span>
                 <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">strip</span><span class="p">)</span>
                 <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]))</span>
                 <span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">])</span>
                 <span class="o">.</span><span class="n">sort_index</span><span class="p">())</span>
    <span class="n">float_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;tmpf&#39;</span><span class="p">,</span> <span class="s1">&#39;relh&#39;</span><span class="p">,</span> <span class="s1">&#39;sped&#39;</span><span class="p">,</span> <span class="s1">&#39;mslp&#39;</span><span class="p">,</span> <span class="s1">&#39;p01i&#39;</span><span class="p">,</span> <span class="s1">&#39;vsby&#39;</span><span class="p">,</span> <span class="s2">&quot;gust_mph&quot;</span><span class="p">]</span>
    <span class="n">weather</span><span class="p">[</span><span class="n">float_cols</span><span class="p">]</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="n">float_cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;corce&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">weather</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_ids</span><span class="p">(</span><span class="n">network</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://mesonet.agron.iastate.edu/geojson/network.php?network={}&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">network</span><span class="p">))</span>
    <span class="n">md</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span>
    <span class="n">md</span><span class="p">[</span><span class="s1">&#39;network&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">network</span>
    <span class="k">return</span> <span class="n">md</span>
</pre></div>


<p>Talk briefly about the gem of a method that is <code>json_normalize</code>.</p>
<div class="highlight"><pre><span></span><span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;http://mesonet.agron.iastate.edu/geojson/network.php?network={}&quot;</span>
<span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;AWOS&quot;</span><span class="p">))</span>
<span class="n">js</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">js</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>


<div class="highlight"><pre><span></span>[{&#39;geometry&#39;: {&#39;coordinates&#39;: [-94.2723694444, 43.0796472222],
   &#39;type&#39;: &#39;Point&#39;},
  &#39;id&#39;: &#39;AXA&#39;,
  &#39;properties&#39;: {&#39;sid&#39;: &#39;AXA&#39;, &#39;sname&#39;: &#39;ALGONA&#39;},
  &#39;type&#39;: &#39;Feature&#39;},
 {&#39;geometry&#39;: {&#39;coordinates&#39;: [-93.569475, 41.6878083333], &#39;type&#39;: &#39;Point&#39;},
  &#39;id&#39;: &#39;IKV&#39;,
  &#39;properties&#39;: {&#39;sid&#39;: &#39;IKV&#39;, &#39;sname&#39;: &#39;ANKENY&#39;},
  &#39;type&#39;: &#39;Feature&#39;}]
</pre></div>


<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">js</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>
</pre></div>


<table border="0" class="dataframe">
    <thead>
        <tr style="text-align: right;">
            <th></th>
            <th>geometry</th>
            <th>id</th>
            <th>properties</th>
            <th>type</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <th>0</th>
            <td>{\'coordinates\': [-94.2723694444, 43.0796472222...</td>
            <td>AXA</td>
            <td>{\'sname\': \'ALGONA\', \'sid\': \'AXA\'}</td>
            <td>Feature</td>
        </tr>
        <tr>
            <th>1</th>
            <td>{\'coordinates\': [-93.569475, 41.6878083333], \'...</td>
            <td>IKV</td>
            <td>{\'sname\': \'ANKENY\', \'sid\': \'IKV\'}</td>
            <td>Feature</td>
        </tr>
        <tr>
            <th>2</th>
            <td>{\'coordinates\': [-95.0465277778, 41.4058805556...</td>
            <td>AIO</td>
            <td>{\'sname\': \'ATLANTIC\', \'sid\': \'AIO\'}</td>
            <td>Feature</td>
        </tr>
        <tr>
            <th>3</th>
            <td>{\'coordinates\': [-94.9204416667, 41.6993527778...</td>
            <td>ADU</td>
            <td>{\'sname\': \'AUDUBON\', \'sid\': \'ADU\'}</td>
            <td>Feature</td>
        </tr>
        <tr>
            <th>4</th>
            <td>{\'coordinates\': [-93.848575, 42.0485694444], \'...</td>
            <td>BNW</td>
            <td>{\'sname\': \'BOONE MUNI\', \'sid\': \'BNW\'}</td>
            <td>Feature</td>
        </tr>
    </tbody>
</table>

<div class="highlight"><pre><span></span><span class="n">js</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="p">{</span>
    <span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">94.2723694444</span><span class="p">,</span> <span class="mf">43.0796472222</span><span class="p">],</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span>
    <span class="p">},</span>
    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;AXA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;AXA&#39;</span><span class="p">,</span>
        <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;ALGONA&#39;</span>
    <span class="p">},</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span>
<span class="p">}</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">js</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">]</span>

<span class="p">[{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">94.2723694444</span><span class="p">,</span> <span class="mf">43.0796472222</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;AXA&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;AXA&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;ALGONA&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.569475</span><span class="p">,</span> <span class="mf">41.6878083333</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;IKV&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;IKV&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;ANKENY&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.0465277778</span><span class="p">,</span> <span class="mf">41.4058805556</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;AIO&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;AIO&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;ATLANTIC&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">94.9204416667</span><span class="p">,</span> <span class="mf">41.6993527778</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;ADU&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;ADU&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;AUDUBON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.848575</span><span class="p">,</span> <span class="mf">42.0485694444</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;BNW&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;BNW&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;BOONE MUNI&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">94.7888805556</span><span class="p">,</span> <span class="mf">42.0443611111</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CIN&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CIN&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;CARROLL&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">92.8983388889</span><span class="p">,</span> <span class="mf">40.6831805556</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TVK&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;TVK&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Centerville&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.3607694444</span><span class="p">,</span> <span class="mf">41.0184305556</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CNC&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CNC&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;CHARITON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">92.6132222222</span><span class="p">,</span> <span class="mf">43.0730055556</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CCY&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CCY&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;CHARLES CITY&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.553775</span><span class="p">,</span> <span class="mf">42.7304194444</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CKP&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CKP&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Cherokee&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.0222722222</span><span class="p">,</span> <span class="mf">40.7241527778</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;ICL&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;ICL&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;CLARINDA&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.7592583333</span><span class="p">,</span> <span class="mf">42.7430416667</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CAV&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CAV&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;CLARION&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">90.332796</span><span class="p">,</span> <span class="mf">41.829504</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CWI&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CWI&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;CLINTON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.7604083333</span><span class="p">,</span> <span class="mf">41.2611111111</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CBF&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CBF&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;COUNCIL BLUFFS&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">94.3607972222</span><span class="p">,</span> <span class="mf">41.0187888889</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;CSQ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;CSQ&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;CRESTON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.7433138889</span><span class="p">,</span> <span class="mf">43.2755194444</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;DEH&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;DEH&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;DECORAH&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.3799888889</span><span class="p">,</span> <span class="mf">41.9841944444</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;DNS&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;DNS&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;DENISON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.9834111111</span><span class="p">,</span> <span class="mf">41.0520888889</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;FFL&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;FFL&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;FAIRFIELD&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.6236694444</span><span class="p">,</span> <span class="mf">43.2323166667</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;FXY&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;FXY&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Forest City&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">94.203203</span><span class="p">,</span> <span class="mf">42.549741</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;FOD&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;FOD&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;FORT DODGE&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.3267166667</span><span class="p">,</span> <span class="mf">40.6614833333</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;FSW&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;FSW&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;FORT MADISON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">92.7331972222</span><span class="p">,</span> <span class="mf">41.7097305556</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;GGI&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;GGI&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Grinnell&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.3354555556</span><span class="p">,</span> <span class="mf">41.5834194444</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;HNR&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;HNR&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;HARLAN&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.9504</span><span class="p">,</span> <span class="mf">42.4544277778</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;IIB&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;IIB&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;INDEPENDENCE&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.2650805556</span><span class="p">,</span> <span class="mf">42.4690972222</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;IFA&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;IFA&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Iowa Falls&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.4273916667</span><span class="p">,</span> <span class="mf">40.4614611111</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;EOK&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;EOK&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;KEOKUK MUNI&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.1113916667</span><span class="p">,</span> <span class="mf">41.2984472222</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;OXV&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;OXV&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Knoxville&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">96.19225</span><span class="p">,</span> <span class="mf">42.775375</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;LRJ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;LRJ&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;LE MARS&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.1604555556</span><span class="p">,</span> <span class="mf">42.2203611111</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;MXO&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;MXO&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;MONTICELLO MUNI&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.5122277778</span><span class="p">,</span> <span class="mf">40.9452527778</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;MPZ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;MPZ&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;MOUNT PLEASANT&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.140575</span><span class="p">,</span> <span class="mf">41.3669944444</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;MUT&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;MUT&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;MUSCATINE&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.0190416667</span><span class="p">,</span> <span class="mf">41.6701111111</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;TNU&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;TNU&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;NEWTON MUNI&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.9759888889</span><span class="p">,</span> <span class="mf">42.6831388889</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;OLZ&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;OLZ&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;OELWEIN&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">96.0605861111</span><span class="p">,</span> <span class="mf">42.9894916667</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;ORC&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;ORC&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Orange City&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.6876138889</span><span class="p">,</span> <span class="mf">41.0471722222</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;I75&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;I75&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Osceola&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">92.4918666667</span><span class="p">,</span> <span class="mf">41.227275</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;OOA&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;OOA&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Oskaloosa&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">92.9431083333</span><span class="p">,</span> <span class="mf">41.3989138889</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;PEA&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;PEA&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;PELLA&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">94.1637083333</span><span class="p">,</span> <span class="mf">41.8277916667</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;PRO&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;PRO&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Perry&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.2624111111</span><span class="p">,</span> <span class="mf">41.01065</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;RDK&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;RDK&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;RED OAK&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.8353138889</span><span class="p">,</span> <span class="mf">43.2081611111</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;SHL&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;SHL&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;SHELDON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.4112333333</span><span class="p">,</span> <span class="mf">40.753275</span><span class="p">],</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;SDA&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;SDA&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;SHENANDOAH MUNI&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">95.2399194444</span><span class="p">,</span> <span class="mf">42.5972277778</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;SLB&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;SLB&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Storm Lake&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">92.0248416667</span><span class="p">,</span> <span class="mf">42.2175777778</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;VTI&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;VTI&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;VINTON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">91.6748111111</span><span class="p">,</span> <span class="mf">41.2751444444</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;AWG&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;AWG&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;WASHINGTON&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">},</span>
<span class="p">{</span><span class="s1">&#39;geometry&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;coordinates&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">93.8690777778</span><span class="p">,</span> <span class="mf">42.4392305556</span><span class="p">],</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Point&#39;</span><span class="p">},</span>
  <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;EBS&#39;</span><span class="p">,</span>
  <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;sid&#39;</span><span class="p">:</span> <span class="s1">&#39;EBS&#39;</span><span class="p">,</span> <span class="s1">&#39;sname&#39;</span><span class="p">:</span> <span class="s1">&#39;Webster City&#39;</span><span class="p">},</span>
  <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;Feature&#39;</span><span class="p">}]</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">json</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">js</span><span class="p">[</span><span class="s1">&#39;features&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">id</span>
<span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;http://mesonet.agron.iastate.edu/cgi-bin/request/asos.py?&quot;</span>
       <span class="s2">&quot;&amp;data=tmpf&amp;data=relh&amp;data=sped&amp;data=mslp&amp;data=p01i&amp;data=vsby&amp;data=gust_mph&amp;data=skyc1&amp;data=skyc2&amp;data=skyc3&quot;</span>
       <span class="s2">&quot;&amp;tz=Etc/UTC&amp;format=comma&amp;latlon=no&quot;</span>
       <span class="s2">&quot;&amp;{start:year1=%Y&amp;month1=%m&amp;day1=</span><span class="si">%d</span><span class="s2">}&quot;</span>
       <span class="s2">&quot;&amp;{end:year2=%Y&amp;month2=%m&amp;day2=</span><span class="si">%d</span><span class="s2">}&amp;{stations}&quot;</span><span class="p">)</span>
<span class="n">stations</span> <span class="o">=</span> <span class="s2">&quot;&amp;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;station=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-01&#39;</span><span class="p">)</span>
<span class="n">end</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2014-01-31&#39;</span><span class="p">)</span>

<span class="n">weather</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">,</span> <span class="n">stations</span><span class="o">=</span><span class="n">stations</span><span class="p">),</span>
                       <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">ids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">get_ids</span><span class="p">(</span><span class="n">network</span><span class="p">)</span> <span class="k">for</span> <span class="n">network</span> <span class="ow">in</span> <span class="n">networks</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">gr</span> <span class="o">=</span> <span class="n">ids</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;network&#39;</span><span class="p">)</span>

<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;weather&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gr</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{}/{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">network</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\r</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">weather</span> <span class="o">=</span> <span class="n">get_weather</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">])</span>
    <span class="n">weather</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;weather/{}.csv&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>

<span class="n">weather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;weather/*.csv&#39;</span><span class="p">)])</span>

<span class="n">weather</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="s2">&quot;weather.h5&quot;</span><span class="p">,</span> <span class="s2">&quot;weather&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">weather</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">&quot;weather.h5&quot;</span><span class="p">,</span> <span class="s2">&quot;weather&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">weather</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>tmpf</th>
      <th>relh</th>
      <th>sped</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>vsby</th>
      <th>gust_mph</th>
      <th>skyc1</th>
      <th>skyc2</th>
      <th>skyc3</th>
    </tr>
    <tr>
      <th>station</th>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">01M</th>
      <th>2014-01-01 00:15:00</th>
      <td>33.80</td>
      <td>85.86</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 00:35:00</th>
      <td>33.44</td>
      <td>87.11</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 00:55:00</th>
      <td>32.54</td>
      <td>90.97</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 01:15:00</th>
      <td>31.82</td>
      <td>93.65</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 01:35:00</th>
      <td>32.00</td>
      <td>92.97</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>

<p>OK, that was a bit of work. Here's a plot to reward ourselves.</p>
<div class="highlight"><pre><span></span><span class="n">airports</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DSM&#39;</span><span class="p">,</span> <span class="s1">&#39;ORD&#39;</span><span class="p">,</span> <span class="s1">&#39;JFK&#39;</span><span class="p">,</span> <span class="s1">&#39;PDX&#39;</span><span class="p">]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">weather</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">airports</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
                  <span class="n">col</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">,</span> <span class="s1">&#39;sped&#39;</span><span class="p">,</span> <span class="s1">&#39;gust_mph&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../content/images/indexes_wind_gust_facet.png&#39;</span><span class="p">);</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">airports</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;DSM&#39;</span><span class="p">,</span> <span class="s1">&#39;ORD&#39;</span><span class="p">,</span> <span class="s1">&#39;JFK&#39;</span><span class="p">,</span> <span class="s1">&#39;PDX&#39;</span><span class="p">]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">FacetGrid</span><span class="p">(</span><span class="n">weather</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">airports</span><span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span>
                  <span class="n">col</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">sns</span><span class="o">.</span><span class="n">regplot</span><span class="p">,</span> <span class="s1">&#39;sped&#39;</span><span class="p">,</span> <span class="s1">&#39;gust_mph&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../content/images/indexes_wind_gust_facet.svg&#39;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">);</span>
</pre></div>


<p><img alt="png" src="Indexes_files/Indexes_18_0.png"></p>
<h1>Set Operations</h1>
<p>Indexes are set-like (technically <em>multi</em>sets, since you can have duplicates), so they support most python <code>set</code> operations. Indexes are immutable so you won't find any of the inplace <code>set</code> operations.
One other difference is that since <code>Index</code>es are also array like, you can't use some infix operators like <code>-</code> for <code>difference</code>. If you have a numeric index it is unclear whether you intend to perform math operations or set operations.
You can use <code>&amp;</code> for intersetion, <code>|</code> for union, and <code>^</code> for symmetric difference though, since there's no ambiguity.</p>
<p>For example, lets find the set of airports that we have weather and flight information on. Since <code>weather</code> had a MultiIndex of <code>airport,datetime</code>, we'll use the <code>levels</code> attribute to get at the airport data, separate from the date data.</p>
<div class="highlight"><pre><span></span><span class="c1"># Bring in the flights data</span>

<span class="n">flights</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s1">&#39;flights.h5&#39;</span><span class="p">,</span> <span class="s1">&#39;flights&#39;</span><span class="p">)</span>

<span class="n">weather_locs</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># The `categories` attribute of a Categorical is an Index</span>
<span class="n">origin_locs</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>
<span class="n">dest_locs</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">dest</span><span class="o">.</span><span class="n">cat</span><span class="o">.</span><span class="n">categories</span>

<span class="n">airports</span> <span class="o">=</span> <span class="n">weather_locs</span> <span class="o">&amp;</span> <span class="n">origin_locs</span> <span class="o">&amp;</span> <span class="n">dest_locs</span>
<span class="n">airports</span>
</pre></div>


<div class="highlight"><pre><span></span>Index([&#39;ABE&#39;, &#39;ABI&#39;, &#39;ABQ&#39;, &#39;ABR&#39;, &#39;ABY&#39;, &#39;ACT&#39;, &#39;ACV&#39;, &#39;AEX&#39;, &#39;AGS&#39;, &#39;ALB&#39;,
       ...
       &#39;TUL&#39;, &#39;TUS&#39;, &#39;TVC&#39;, &#39;TWF&#39;, &#39;TXK&#39;, &#39;TYR&#39;, &#39;TYS&#39;, &#39;VLD&#39;, &#39;VPS&#39;, &#39;XNA&#39;],
      dtype=&#39;object&#39;, length=267)
</pre></div>


<div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="s2">&quot;Weather, no flights:</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">weather_locs</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">origin_locs</span> <span class="o">|</span> <span class="n">dest_locs</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Flights, no weather:</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">origin_locs</span> <span class="o">|</span> <span class="n">dest_locs</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="n">weather_locs</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dropped Stations:</span><span class="se">\n\t</span><span class="s2">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">origin_locs</span> <span class="o">|</span> <span class="n">dest_locs</span><span class="p">)</span> <span class="o">^</span> <span class="n">weather_locs</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>Weather, no flights:
     Index([&#39;01M&#39;, &#39;04V&#39;, &#39;04W&#39;, &#39;05U&#39;, &#39;06D&#39;, &#39;08D&#39;, &#39;0A9&#39;, &#39;0CO&#39;, &#39;0E0&#39;, &#39;0F2&#39;,
       ...
       &#39;Y50&#39;, &#39;Y51&#39;, &#39;Y63&#39;, &#39;Y70&#39;, &#39;YIP&#39;, &#39;YKM&#39;, &#39;YKN&#39;, &#39;YNG&#39;, &#39;ZPH&#39;, &#39;ZZV&#39;],
      dtype=&#39;object&#39;, length=1909)

Flights, no weather:
     Index([&#39;ADK&#39;, &#39;ADQ&#39;, &#39;ANC&#39;, &#39;BET&#39;, &#39;BKG&#39;, &#39;BQN&#39;, &#39;BRW&#39;, &#39;CDV&#39;, &#39;CLD&#39;, &#39;FAI&#39;,
       &#39;FCA&#39;, &#39;GUM&#39;, &#39;HNL&#39;, &#39;ITO&#39;, &#39;JNU&#39;, &#39;KOA&#39;, &#39;KTN&#39;, &#39;LIH&#39;, &#39;MQT&#39;, &#39;OGG&#39;,
       &#39;OME&#39;, &#39;OTZ&#39;, &#39;PPG&#39;, &#39;PSE&#39;, &#39;PSG&#39;, &#39;SCC&#39;, &#39;SCE&#39;, &#39;SIT&#39;, &#39;SJU&#39;, &#39;STT&#39;,
       &#39;STX&#39;, &#39;WRG&#39;, &#39;YAK&#39;, &#39;YUM&#39;],
      dtype=&#39;object&#39;)

Dropped Stations:
     Index([&#39;01M&#39;, &#39;04V&#39;, &#39;04W&#39;, &#39;05U&#39;, &#39;06D&#39;, &#39;08D&#39;, &#39;0A9&#39;, &#39;0CO&#39;, &#39;0E0&#39;, &#39;0F2&#39;,
       ...
       &#39;Y63&#39;, &#39;Y70&#39;, &#39;YAK&#39;, &#39;YIP&#39;, &#39;YKM&#39;, &#39;YKN&#39;, &#39;YNG&#39;, &#39;YUM&#39;, &#39;ZPH&#39;, &#39;ZZV&#39;],
      dtype=&#39;object&#39;, length=1943)
</pre></div>


<h1>Flavors</h1>
<p>Pandas has many subclasses of the regular <code>Index</code>, each tailored to a specific kind of data.
Most of the time these will be created for you automatically, so you don't have to worry about which one to choose.</p>
<ol>
<li><a href="http://pandas.pydata.org/pandas-docs/version/0.18.0/generated/pandas.Index.html#pandas.Index"><code>Index</code></a></li>
<li><code>Int64Index</code></li>
<li><code>RangeIndex</code> (Memory-saving special case of <code>Int64Index</code>)</li>
<li><code>FloatIndex</code></li>
<li><code>DatetimeIndex</code>: Datetime64[ns] precision data</li>
<li><code>PeriodIndex</code>: Regularly-spaced, arbitrary precision datetime data.</li>
<li><code>TimedeltaIndex</code>: Timedelta data</li>
<li><code>CategoricalIndex</code>:</li>
</ol>
<p>Some of these are purely optimizations, others use information about the data to provide additional methods.
And while sometimes you might work with indexes directly (like the set operations above), most of they time you'll be operating on a Series or DataFrame, which in turn makes use of its Index.</p>
<h3>Row Slicing</h3>
<p>We saw in part one that they're great for making <em>row</em> subsetting as easy as column subsetting.</p>
<div class="highlight"><pre><span></span><span class="n">weather</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;DSM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
      <th>relh</th>
      <th>sped</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>vsby</th>
      <th>gust_mph</th>
      <th>skyc1</th>
      <th>skyc2</th>
      <th>skyc3</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 00:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>10.3</td>
      <td>1024.9</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>FEW</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 01:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>11.4</td>
      <td>1025.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>OVC</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 02:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>8.0</td>
      <td>1025.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>BKN</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 03:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>9.1</td>
      <td>1025.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>OVC</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 04:54:00</th>
      <td>10.04</td>
      <td>72.69</td>
      <td>9.1</td>
      <td>1024.7</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>BKN</td>
      <td>M</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>

<p>Without indexes we'd probably resort to boolean masks.</p>
<div class="highlight"><pre><span></span><span class="n">weather2</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">weather2</span><span class="p">[</span><span class="n">weather2</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;DSM&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>date</th>
      <th>tmpf</th>
      <th>relh</th>
      <th>sped</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>vsby</th>
      <th>gust_mph</th>
      <th>skyc1</th>
      <th>skyc2</th>
      <th>skyc3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>884855</th>
      <td>DSM</td>
      <td>2014-01-01 00:54:00</td>
      <td>10.94</td>
      <td>72.79</td>
      <td>10.3</td>
      <td>1024.9</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>FEW</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>884856</th>
      <td>DSM</td>
      <td>2014-01-01 01:54:00</td>
      <td>10.94</td>
      <td>72.79</td>
      <td>11.4</td>
      <td>1025.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>OVC</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>884857</th>
      <td>DSM</td>
      <td>2014-01-01 02:54:00</td>
      <td>10.94</td>
      <td>72.79</td>
      <td>8.0</td>
      <td>1025.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>BKN</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>884858</th>
      <td>DSM</td>
      <td>2014-01-01 03:54:00</td>
      <td>10.94</td>
      <td>72.79</td>
      <td>9.1</td>
      <td>1025.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>OVC</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>884859</th>
      <td>DSM</td>
      <td>2014-01-01 04:54:00</td>
      <td>10.04</td>
      <td>72.69</td>
      <td>9.1</td>
      <td>1024.7</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>BKN</td>
      <td>M</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>

<p>Slightly less convenient, but still doable.</p>
<h3>Indexes for Easier Arithmetic, Analysis</h3>
<p>It's nice to have your metadata (labels on each observation) next to you actual values. But if you store them in an array, they'll get in the way. Say we wanted to translate the farenheit temperature to celcius.</p>
<div class="highlight"><pre><span></span><span class="c1"># With indecies</span>
<span class="n">temp</span> <span class="o">=</span> <span class="n">weather</span><span class="p">[</span><span class="s1">&#39;tmpf&#39;</span><span class="p">]</span>

<span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span>
<span class="n">c</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>tmpf</th>
    </tr>
    <tr>
      <th>station</th>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">01M</th>
      <th>2014-01-01 00:15:00</th>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2014-01-01 00:35:00</th>
      <td>0.8</td>
    </tr>
    <tr>
      <th>2014-01-01 00:55:00</th>
      <td>0.3</td>
    </tr>
    <tr>
      <th>2014-01-01 01:15:00</th>
      <td>-0.1</td>
    </tr>
    <tr>
      <th>2014-01-01 01:35:00</th>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">ZZV</th>
      <th>2014-01-30 19:53:00</th>
      <td>-2.8</td>
    </tr>
    <tr>
      <th>2014-01-30 20:53:00</th>
      <td>-2.2</td>
    </tr>
    <tr>
      <th>2014-01-30 21:53:00</th>
      <td>-2.2</td>
    </tr>
    <tr>
      <th>2014-01-30 22:53:00</th>
      <td>-2.8</td>
    </tr>
    <tr>
      <th>2014-01-30 23:53:00</th>
      <td>-1.7</td>
    </tr>
  </tbody>
</table>
<p>3303647 rows  1 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="c1"># without</span>
<span class="n">temp2</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="s1">&#39;tmpf&#39;</span><span class="p">]]</span>

<span class="n">temp2</span><span class="p">[</span><span class="s1">&#39;tmpf&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">temp2</span><span class="p">[</span><span class="s1">&#39;tmpf&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">9</span>
<span class="n">temp2</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>date</th>
      <th>tmpf</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>01M</td>
      <td>2014-01-01 00:15:00</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>01M</td>
      <td>2014-01-01 00:35:00</td>
      <td>0.8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>01M</td>
      <td>2014-01-01 00:55:00</td>
      <td>0.3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>01M</td>
      <td>2014-01-01 01:15:00</td>
      <td>-0.1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>01M</td>
      <td>2014-01-01 01:35:00</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Again, not terrible, but not as good.
And, what if you had wanted to keep farenheit around as well, instead of overwriting it like we did?
Then you'd need to make a copy of everything, including the <code>station</code> and <code>date</code> columns.
We don't have that problem, since indexes are immutable and safely shared between DataFrames / Series.</p>
<div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">.</span><span class="n">index</span> <span class="ow">is</span> <span class="n">c</span><span class="o">.</span><span class="n">index</span>
</pre></div>


<div class="highlight"><pre><span></span>True
</pre></div>


<h3>Indexes for Alignment</h3>
<p>I've saved the best for last.
Automatic alignment, or reindexing, is fundamental to pandas.</p>
<p>All binary operations (add, multiply, etc...) between Series/DataFrames first <em>align</em> and then proceed.</p>
<p>Let's suppose we have hourly observations on temperature and windspeed.
And suppose some of the observations were invalid, and not reported (simulated below by sampling from the full dataset). We'll assume the missing windspeed observations were potentially different from the missing temperature observations.</p>
<div class="highlight"><pre><span></span><span class="n">dsm</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;DSM&#39;</span><span class="p">]</span>

<span class="n">hourly</span> <span class="o">=</span> <span class="n">dsm</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">temp</span> <span class="o">=</span> <span class="n">hourly</span><span class="p">[</span><span class="s1">&#39;tmpf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">sped</span> <span class="o">=</span> <span class="n">hourly</span><span class="p">[</span><span class="s1">&#39;sped&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=.</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 00:00:00</th>
      <td>10.94</td>
    </tr>
    <tr>
      <th>2014-01-01 02:00:00</th>
      <td>10.94</td>
    </tr>
    <tr>
      <th>2014-01-01 03:00:00</th>
      <td>10.94</td>
    </tr>
    <tr>
      <th>2014-01-01 04:00:00</th>
      <td>10.04</td>
    </tr>
    <tr>
      <th>2014-01-01 05:00:00</th>
      <td>10.04</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">sped</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>date
2014-01-01 01:00:00    11.4
2014-01-01 02:00:00     8.0
2014-01-01 03:00:00     9.1
2014-01-01 04:00:00     9.1
2014-01-01 05:00:00    10.3
Name: sped, dtype: float64
</pre></div>


<p>Notice that the two indexes aren't identical.</p>
<p>Suppose that the <code>windspeed : temperature</code> ratio is meaningful.
When we go to compute that, pandas will automatically align the two by index label.</p>
<div class="highlight"><pre><span></span><span class="n">sped</span> <span class="o">/</span> <span class="n">temp</span>
</pre></div>


<div class="highlight"><pre><span></span>date
2014-01-01 00:00:00         NaN
2014-01-01 01:00:00         NaN
2014-01-01 02:00:00    0.731261
2014-01-01 03:00:00    0.831810
2014-01-01 04:00:00    0.906375
                         ...   
2014-01-30 13:00:00         NaN
2014-01-30 14:00:00    0.584712
2014-01-30 17:00:00         NaN
2014-01-30 21:00:00         NaN
2014-01-30 23:00:00         NaN
dtype: float64
</pre></div>


<p>This lets you focus on doing the operation, rather than manually aligning things, ensuring that the arrays are the same length and in the same order.
By deault, missing values are inserted where the two don't align.
You can use the method version of any binary operation to specify a <code>fill_value</code></p>
<div class="highlight"><pre><span></span><span class="n">sped</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span>date
2014-01-01 00:00:00     0.091408
2014-01-01 01:00:00    11.400000
2014-01-01 02:00:00     0.731261
2014-01-01 03:00:00     0.831810
2014-01-01 04:00:00     0.906375
                         ...    
2014-01-30 13:00:00     0.027809
2014-01-30 14:00:00     0.584712
2014-01-30 17:00:00     0.023267
2014-01-30 21:00:00     0.035663
2014-01-30 23:00:00    13.700000
dtype: float64
</pre></div>


<p>And since I couldn't find anywhere else to put it, you can control the axis the operation is aligned along as well.</p>
<div class="highlight"><pre><span></span><span class="n">hourly</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">sped</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
      <th>relh</th>
      <th>sped</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>vsby</th>
      <th>gust_mph</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 00:00:00</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 01:00:00</th>
      <td>0.959649</td>
      <td>6.385088</td>
      <td>1.0</td>
      <td>89.947368</td>
      <td>0.0</td>
      <td>0.877193</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 02:00:00</th>
      <td>1.367500</td>
      <td>9.098750</td>
      <td>1.0</td>
      <td>128.162500</td>
      <td>0.0</td>
      <td>1.250000</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 03:00:00</th>
      <td>1.202198</td>
      <td>7.998901</td>
      <td>1.0</td>
      <td>112.670330</td>
      <td>0.0</td>
      <td>1.098901</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 04:00:00</th>
      <td>1.103297</td>
      <td>7.987912</td>
      <td>1.0</td>
      <td>112.604396</td>
      <td>0.0</td>
      <td>1.098901</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2014-01-30 19:00:00</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-30 20:00:00</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-30 21:00:00</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-30 22:00:00</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-30 23:00:00</th>
      <td>1.600000</td>
      <td>4.535036</td>
      <td>1.0</td>
      <td>73.970803</td>
      <td>0.0</td>
      <td>0.729927</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>720 rows  7 columns</p>
</div>

<p>The non row-labeled version of this is messy.</p>
<div class="highlight"><pre><span></span><span class="n">temp2</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">sped2</span> <span class="o">=</span> <span class="n">sped</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>

<span class="c1"># Find rows where the operation is defined</span>
<span class="n">common_dates</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Index</span><span class="p">(</span><span class="n">temp2</span><span class="o">.</span><span class="n">date</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">sped2</span><span class="o">.</span><span class="n">date</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span>
    <span class="c1"># concat to not lose date information</span>
    <span class="n">sped2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sped2</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">common_dates</span><span class="p">),</span> <span class="s1">&#39;date&#39;</span><span class="p">],</span>
    <span class="p">(</span><span class="n">sped2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sped2</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">common_dates</span><span class="p">),</span> <span class="s1">&#39;sped&#39;</span><span class="p">]</span> <span class="o">/</span>
     <span class="n">temp2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">temp2</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">common_dates</span><span class="p">),</span> <span class="s1">&#39;tmpf&#39;</span><span class="p">])],</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>0</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2014-01-01 02:00:00</td>
      <td>0.731261</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2014-01-01 03:00:00</td>
      <td>0.831810</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2014-01-01 04:00:00</td>
      <td>0.906375</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2014-01-01 05:00:00</td>
      <td>1.025896</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2014-01-01 13:00:00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>351</th>
      <td>2014-01-29 23:00:00</td>
      <td>0.535609</td>
    </tr>
    <tr>
      <th>354</th>
      <td>2014-01-30 05:00:00</td>
      <td>0.487735</td>
    </tr>
    <tr>
      <th>356</th>
      <td>2014-01-30 09:00:00</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>357</th>
      <td>2014-01-30 10:00:00</td>
      <td>0.618939</td>
    </tr>
    <tr>
      <th>358</th>
      <td>2014-01-30 14:00:00</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>170 rows  2 columns</p>
</div>

<p>Yeah, I prefer the <code>temp / sped</code> version.</p>
<p>Alignment isn't limited to arithmetic operations, although those are the most obvious and easiest to demonstrate.</p>
<h1>Merging</h1>
<p>There are two ways of merging DataFrames / Series in pandas</p>
<ol>
<li>Relational Database style with <code>pd.merge</code></li>
<li>Array style with <code>pd.concat</code></li>
</ol>
<p>Personally, I think in terms of the <code>concat</code> style.
I learned pandas before I ever really used SQL, so it comes more naturally to me I suppose.
<code>pd.merge</code> has more flexibilty, though I think <em>most</em> of the time you don't need this flexibilty.</p>
<h3>Concat Version</h3>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">temp</span><span class="p">,</span> <span class="n">sped</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
      <th>sped</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 00:00:00</th>
      <td>10.94</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 01:00:00</th>
      <td>NaN</td>
      <td>11.4</td>
    </tr>
    <tr>
      <th>2014-01-01 02:00:00</th>
      <td>10.94</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>2014-01-01 03:00:00</th>
      <td>10.94</td>
      <td>9.1</td>
    </tr>
    <tr>
      <th>2014-01-01 04:00:00</th>
      <td>10.04</td>
      <td>9.1</td>
    </tr>
  </tbody>
</table>
</div>

<p>The <code>axis</code> parameter controls how the data should be stacked, <code>0</code> for vertically, <code>1</code> for horizontally.
The <code>join</code> parameter controls the merge behavior on the shared axis, (the Index for <code>axis=1</code>). By default it's like a union of the two indexes, or an outer join.</p>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">temp</span><span class="p">,</span> <span class="n">sped</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">)</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
      <th>sped</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 02:00:00</th>
      <td>10.94</td>
      <td>8.000</td>
    </tr>
    <tr>
      <th>2014-01-01 03:00:00</th>
      <td>10.94</td>
      <td>9.100</td>
    </tr>
    <tr>
      <th>2014-01-01 04:00:00</th>
      <td>10.04</td>
      <td>9.100</td>
    </tr>
    <tr>
      <th>2014-01-01 05:00:00</th>
      <td>10.04</td>
      <td>10.300</td>
    </tr>
    <tr>
      <th>2014-01-01 13:00:00</th>
      <td>8.96</td>
      <td>13.675</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2014-01-29 23:00:00</th>
      <td>35.96</td>
      <td>18.200</td>
    </tr>
    <tr>
      <th>2014-01-30 05:00:00</th>
      <td>33.98</td>
      <td>17.100</td>
    </tr>
    <tr>
      <th>2014-01-30 09:00:00</th>
      <td>35.06</td>
      <td>16.000</td>
    </tr>
    <tr>
      <th>2014-01-30 10:00:00</th>
      <td>35.06</td>
      <td>21.700</td>
    </tr>
    <tr>
      <th>2014-01-30 14:00:00</th>
      <td>35.06</td>
      <td>20.500</td>
    </tr>
  </tbody>
</table>
<p>170 rows  2 columns</p>
</div>

<h3>Merge Version</h3>
<p>Since we're joining by index here the merge version is quite similar.
We'll see an example later of a one-to-many join where the two differ.</p>
<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">sped</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
      <th>sped</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 02:00:00</th>
      <td>10.94</td>
      <td>8.000</td>
    </tr>
    <tr>
      <th>2014-01-01 03:00:00</th>
      <td>10.94</td>
      <td>9.100</td>
    </tr>
    <tr>
      <th>2014-01-01 04:00:00</th>
      <td>10.04</td>
      <td>9.100</td>
    </tr>
    <tr>
      <th>2014-01-01 05:00:00</th>
      <td>10.04</td>
      <td>10.300</td>
    </tr>
    <tr>
      <th>2014-01-01 13:00:00</th>
      <td>8.96</td>
      <td>13.675</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">sped</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">left_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">right_index</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
         <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
      <th>sped</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 00:00:00</th>
      <td>10.94</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 01:00:00</th>
      <td>NaN</td>
      <td>11.4</td>
    </tr>
    <tr>
      <th>2014-01-01 02:00:00</th>
      <td>10.94</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>2014-01-01 03:00:00</th>
      <td>10.94</td>
      <td>9.1</td>
    </tr>
    <tr>
      <th>2014-01-01 04:00:00</th>
      <td>10.04</td>
      <td>9.1</td>
    </tr>
  </tbody>
</table>
</div>

<p>Like I said, I typically prefer <code>concat</code> to <code>merge</code>.
The exception here is one-to-many type joins. Let's walk through one of those,
where we join the flight data to the weather data.
To focus just on the merge, we'll aggregate hour weather data to be daily, rather than trying to find the closest recorded weather observation to each departure (you could do that, but it's not the focus right now). We'll then join the one <code>(airport, date)</code> record to the many <code>(airport, date, flight)</code> records.</p>
<p>Quick tangent, to get the weather data to daily frequency, we'll need to resample (more on that in the timeseries section). The resample essentially involves breaking the recorded values into daily buckets and computing the aggregation function on each bucket. The only wrinkle is that we have to resample <em>by station</em>, so we'll use the <code>pd.TimeGrouper</code> helper.</p>
<div class="highlight"><pre><span></span><span class="n">idx_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;unique_carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="s1">&#39;dest&#39;</span><span class="p">,</span> <span class="s1">&#39;tail_num&#39;</span><span class="p">,</span> <span class="s1">&#39;fl_num&#39;</span><span class="p">,</span> <span class="s1">&#39;fl_date&#39;</span><span class="p">]</span>
<span class="n">data_cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;crs_dep_time&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_delay&#39;</span><span class="p">,</span> <span class="s1">&#39;crs_arr_time&#39;</span><span class="p">,</span> <span class="s1">&#39;arr_delay&#39;</span><span class="p">,</span>
             <span class="s1">&#39;taxi_out&#39;</span><span class="p">,</span> <span class="s1">&#39;taxi_in&#39;</span><span class="p">,</span> <span class="s1">&#39;wheels_off&#39;</span><span class="p">,</span> <span class="s1">&#39;wheels_on&#39;</span><span class="p">,</span> <span class="s1">&#39;distance&#39;</span><span class="p">]</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">flights</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">idx_cols</span><span class="p">)[</span><span class="n">data_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mode</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Arbitrarily break ties.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">aggfuncs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;tmpf&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;relh&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
            <span class="s1">&#39;sped&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;mslp&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
            <span class="s1">&#39;p01i&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;vsby&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span>
            <span class="s1">&#39;gust_mph&#39;</span><span class="p">:</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;skyc1&#39;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span>
            <span class="s1">&#39;skyc2&#39;</span><span class="p">:</span> <span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;skyc3&#39;</span><span class="p">:</span> <span class="n">mode</span><span class="p">}</span>
<span class="c1"># TimeGrouper works on a DatetimeIndex, so we move `station` to the</span>
<span class="c1"># columns and then groupby it as well.</span>
<span class="n">daily</span> <span class="o">=</span> <span class="p">(</span><span class="n">weather</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;station&quot;</span><span class="p">)</span>
                <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">TimeGrouper</span><span class="p">(</span><span class="s1">&#39;1d&#39;</span><span class="p">),</span> <span class="s2">&quot;station&quot;</span><span class="p">])</span>
                <span class="o">.</span><span class="n">agg</span><span class="p">(</span><span class="n">aggfuncs</span><span class="p">))</span>

<span class="n">daily</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>gust_mph</th>
      <th>vsby</th>
      <th>sped</th>
      <th>relh</th>
      <th>skyc1</th>
      <th>tmpf</th>
      <th>skyc2</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>skyc3</th>
    </tr>
    <tr>
      <th>date</th>
      <th>station</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">2014-01-01</th>
      <th>01M</th>
      <td>NaN</td>
      <td>9.229167</td>
      <td>2.262500</td>
      <td>81.117917</td>
      <td>CLR</td>
      <td>35.747500</td>
      <td>M</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>04V</th>
      <td>31.307143</td>
      <td>9.861111</td>
      <td>11.131944</td>
      <td>72.697778</td>
      <td>CLR</td>
      <td>18.350000</td>
      <td>M</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>04W</th>
      <td>NaN</td>
      <td>10.000000</td>
      <td>3.601389</td>
      <td>69.908056</td>
      <td>OVC</td>
      <td>-9.075000</td>
      <td>M</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>05U</th>
      <td>NaN</td>
      <td>9.929577</td>
      <td>3.770423</td>
      <td>71.519859</td>
      <td>CLR</td>
      <td>26.321127</td>
      <td>M</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>06D</th>
      <td>NaN</td>
      <td>9.576389</td>
      <td>5.279167</td>
      <td>73.784179</td>
      <td>CLR</td>
      <td>-11.388060</td>
      <td>M</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>

<h3>The merge version</h3>
<div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">flights</span><span class="p">,</span> <span class="n">daily</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;fl_date&#39;</span><span class="p">,</span> <span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="s1">&#39;origin&#39;</span><span class="p">}),</span>
             <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;fl_date&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">idx_cols</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

<span class="n">m</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>airline_id</th>
      <th>origin_airport_id</th>
      <th>origin_airport_seq_id</th>
      <th>origin_city_market_id</th>
      <th>origin_city_name</th>
      <th>origin_state_nm</th>
      <th>dest_airport_id</th>
      <th>dest_airport_seq_id</th>
      <th>dest_city_market_id</th>
      <th>dest_city_name</th>
      <th>...</th>
      <th>gust_mph</th>
      <th>vsby</th>
      <th>sped</th>
      <th>relh</th>
      <th>skyc1</th>
      <th>tmpf</th>
      <th>skyc2</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>skyc3</th>
    </tr>
    <tr>
      <th>unique_carrier</th>
      <th>origin</th>
      <th>dest</th>
      <th>tail_num</th>
      <th>fl_num</th>
      <th>fl_date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">AA</th>
      <th rowspan="5" valign="top">ABQ</th>
      <th rowspan="5" valign="top">DFW</th>
      <th rowspan="2" valign="top">N200AA</th>
      <th>1090</th>
      <th>2014-01-27</th>
      <td>19805</td>
      <td>10140</td>
      <td>1014002</td>
      <td>30140</td>
      <td>Albuquerque, NM</td>
      <td>New Mexico</td>
      <td>11298</td>
      <td>1129803</td>
      <td>30194</td>
      <td>Dallas/Fort Worth, TX</td>
      <td>...</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>6.737500</td>
      <td>34.267500</td>
      <td>SCT</td>
      <td>41.8325</td>
      <td>M</td>
      <td>1014.620833</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>1662</th>
      <th>2014-01-06</th>
      <td>19805</td>
      <td>10140</td>
      <td>1014002</td>
      <td>30140</td>
      <td>Albuquerque, NM</td>
      <td>New Mexico</td>
      <td>11298</td>
      <td>1129803</td>
      <td>30194</td>
      <td>Dallas/Fort Worth, TX</td>
      <td>...</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>9.270833</td>
      <td>27.249167</td>
      <td>CLR</td>
      <td>28.7900</td>
      <td>M</td>
      <td>1029.016667</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>N202AA</th>
      <th>1332</th>
      <th>2014-01-27</th>
      <td>19805</td>
      <td>10140</td>
      <td>1014002</td>
      <td>30140</td>
      <td>Albuquerque, NM</td>
      <td>New Mexico</td>
      <td>11298</td>
      <td>1129803</td>
      <td>30194</td>
      <td>Dallas/Fort Worth, TX</td>
      <td>...</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>6.737500</td>
      <td>34.267500</td>
      <td>SCT</td>
      <td>41.8325</td>
      <td>M</td>
      <td>1014.620833</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th rowspan="2" valign="top">N426AA</th>
      <th>1467</th>
      <th>2014-01-15</th>
      <td>19805</td>
      <td>10140</td>
      <td>1014002</td>
      <td>30140</td>
      <td>Albuquerque, NM</td>
      <td>New Mexico</td>
      <td>11298</td>
      <td>1129803</td>
      <td>30194</td>
      <td>Dallas/Fort Worth, TX</td>
      <td>...</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>6.216667</td>
      <td>34.580000</td>
      <td>FEW</td>
      <td>40.2500</td>
      <td>M</td>
      <td>1027.800000</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
    <tr>
      <th>1662</th>
      <th>2014-01-09</th>
      <td>19805</td>
      <td>10140</td>
      <td>1014002</td>
      <td>30140</td>
      <td>Albuquerque, NM</td>
      <td>New Mexico</td>
      <td>11298</td>
      <td>1129803</td>
      <td>30194</td>
      <td>Dallas/Fort Worth, TX</td>
      <td>...</td>
      <td>NaN</td>
      <td>10.0</td>
      <td>3.087500</td>
      <td>42.162500</td>
      <td>FEW</td>
      <td>34.6700</td>
      <td>M</td>
      <td>1018.379167</td>
      <td>0.0</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
<p>5 rows  40 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">pipe</span><span class="p">((</span><span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">),</span> <span class="s1">&#39;sped&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_delay&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../content/images/indexes_sped_delay_join.svg&#39;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="Indexes_files/Indexes_63_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;skyc1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dep_delay</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean</th>
      <th>count</th>
    </tr>
    <tr>
      <th>skyc1</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>M</th>
      <td>-1.948052</td>
      <td>77</td>
    </tr>
    <tr>
      <th>CLR</th>
      <td>11.222288</td>
      <td>115121</td>
    </tr>
    <tr>
      <th>FEW</th>
      <td>16.863177</td>
      <td>161727</td>
    </tr>
    <tr>
      <th>SCT</th>
      <td>17.803048</td>
      <td>19289</td>
    </tr>
    <tr>
      <th>BKN</th>
      <td>18.638034</td>
      <td>54030</td>
    </tr>
    <tr>
      <th>OVC</th>
      <td>21.667762</td>
      <td>52643</td>
    </tr>
    <tr>
      <th>VV</th>
      <td>30.487008</td>
      <td>9583</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">mod</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="o">.</span><span class="n">from_formula</span><span class="p">(</span><span class="s1">&#39;dep_delay ~ C(skyc1) + distance + tmpf + relh + sped + mslp&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">m</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">mod</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">res</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>


<table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>dep_delay</td>    <th>  R-squared:         </th>  <td>   0.026</td>  
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th>  <td>   0.025</td>  
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th>  <td>   976.4</td>  
</tr>
<tr>
  <th>Date:</th>             <td>Sun, 10 Apr 2016</td> <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                 <td>16:06:15</td>     <th>  Log-Likelihood:    </th> <td>-2.1453e+06</td>
</tr>
<tr>
  <th>No. Observations:</th>      <td>410372</td>      <th>  AIC:               </th>  <td>4.291e+06</td> 
</tr>
<tr>
  <th>Df Residuals:</th>          <td>410360</td>      <th>  BIC:               </th>  <td>4.291e+06</td> 
</tr>
<tr>
  <th>Df Model:</th>              <td>    11</td>      <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>      <td> </td>     
</tr>
</table>

<table class="simpletable">
<tr>
         <td></td>            <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th> <th>[95.0% Conf. Int.]</th> 
</tr>
<tr>
  <th>Intercept</th>       <td> -331.1032</td> <td>   10.828</td> <td>  -30.577</td> <td> 0.000</td> <td> -352.327  -309.880</td>
</tr>
<tr>
  <th>C(skyc1)[T.CLR]</th> <td>   -4.4041</td> <td>    0.249</td> <td>  -17.662</td> <td> 0.000</td> <td>   -4.893    -3.915</td>
</tr>
<tr>
  <th>C(skyc1)[T.FEW]</th> <td>   -0.7330</td> <td>    0.226</td> <td>   -3.240</td> <td> 0.001</td> <td>   -1.176    -0.290</td>
</tr>
<tr>
  <th>C(skyc1)[T.M]</th>   <td>  -16.4341</td> <td>    8.681</td> <td>   -1.893</td> <td> 0.058</td> <td>  -33.448     0.580</td>
</tr>
<tr>
  <th>C(skyc1)[T.OVC]</th> <td>    0.3818</td> <td>    0.281</td> <td>    1.358</td> <td> 0.174</td> <td>   -0.169     0.933</td>
</tr>
<tr>
  <th>C(skyc1)[T.SCT]</th> <td>    0.8589</td> <td>    0.380</td> <td>    2.260</td> <td> 0.024</td> <td>    0.114     1.604</td>
</tr>
<tr>
  <th>C(skyc1)[T.VV ]</th> <td>    8.8603</td> <td>    0.509</td> <td>   17.414</td> <td> 0.000</td> <td>    7.863     9.858</td>
</tr>
<tr>
  <th>distance</th>        <td>    0.0008</td> <td>    0.000</td> <td>    6.174</td> <td> 0.000</td> <td>    0.001     0.001</td>
</tr>
<tr>
  <th>tmpf</th>            <td>   -0.1841</td> <td>    0.005</td> <td>  -38.390</td> <td> 0.000</td> <td>   -0.193    -0.175</td>
</tr>
<tr>
  <th>relh</th>            <td>    0.1626</td> <td>    0.004</td> <td>   38.268</td> <td> 0.000</td> <td>    0.154     0.171</td>
</tr>
<tr>
  <th>sped</th>            <td>    0.6096</td> <td>    0.018</td> <td>   33.716</td> <td> 0.000</td> <td>    0.574     0.645</td>
</tr>
<tr>
  <th>mslp</th>            <td>    0.3340</td> <td>    0.010</td> <td>   31.960</td> <td> 0.000</td> <td>    0.313     0.354</td>
</tr>
</table>

<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>456713.147</td> <th>  Durbin-Watson:     </th>   <td>   1.872</td>  
</tr>
<tr>
  <th>Prob(Omnibus):</th>   <td> 0.000</td>   <th>  Jarque-Bera (JB):  </th> <td>76162962.824</td>
</tr>
<tr>
  <th>Skew:</th>            <td> 5.535</td>   <th>  Prob(JB):          </th>   <td>    0.00</td>  
</tr>
<tr>
  <th>Kurtosis:</th>        <td>68.816</td>   <th>  Cond. No.          </th>   <td>2.07e+05</td>  
</tr>
</table>

<div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Predicted&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../content/images/indexes_resid_fit.png&#39;</span><span class="p">,</span> <span class="n">transparent</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p><img alt="png" src="Indexes_files/Indexes_67_0.png"></p>
<div class="highlight"><pre><span></span><span class="n">weather</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>tmpf</th>
      <th>relh</th>
      <th>sped</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>vsby</th>
      <th>gust_mph</th>
      <th>skyc1</th>
      <th>skyc2</th>
      <th>skyc3</th>
    </tr>
    <tr>
      <th>station</th>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">01M</th>
      <th>2014-01-01 00:15:00</th>
      <td>33.80</td>
      <td>85.86</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 00:35:00</th>
      <td>33.44</td>
      <td>87.11</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 00:55:00</th>
      <td>32.54</td>
      <td>90.97</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 01:15:00</th>
      <td>31.82</td>
      <td>93.65</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 01:35:00</th>
      <td>32.00</td>
      <td>92.97</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>CLR</td>
      <td>M</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
</div>

<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>


<span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="n">fp</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="nb">str</span><span class="o">.</span><span class="n">lower</span><span class="p">)</span>
            <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;unnamed: 36&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">extract_city_name</span><span class="p">)</span>
            <span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="n">time_to_datetime</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;dep_time&#39;</span><span class="p">,</span> <span class="s1">&#39;arr_time&#39;</span><span class="p">,</span> <span class="s1">&#39;crs_arr_time&#39;</span><span class="p">,</span> <span class="s1">&#39;crs_dep_time&#39;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">fl_date</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;fl_date&#39;</span><span class="p">]),</span>
                    <span class="n">dest</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;dest&#39;</span><span class="p">]),</span>
                    <span class="n">origin</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;origin&#39;</span><span class="p">]),</span>
                    <span class="n">tail_num</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;tail_num&#39;</span><span class="p">]),</span>
                    <span class="n">unique_carrier</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;unique_carrier&#39;</span><span class="p">]),</span>
                    <span class="n">cancellation_code</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="s1">&#39;cancellation_code&#39;</span><span class="p">])))</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">extract_city_name</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Chicago, IL -&gt; Chicago for origin_city_name and dest_city_name</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;origin_city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;dest_city_name&#39;</span><span class="p">]</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">cols</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="s2">&quot;(.*), \w{2}&quot;</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;origin_city_name&#39;</span><span class="p">,</span> <span class="s1">&#39;dest_city_name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">city</span>
    <span class="k">return</span> <span class="n">df</span>

<span class="k">def</span> <span class="nf">time_to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Combine all time items into datetimes.</span>

<span class="sd">    2014-01-01,0914 -&gt; 2014-01-01 09:14:00</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">converter</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
        <span class="n">timepart</span> <span class="o">=</span> <span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
                       <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;\.0$&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># NaNs force float dtype</span>
                       <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">fillchar</span><span class="o">=</span><span class="s1">&#39;0&#39;</span><span class="p">))</span>
        <span class="k">return</span>  <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;fl_date&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span>
                               <span class="n">timepart</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:&#39;</span> <span class="o">+</span>
                               <span class="n">timepart</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
                               <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datetime_part</span>
    <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">converter</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>


<span class="n">flights</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="s2">&quot;878167309_T_ONTIME.csv&quot;</span><span class="p">)</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">locs</span> <span class="o">=</span> <span class="n">weather</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;</span> <span class="n">flights</span><span class="o">.</span><span class="n">origin</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="p">(</span><span class="n">weather</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s1">&#39;station&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;station in @locs&#39;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">TimeGrouper</span><span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">)]))</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>tmpf</th>
      <th>relh</th>
      <th>sped</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>vsby</th>
      <th>gust_mph</th>
    </tr>
    <tr>
      <th>station</th>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">ABE</th>
      <th>2014-01-01 00:00:00</th>
      <td>26.06</td>
      <td>47.82</td>
      <td>14.8</td>
      <td>1024.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>21.7</td>
    </tr>
    <tr>
      <th>2014-01-01 01:00:00</th>
      <td>24.08</td>
      <td>51.93</td>
      <td>8.0</td>
      <td>1025.2</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 02:00:00</th>
      <td>24.08</td>
      <td>49.87</td>
      <td>6.8</td>
      <td>1025.7</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 03:00:00</th>
      <td>23.00</td>
      <td>52.18</td>
      <td>9.1</td>
      <td>1026.2</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-01 04:00:00</th>
      <td>23.00</td>
      <td>52.18</td>
      <td>4.6</td>
      <td>1026.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">XNA</th>
      <th>2014-01-30 19:00:00</th>
      <td>44.96</td>
      <td>38.23</td>
      <td>16.0</td>
      <td>1009.7</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>25.1</td>
    </tr>
    <tr>
      <th>2014-01-30 20:00:00</th>
      <td>46.04</td>
      <td>41.74</td>
      <td>16.0</td>
      <td>1010.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-30 21:00:00</th>
      <td>46.04</td>
      <td>41.74</td>
      <td>13.7</td>
      <td>1010.9</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>20.5</td>
    </tr>
    <tr>
      <th>2014-01-30 22:00:00</th>
      <td>42.98</td>
      <td>46.91</td>
      <td>11.4</td>
      <td>1011.5</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2014-01-30 23:00:00</th>
      <td>39.92</td>
      <td>54.81</td>
      <td>3.4</td>
      <td>1012.2</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>191445 rows  7 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">flights</span><span class="o">.</span><span class="n">copy</span><span class="p">()[[</span><span class="s1">&#39;unique_carrier&#39;</span><span class="p">,</span> <span class="s1">&#39;tail_num&#39;</span><span class="p">,</span> <span class="s1">&#39;origin&#39;</span><span class="p">,</span> <span class="s1">&#39;dep_time&#39;</span><span class="p">]]</span>
      <span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s1">&#39;origin in @locs&#39;</span><span class="p">))</span>
</pre></div>


<div class="highlight"><pre><span></span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">weather</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;DSM&#39;</span><span class="p">]</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tmpf</th>
      <th>relh</th>
      <th>sped</th>
      <th>mslp</th>
      <th>p01i</th>
      <th>vsby</th>
      <th>gust_mph</th>
      <th>skyc1</th>
      <th>skyc2</th>
      <th>skyc3</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-01 00:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>10.3</td>
      <td>1024.9</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>FEW</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 01:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>11.4</td>
      <td>1025.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>OVC</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 02:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>8.0</td>
      <td>1025.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>BKN</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 03:54:00</th>
      <td>10.94</td>
      <td>72.79</td>
      <td>9.1</td>
      <td>1025.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>OVC</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-01 04:54:00</th>
      <td>10.04</td>
      <td>72.69</td>
      <td>9.1</td>
      <td>1024.7</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>BKN</td>
      <td>M</td>
      <td>M</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2014-01-30 19:54:00</th>
      <td>30.92</td>
      <td>55.99</td>
      <td>28.5</td>
      <td>1006.3</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>35.3</td>
      <td>FEW</td>
      <td>FEW</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-30 20:54:00</th>
      <td>30.02</td>
      <td>55.42</td>
      <td>14.8</td>
      <td>1008.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>28.5</td>
      <td>FEW</td>
      <td>FEW</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-30 21:54:00</th>
      <td>28.04</td>
      <td>55.12</td>
      <td>18.2</td>
      <td>1010.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>26.2</td>
      <td>FEW</td>
      <td>FEW</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-30 22:54:00</th>
      <td>26.06</td>
      <td>57.04</td>
      <td>13.7</td>
      <td>1011.8</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>FEW</td>
      <td>FEW</td>
      <td>M</td>
    </tr>
    <tr>
      <th>2014-01-30 23:54:00</th>
      <td>21.92</td>
      <td>62.13</td>
      <td>13.7</td>
      <td>1013.4</td>
      <td>0.0</td>
      <td>10.0</td>
      <td>NaN</td>
      <td>FEW</td>
      <td>FEW</td>
      <td>M</td>
    </tr>
  </tbody>
</table>
<p>896 rows  10 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span>
</pre></div>


<div>
<table border="0" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>fl_date</th>
      <th>unique_carrier</th>
      <th>airline_id</th>
      <th>tail_num</th>
      <th>fl_num</th>
      <th>origin_airport_id</th>
      <th>origin_airport_seq_id</th>
      <th>origin_city_market_id</th>
      <th>origin</th>
      <th>origin_city_name</th>
      <th>...</th>
      <th>arr_delay</th>
      <th>cancelled</th>
      <th>cancellation_code</th>
      <th>diverted</th>
      <th>distance</th>
      <th>carrier_delay</th>
      <th>weather_delay</th>
      <th>nas_delay</th>
      <th>security_delay</th>
      <th>late_aircraft_delay</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2014-01-01</td>
      <td>AA</td>
      <td>19805</td>
      <td>N338AA</td>
      <td>1</td>
      <td>12478</td>
      <td>1247802</td>
      <td>31703</td>
      <td>JFK</td>
      <td>New York</td>
      <td>...</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>2475.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2014-01-01</td>
      <td>AA</td>
      <td>19805</td>
      <td>N339AA</td>
      <td>2</td>
      <td>12892</td>
      <td>1289203</td>
      <td>32575</td>
      <td>LAX</td>
      <td>Los Angeles</td>
      <td>...</td>
      <td>111.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>2475.0</td>
      <td>111.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2014-01-01</td>
      <td>AA</td>
      <td>19805</td>
      <td>N335AA</td>
      <td>3</td>
      <td>12478</td>
      <td>1247802</td>
      <td>31703</td>
      <td>JFK</td>
      <td>New York</td>
      <td>...</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>2475.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2014-01-01</td>
      <td>AA</td>
      <td>19805</td>
      <td>N367AA</td>
      <td>5</td>
      <td>11298</td>
      <td>1129803</td>
      <td>30194</td>
      <td>DFW</td>
      <td>Dallas/Fort Worth</td>
      <td>...</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>3784.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2014-01-01</td>
      <td>AA</td>
      <td>19805</td>
      <td>N364AA</td>
      <td>6</td>
      <td>13830</td>
      <td>1383002</td>
      <td>33830</td>
      <td>OGG</td>
      <td>Kahului</td>
      <td>...</td>
      <td>-8.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>3711.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>471944</th>
      <td>2014-01-31</td>
      <td>OO</td>
      <td>20304</td>
      <td>N292SW</td>
      <td>5313</td>
      <td>12889</td>
      <td>1288903</td>
      <td>32211</td>
      <td>LAS</td>
      <td>Las Vegas</td>
      <td>...</td>
      <td>-7.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>259.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>471945</th>
      <td>2014-01-31</td>
      <td>OO</td>
      <td>20304</td>
      <td>N580SW</td>
      <td>5314</td>
      <td>12892</td>
      <td>1289203</td>
      <td>32575</td>
      <td>LAX</td>
      <td>Los Angeles</td>
      <td>...</td>
      <td>-12.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>89.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>471946</th>
      <td>2014-01-31</td>
      <td>OO</td>
      <td>20304</td>
      <td>N580SW</td>
      <td>5314</td>
      <td>14689</td>
      <td>1468902</td>
      <td>34689</td>
      <td>SBA</td>
      <td>Santa Barbara</td>
      <td>...</td>
      <td>11.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>89.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>471947</th>
      <td>2014-01-31</td>
      <td>OO</td>
      <td>20304</td>
      <td>N216SW</td>
      <td>5315</td>
      <td>11292</td>
      <td>1129202</td>
      <td>30325</td>
      <td>DEN</td>
      <td>Denver</td>
      <td>...</td>
      <td>56.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>260.0</td>
      <td>36.0</td>
      <td>0.0</td>
      <td>13.0</td>
      <td>0.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>471948</th>
      <td>2014-01-31</td>
      <td>OO</td>
      <td>20304</td>
      <td>N216SW</td>
      <td>5315</td>
      <td>14543</td>
      <td>1454302</td>
      <td>34543</td>
      <td>RKS</td>
      <td>Rock Springs</td>
      <td>...</td>
      <td>47.0</td>
      <td>0.0</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>260.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>43.0</td>
    </tr>
  </tbody>
</table>
<p>471949 rows  36 columns</p>
</div>

<div class="highlight"><pre><span></span><span class="n">dep</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>0        2014-01-01 09:14:00
1        2014-01-01 11:32:00
2        2014-01-01 11:57:00
3        2014-01-01 13:07:00
4        2014-01-01 17:53:00
                 ...        
163906   2014-01-11 16:57:00
163910   2014-01-11 11:04:00
181062   2014-01-12 17:02:00
199092   2014-01-13 23:36:00
239150   2014-01-16 16:46:00
Name: dep_time, dtype: datetime64[ns]
</pre></div>


<div class="highlight"><pre><span></span><span class="n">flights</span><span class="o">.</span><span class="n">dep_time</span>
</pre></div>


<div class="highlight"><pre><span></span>0        2014-01-01 09:14:00
1        2014-01-01 11:32:00
2        2014-01-01 11:57:00
3        2014-01-01 13:07:00
4        2014-01-01 17:53:00
                 ...        
471944   2014-01-31 09:05:00
471945   2014-01-31 09:24:00
471946   2014-01-31 10:39:00
471947   2014-01-31 09:28:00
471948   2014-01-31 11:22:00
Name: dep_time, dtype: datetime64[ns]
</pre></div>


<div class="highlight"><pre><span></span><span class="n">flights</span><span class="o">.</span><span class="n">dep_time</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>array([&#39;2014-01-01T03:14:00.000000000-0600&#39;,
       &#39;2014-01-01T05:32:00.000000000-0600&#39;,
       &#39;2014-01-01T05:57:00.000000000-0600&#39;, ...,
       &#39;2014-01-30T18:44:00.000000000-0600&#39;,
       &#39;2014-01-31T17:16:00.000000000-0600&#39;,
       &#39;2014-01-30T18:47:00.000000000-0600&#39;], dtype=&#39;datetime64[ns]&#39;)
</pre></div>


<div class="highlight"><pre><span></span><span class="n">stations</span>
</pre></div>


<div class="highlight"><pre><span></span><span class="n">flights</span><span class="o">.</span><span class="n">dep_time</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>


<div class="highlight"><pre><span></span>0   2014-01-01 09:14:00
1   2014-01-01 11:32:00
2   2014-01-01 11:57:00
3   2014-01-01 13:07:00
4   2014-01-01 17:53:00
Name: dep_time, dtype: datetime64[ns]
</pre></div>
  </div>

</article>


  </main>
    <footer>
      <div class="author__logo">
          <img src="/theme/images/logo.png" alt="logo">
      </div>
      <section class="author">
        <div class="author__name">
          <a href="/pages/about.html">Tom Augspurger</a>
          <p></p>
        </div>
        <div class="author__link">
          <ul>
            <li><a href="/pages/about.html" title="About"><i class="fa fa-link"></i></a></li>
            <li><a href="/pages/article-1-cluster.html" title="article-1-cluster"><i class="fa fa-link"></i></a></li>
            <li>
              <a href="/feeds/all.atom.xml" target="_blank" title="Feed">
                <i class="fa fa-rss"></i>
              </a>
            </li>
          </ul>
        </div>
      </section>
      <div class="ending-message">
        <p>&copy; Tom Augspurger. Powered by <a href="http://getpelican.com" target="_blank">Pelican</a>, Theme is using <a href="https://github.com/laughk/pelican-hss" target="_blank">HSS</a>. </p>
      </div>
    </footer>
</body>
</html>
